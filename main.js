(()=>{"use strict";var t={6507:function(t,e,s){var i=this&&this.__createBinding||(Object.create?function(t,e,s,i){void 0===i&&(i=s);var n=Object.getOwnPropertyDescriptor(e,s);n&&!("get"in n?!e.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return e[s]}}),Object.defineProperty(t,i,n)}:function(t,e,s,i){void 0===i&&(i=s),t[i]=e[s]}),n=this&&this.__exportStar||function(t,e){for(var s in t)"default"===s||Object.prototype.hasOwnProperty.call(e,s)||i(e,t,s)};Object.defineProperty(e,"__esModule",{value:!0}),n(s(4831),e)},601:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(9185),r=s(9894),o=s(4109),a=s(4686),l=s(8333),h=s(1514),u=s(277);e.default=class{constructor(){this.meshMap=new Map,this.heightmapMap=new Map,this.octreeMap=new Map}getMesh(t,e=!0){return this.meshMap.get(t)||(e&&console.warn("Trying to get mesh "+t+" before loading it"),null)}loadMesh(t){return i(this,void 0,void 0,(function*(){let e=this.meshMap.get(t);if(e)return e;let s=yield this.parseObjContent(t);return this.meshMap.set(t,new l.default(o.geometryPass,s)),this.meshMap.get(t)}))}getHeightmap(t,e=!0){return this.heightmapMap.get(t)||(e&&console.warn("Trying to get heightmap "+t+" before loading it"),null)}loadHeightmap(t,e=!0,s=2,n=2,r=1,l=1){return i(this,void 0,void 0,(function*(){let i=this.heightmapMap.get(t);if(i)return i;let h=new a.default(o.geometryPass);return e||h.createPlane(s,n,r,l),yield h.readHeightDataFromTexture(t,e),this.heightmapMap.set(t,h),h}))}getOctree(t,e=!0){let s=this.octreeMap.get(t);return s&&0==s.triangles.length?s.octree:(e&&console.warn("Trying to get octree "+t+" before loading it"),null)}loadOctree(t,e,s,n=1/0){return i(this,void 0,void 0,(function*(){let i=Date.now(),o=this.octreeMap.get(t);if(o&&0==o.triangles.length)return{octree:o.octree,doneLoading:!0};if(null==o){this.octreeMap.set(t,{octree:null,triangles:null}),o=this.octreeMap.get(t);let i=new Array;if(t.endsWith(".obj")){let e=this.getMesh(t,!1);if(!e)return console.warn("Trying to get octree for "+t+" before loading "+t),null;e.setupTriangles(i)}else{let e=this.getHeightmap(t,!1);if(!e)return console.warn("Trying to get octree for "+t+" before loading "+t),null;e.setupTriangles(i)}o.triangles=i;let n="Assets/octrees/"+t.split("/").pop().split(".")[0]+".oct";const a=yield fetch(n);if(a.ok){console.log("Loaded octree from "+n);const t=yield a.text();o.octree=new h.default(new r.default,new r.default,e,s),o.octree.parseOct(t),o.triangles.length=0}else{console.log("Did not find an octree to load from "+n+". Generating it from scratch.");let t=new r.default([1/0,1/0,1/0]),a=new r.default([-1/0,-1/0,-1/0]);for(let e of i)for(let s of e.getTransformedVertices())a.max(s),t.min(s);o.octree=new h.default(t,a,e,s)}}for(;null!=o.octree&&null!=o.triangles&&o.triangles.length>0&&Date.now()-i<n;)o.octree.addShape(o.triangles.pop());return null!=o.triangles&&0==o.triangles.length&&o.octree.prune(),{octree:o.octree,doneLoading:null!=o.triangles&&0==o.triangles.length}}))}downloadOctrees(){for(let t of this.octreeMap){let e=t[1].octree.getDataString();u.WebUtils.DownloadFile(t[0].split("/").pop().split(".")[0]+".oct",e)}}parseObjContent(t){return i(this,void 0,void 0,(function*(){const e=yield fetch(t),s=(yield e.text()).split("\n");let i=new Array,o=new Array,a=new Array,l=new Array;for(let t of s)if(t=t.trim(),t.startsWith("vt")){const e=t.split(/\s+/).filter((t=>"vt"!=t));o.push(new n.default([parseFloat(e[0]),parseFloat(e[1])]))}else if(t.startsWith("vn")){const e=t.split(/\s+/).filter((t=>"vn"!=t));a.push(new r.default([parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]))}else if(t.startsWith("v")){const e=t.split(/\s+/).filter((t=>"v"!=t));i.push(new r.default([parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2])]))}else if(t.startsWith("f")){const e=t.split(/\s+/).filter((t=>"f"!=t));for(let t=0;t<e.length-2;t++)for(let s=0;s<3;s++){const i=e[0==s?0:t+s].split("/"),n=l.push({posIndex:NaN,texCoordIndex:NaN,normalIndex:NaN});i.length>0&&(l[n-1].posIndex=parseInt(i[0])-1),i.length>1&&(l[n-1].texCoordIndex=parseInt(i[1])-1),i.length>2&&(l[n-1].normalIndex=parseInt(i[2])-1)}}else t.startsWith("#")||t.length;let h=new Float32Array(8*l.length);for(let t=0;t<l.length;t++)isNaN(l[t].posIndex)?(h[8*t]=0,h[8*t+1]=0,h[8*t+2]=0):(h[8*t]=i[l[t].posIndex].x,h[8*t+1]=i[l[t].posIndex].y,h[8*t+2]=i[l[t].posIndex].z),isNaN(l[t].normalIndex)?(h[8*t+3]=1,h[8*t+4]=0,h[8*t+5]=0):(h[8*t+3]=a[l[t].normalIndex].x,h[8*t+4]=a[l[t].normalIndex].y,h[8*t+5]=a[l[t].normalIndex].z),isNaN(l[t].texCoordIndex)?(h[8*t+6]=0,h[8*t+7]=0):(h[8*t+6]=o[l[t].texCoordIndex].x,h[8*t+7]=o[l[t].texCoordIndex].y);return h}))}}},2770:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9831),n=s(7267);e.default=class{constructor(){this.textures=new Map,this.cubeMaps=new Map}getTexture(t){let e=this.textures.get(t);if(e)return e;let s=new n.default;return s.loadFromFile(t),this.textures.set(t,s),s}getCubeMap(t){let e=this.cubeMaps.get(t);if(e)return e;let s=new i.default;return s.loadCubemap([t+"/right.png",t+"/left.png",t+"/bottom.png",t+"/top.png",t+"/front.png",t+"/back.png"]),this.cubeMaps.set(t,s),s}}},6809:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.sounds={},this.active=!1;for(let t in this.sounds)this.sounds[t].preload="auto"}playSound(t,e){this.sounds[t].loop=e,this.active&&this.sounds[t].play()}setVolume(t,e){this.sounds[t].volume=e}setTime(t,e){this.sounds[t].currentTime=e}pauseSound(t){this.sounds[t].pause()}stopAll(){}}},2936:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(1099),r=s(9894);e.default=class{constructor(t){this.pos=new r.default,this.dir=new r.default([0,0,-1]),this.viewMatrix=new Matrix4(null),this.viewMatrixNeedsUpdate=!0,this.projectionMatrix=new Matrix4(null),this.projMatrixNeedsUpdate=!0,this.ratio=16/9,this.fov=85,this.viewProjMatrix=new Matrix4(null)}getViewProjMatrix(){return this.updateViewProjMatrix(),this.viewProjMatrix}getViewMatrix(){return this.updateViewProjMatrix(),this.viewMatrix}getProjectionMatrix(){return this.updateViewProjMatrix(),this.projectionMatrix}getPosition(){return this.pos}getDir(){return this.dir}getRight(){let t=new r.default(this.dir),e=new r.default([0,1,0]);return t.cross(e),t.normalize(),t}setPosition(t,e,s){this.pos.x=t,this.pos.y=e,null!=s&&(this.pos.z=s),this.viewMatrixNeedsUpdate=!0}translate(t,e,s){this.pos.x+=t,this.pos.y+=e,this.pos.z+=s,this.viewMatrixNeedsUpdate=!0}setDir(t,e,s){this.dir.x=t,this.dir.y=e,this.dir.z=s,this.dir.normalize(),this.viewMatrixNeedsUpdate=!0}setFOV(t){this.fov=t,this.projMatrixNeedsUpdate=!0}setAspectRatio(t){this.ratio=t,this.projMatrixNeedsUpdate=!0}updateViewProjMatrix(){let t=!1;this.viewMatrixNeedsUpdate&&(this.viewMatrix.setLookAt(this.pos.x,this.pos.y,this.pos.z,this.pos.x+this.dir.x,this.pos.y+this.dir.y,this.pos.z+this.dir.z,0,1,0),this.viewMatrixNeedsUpdate=!1,t=!0),this.projMatrixNeedsUpdate&&(this.projectionMatrix.setPerspective(this.fov,this.ratio,.01,1e3),this.projMatrixNeedsUpdate=!1,t=!0),t&&(this.viewProjMatrix.set(this.projectionMatrix),this.viewProjMatrix=this.viewProjMatrix.concat(this.viewMatrix))}bindViewProjMatrix(t,e=!1){if(this.updateViewProjMatrix(),e){let e=new Matrix4(this.projectionMatrix),s=(new n.default).fromMatrix4(this.viewMatrix).toMatrix4();e.concat(s),i.gl.uniformMatrix4fv(t,!1,e.elements)}else i.gl.uniformMatrix4fv(t,!1,this.viewProjMatrix.elements)}}},1691:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894),n=s(161),r=s(2703);class o extends r.Component{constructor(){super(r.ComponentTypeEnum.BOUNDINGBOX),this.boundingBox=new n.default}setup(t){let e=new i.default([1/0,1/0,1/0]),s=new i.default([-1/0,-1/0,-1/0]),n=t.getVertexPositions();for(let t of n)s.max(t),e.min(t);this.boundingBox.setMinAndMaxVectors(e,s)}updateTransformMatrix(t){t?this.boundingBox.setTransformMatrix(t):this.boundingBox.setUpdateNeeded()}}e.default=o},8190:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703);class n extends i.Component{constructor(){super(i.ComponentTypeEnum.COLLISION),this.isStatic=!1,this.isImmovable=!1}}e.default=n},2703:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.Component=e.ComponentTypeEnum=void 0,(s=e.ComponentTypeEnum||(e.ComponentTypeEnum={}))[s.BOUNDINGBOX=0]="BOUNDINGBOX",s[s.CAMERAFOCUS=1]="CAMERAFOCUS",s[s.COLLISION=2]="COLLISION",s[s.GRAPHICS=3]="GRAPHICS",s[s.MESHCOLLISION=4]="MESHCOLLISION",s[s.MOVEMENT=5]="MOVEMENT",s[s.PARTICLESPAWNER=6]="PARTICLESPAWNER",s[s.POINTLIGHT=7]="POINTLIGHT",s[s.POSITION=8]="POSITION",s[s.POSITIONPARENT=9]="POSITIONPARENT",s[s.DELIVERYZONE=10]="DELIVERYZONE",e.Component=class{constructor(t){this._type=t}get type(){return this._type}}},2129:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703);class n extends i.Component{constructor(t){super(i.ComponentTypeEnum.GRAPHICS),this.object=t}}e.default=n},1078:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703),n=s(1514),r=s(9894);class o extends i.Component{constructor(t,e){super(i.ComponentTypeEnum.MESHCOLLISION),this.octree=t,e&&this.setup(e,.1,100)}setup(t,e,s){let i=new Array;t.setupTriangles(i);let o=new r.default([1/0,1/0,1/0]),a=new r.default([-1/0,-1/0,-1/0]);for(let t of i)for(let e of t.getTransformedVertices())a.max(e),o.min(e);this.octree=new n.default(o,a,e,s),this.octree.addShapes(i),this.octree.prune()}}e.default=o},4359:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703),n=s(9894);class r extends i.Component{constructor(){super(i.ComponentTypeEnum.MOVEMENT),this.constantAcceleration=new n.default([0,-9.8,0]),this.accelerationDirection=new n.default,this.acceleration=6,this.velocity=new n.default,this.drag=4,this.onGround=!1,this.jumpPower=5,this.jumpRequested=!1,this.jumpAllowed=!1}}e.default=r},7697:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703);class n extends i.Component{constructor(t){super(i.ComponentTypeEnum.PARTICLESPAWNER),this.lifeTime=1,this.resetTimer=0,this.particleSpawner=t}}e.default=n},3889:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703),n=s(9894);class r extends i.Component{constructor(t){super(t||i.ComponentTypeEnum.POSITION),this.position=new n.default,this.rotation=new n.default,this.scale=new n.default([1,1,1]),this.origin=new n.default,this.matrix=new Matrix4(null)}calculateMatrix(t){if(t.translate(this.position.x,this.position.y,this.position.z),this.rotation.length2()>1e-7){let e=new n.default(this.rotation);e.normalize(),t.rotate(this.rotation.len(),e.x,e.y,e.z)}t.scale(this.scale.x,this.scale.y,this.scale.z),t.translate(-this.origin.x,-this.origin.y,-this.origin.z)}}e.default=r},8293:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4676),n=s(380),r=s(6828),o=s(8805),a=s(3202),l=s(3481),h=s(467),u=s(5864);e.default=class{constructor(t){this.camera=t.camera,this.rendering=t,this.systems=new Map,this.entityCounter=0,this.entities=new Array,this.entityAdditionQueue=new Array,this.entityDeletionQueue=new Array,this.componentAdditionQueue=new Array,this.componentRemovalQueue=new Array,this.initializeSystems()}initializeSystems(){this.systems.set("COLLISION",new i.default),this.systems.set("MOVEMENT",new n.default),this.systems.set("POSITIONMATRIXUPDATE",new h.default),this.systems.set("GRAPHICS",new r.default),this.systems.set("PARTICLE",new o.default),this.systems.set("CAMERAFOCUS",new l.default(this.rendering.camera)),this.systems.set("DELIVERY",new u.default)}update(t){this.addQueuedEntities(),this.addQueuedComponents(),this.removeComponents(),this.removeEntitiesMarkedForDeletion(),this.systems.get("MOVEMENT").update(t),this.systems.get("POSITIONMATRIXUPDATE").update(t),this.systems.get("GRAPHICS").update(t),this.systems.get("COLLISION").update(t),this.systems.get("DELIVERY").update(t)}updateRenderingSystems(t){this.systems.get("PARTICLE").update(t),this.systems.get("CAMERAFOCUS").update(t)}createEntity(){const t=this.entityAdditionQueue.push(new a.default(this.entityCounter++));return this.entityAdditionQueue[t-1]}addComponent(t,e){this.componentAdditionQueue.push({entity:t,component:e})}removeEntity(t){this.entityDeletionQueue.push(t)}removeComponent(t,e){this.componentRemovalQueue.push({entity:t,componentType:e})}getEntity(t){for(const e of this.entities)if(e.id==t)return e;return null}getSystem(t){return this.systems.get(t)}addQueuedEntities(){for(const t of this.entityAdditionQueue){const e=this.entities.push(t);for(let t of this.systems)t[1].addEntity(this.entities[e-1])}this.entityAdditionQueue.length=0}addQueuedComponents(){for(const t of this.componentAdditionQueue)if(t.entity.addComponent(t.component))for(let e of this.systems)e[1].containsEntity(t.entity.id)||e[1].addEntity(t.entity);this.componentAdditionQueue.length=0}removeEntitiesMarkedForDeletion(){for(let t of this.entityDeletionQueue){for(let e of this.systems)e[1].removeEntity(t);let e=this.entities.findIndex((e=>e.id==this.entityDeletionQueue[t]));-1!=e&&this.entities.splice(e,1)}this.entityDeletionQueue.length=0}removeComponents(){for(const t of this.componentRemovalQueue){t.entity.removeComponent(t.componentType);for(let e of this.systems)e[1].removeFaultyEntity(t.entity.id)}this.componentRemovalQueue.length=0}}},3202:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.id=t,this.components=new Array}addComponent(t){return!this.hasComponent(t.type)&&(this.components.push(t),!0)}hasComponent(t){return this.components.some((e=>e.type==t))}removeComponent(t){let e=this.components.findIndex((e=>e.type==t));-1!=e&&this.components.splice(e,1)}getComponent(t){return this.components.find((e=>e.type==t))}}},3481:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(5502),n=s(2703),r=s(9894);class o extends i.default{constructor(t){super([n.ComponentTypeEnum.POSITION,n.ComponentTypeEnum.CAMERAFOCUS]),this.camera=t}update(t){for(const t of this.entities){let e=t.getComponent(n.ComponentTypeEnum.POSITIONPARENT);e||(e=t.getComponent(n.ComponentTypeEnum.POSITION));let s=t.getComponent(n.ComponentTypeEnum.CAMERAFOCUS),i=new r.default(e.position);i.add(s.offset),this.camera.setPosition(i.x,i.y,i.z),this.camera.setDir(-s.offset.x,-s.offset.y,-s.offset.z)}}}e.default=o},4676:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(5502),n=s(2703),r=s(5436),o=s(9894),a=s(5082);class l extends i.default{constructor(){super([n.ComponentTypeEnum.COLLISION,n.ComponentTypeEnum.BOUNDINGBOX,n.ComponentTypeEnum.POSITION])}update(t){let e=new Array;for(let t of this.entities){let s=t.getComponent(n.ComponentTypeEnum.COLLISION);if(s.isStatic||s.isImmovable)continue;e.length=0;let i=t.getComponent(n.ComponentTypeEnum.BOUNDINGBOX);i.updateTransformMatrix();let l=t.getComponent(n.ComponentTypeEnum.MESHCOLLISION);l&&l.octree.setModelMatrix();for(let s of this.entities){if(t.id==s.id)continue;let o=s.getComponent(n.ComponentTypeEnum.BOUNDINGBOX),a=s.getComponent(n.ComponentTypeEnum.COLLISION);a.isStatic||o.updateTransformMatrix();let h=s.getComponent(n.ComponentTypeEnum.MESHCOLLISION);if(l||h){if(r.IntersectionTester.identifyIntersection([i.boundingBox],[o.boundingBox])){let t=new Array,s=new Array;if(l){l.octree.getShapesForCollision(o.boundingBox,t);for(let e of t)e.setUpdateNeeded()}else t.push(i.boundingBox);if(h){if(h.octree.setModelMatrix(o.boundingBox.getTransformMatrix()),h.octree.getShapesForCollision(i.boundingBox,s),!a.isStatic)for(let t of s)t.setUpdateNeeded()}else s.push(o.boundingBox);r.IntersectionTester.identifyIntersectionInformation(t,s,e)}}else r.IntersectionTester.identifyIntersectionInformation([i.boundingBox],[o.boundingBox],e)}let h=t.getComponent(n.ComponentTypeEnum.MOVEMENT);if(h){h.onGround=!1;for(let t of e){let e=new o.default(t.axis);1==t.shapeB.getTransformedNormals().length&&e.deepAssign(t.shapeB.getTransformedNormals()[0]);let s=h.velocity.dot(e);s<0&&h.velocity.subtract(new o.default(e).multiply(s)),e.y>.5&&(h.onGround=!0)}}let u=t.getComponent(n.ComponentTypeEnum.POSITIONPARENT);u||(u=t.getComponent(n.ComponentTypeEnum.POSITION));let c=a.CollisionSolver.getTranslationNeeded(e);u.position.add(c)}}}e.default=l},6828:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(5502),n=s(2703);class r extends i.default{constructor(){super([n.ComponentTypeEnum.POSITION])}update(t){for(const t of this.entities){let e=t.getComponent(n.ComponentTypeEnum.POSITION),s=t.getComponent(n.ComponentTypeEnum.GRAPHICS),i=t.getComponent(n.ComponentTypeEnum.POSITIONPARENT);s&&e&&(s.object.modelMatrix.setIdentity(),i&&(i.calculateMatrix(s.object.modelMatrix),i.matrix.set(s.object.modelMatrix)),e.calculateMatrix(s.object.modelMatrix));let r=t.getComponent(n.ComponentTypeEnum.POINTLIGHT);r&&e&&(r.pointLight.position.deepAssign(e.position).add(r.posOffset),i&&r.pointLight.position.add(i.position))}}}e.default=r},380:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(5502),n=s(2703),r=s(9894);class o extends i.default{constructor(){super([n.ComponentTypeEnum.POSITION,n.ComponentTypeEnum.MOVEMENT])}update(t){for(const e of this.entities){let s=e.getComponent(n.ComponentTypeEnum.POSITIONPARENT);null==s&&(s=e.getComponent(n.ComponentTypeEnum.POSITION));let i=e.getComponent(n.ComponentTypeEnum.MOVEMENT),o=new r.default(i.velocity);i.velocity.add(new r.default(i.accelerationDirection).multiply(i.acceleration*t)),i.velocity.add(new r.default(i.constantAcceleration).multiply(t)),i.jumpAllowed=i.jumpAllowed||i.onGround,i.jumpAllowed&&i.jumpRequested&&(i.velocity.y=i.jumpPower,i.onGround=!1,i.jumpRequested=!1,i.jumpAllowed=!1);let a=new r.default(i.velocity).multiply(-1);a.y=0;let l=a.len();i.velocity.add(a.normalize().multiply(Math.min(i.drag*t,l))),0==i.accelerationDirection.x&&0==i.accelerationDirection.z&&i.velocity.length2()<.001&&i.velocity.multiply(0);let h=new r.default(i.velocity).add(o).multiply(.5*t);Math.abs(h.x)>.001&&(s.position.x+=h.x),Math.abs(h.y)>.001&&(s.position.y+=h.y),Math.abs(h.z)>.001&&(s.position.z+=h.z),i.accelerationDirection.multiply(0)}}}e.default=o},8805:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(5502),n=s(2703);class r extends i.default{constructor(){super([n.ComponentTypeEnum.PARTICLESPAWNER,n.ComponentTypeEnum.POSITION])}update(t){for(const e of this.entities){let s=e.getComponent(n.ComponentTypeEnum.PARTICLESPAWNER),i=e.getComponent(n.ComponentTypeEnum.POSITION);if(s&&i){let e=Math.floor(s.resetTimer/Math.max(s.lifeTime,1e-5)*s.particleSpawner.getNumberOfParticles());s.resetTimer+=t;let n=Math.floor(s.resetTimer/Math.max(s.lifeTime,1e-5)*s.particleSpawner.getNumberOfParticles());for(;e<n;e++)s.particleSpawner.resetParticleStartTime(e%s.particleSpawner.getNumberOfParticles()),s.particleSpawner.setParticleStartPosition(e%s.particleSpawner.getNumberOfParticles(),i.position);s.resetTimer>s.lifeTime&&(s.resetTimer-=s.lifeTime)}}}}e.default=r},467:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(5502),n=s(2703);class r extends i.default{constructor(){super([n.ComponentTypeEnum.POSITION])}update(t){for(const t of this.entities){let e=t.getComponent(n.ComponentTypeEnum.POSITION);e.matrix.setIdentity(),e.calculateMatrix(e.matrix)}}}e.default=r},5502:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(t){this.requiredComponents=t,this.entities=new Array}entityHasCorrectComponents(t){for(const e of this.requiredComponents)if(!t.hasComponent(e))return!1;return!0}addEntity(t){return!!this.entityHasCorrectComponents(t)&&(this.entities.push(t),!0)}containsEntity(t){return this.entities.some((e=>e.id==t))}removeFaultyEntity(t){const e=this.entities.findIndex((e=>e.id==t));-1!=e&&(this.entityHasCorrectComponents(this.entities[e])||this.entities.splice(e,1))}removeEntity(t){const e=this.entities.findIndex((e=>e.id==t));-1!=e&&this.entities.splice(e,1)}update(t){}}},3183:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831);e.default=class{constructor(t,e,s,n){this.width=t,this.height=e,this.textures=s,this.depthTexture=n,this.fbo=i.gl.createFramebuffer(),i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,this.fbo),this.setupAttachments(),i.gl.checkFramebufferStatus(i.gl.FRAMEBUFFER)!=i.gl.FRAMEBUFFER_COMPLETE&&console.warn("ERROR::FRAMEBUFFER:: Framebuffer is not complete!"),i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,null)}setupAttachments(){let t=new Array;for(let e=0;e<this.textures.length;e++)this.textures[e].setTextureData(null,this.width,this.height),this.textures[e].setTexParameterI(i.gl.TEXTURE_MIN_FILTER,i.gl.LINEAR),this.textures[e].setTexParameterI(i.gl.TEXTURE_MAG_FILTER,i.gl.LINEAR),this.textures[e].setTexParameterI(i.gl.TEXTURE_WRAP_S,i.gl.CLAMP_TO_EDGE),this.textures[e].setTexParameterI(i.gl.TEXTURE_WRAP_T,i.gl.CLAMP_TO_EDGE),i.gl.framebufferTexture2D(i.gl.FRAMEBUFFER,i.gl.COLOR_ATTACHMENT0+e,i.gl.TEXTURE_2D,this.textures[e].texture,0),t.push(i.gl.COLOR_ATTACHMENT0+e);i.gl.drawBuffers(t),null!=this.depthTexture?(this.depthTexture.setTextureData(null,this.width,this.height),i.gl.framebufferTexture2D(i.gl.FRAMEBUFFER,i.gl.DEPTH_ATTACHMENT,i.gl.TEXTURE_2D,this.depthTexture.texture,0)):(this.rbo=i.gl.createRenderbuffer(),i.gl.bindRenderbuffer(i.gl.RENDERBUFFER,this.rbo),i.gl.renderbufferStorage(i.gl.RENDERBUFFER,i.gl.DEPTH_STENCIL,this.width,this.height),i.gl.framebufferRenderbuffer(i.gl.FRAMEBUFFER,i.gl.DEPTH_STENCIL_ATTACHMENT,i.gl.RENDERBUFFER,this.rbo))}setProportions(t,e){this.width=t,this.height=e;for(let t of this.textures)t.setTextureData(null,this.width,this.height);this.depthTexture&&this.depthTexture.setTextureData(null,this.width,this.height),this.rbo&&(i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,this.fbo),i.gl.bindRenderbuffer(i.gl.RENDERBUFFER,this.rbo),i.gl.renderbufferStorage(i.gl.RENDERBUFFER,i.gl.DEPTH24_STENCIL8,t,e),i.gl.bindFramebuffer(i.gl.FRAMEBUFFER,null))}bind(t){i.gl.bindFramebuffer(t,this.fbo)}}},4712:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9185),n=s(133);class r extends n.default{constructor(){super("floating-div"),this.position=new i.default,this.textSize=42,this.inputNode=document.createElement("input"),this.inputNode.type="button",this.inputNode.className="button",this.div.appendChild(this.inputNode)}getElement(){return this.div}getInputElement(){return this.inputNode}onClick(t){this.inputNode.addEventListener("click",t)}draw(){this.position2D=this.position,this.inputNode.value=this.textString,this.fontSize=this.textSize,this.drawObject()}}e.default=r},2208:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9185),n=s(133);class r extends n.default{constructor(){super("floating-div"),this.position=new i.default,this.textSize=42,this.inputNode=document.createElement("input"),this.inputNode.type="checkbox",this.label=document.createElement("label"),this.label.textContent=this.textString,this.div.appendChild(this.label),this.div.appendChild(this.inputNode)}getElement(){return this.div}getInputElement(){return this.inputNode}getChecked(){return this.inputNode.checked}draw(){this.position2D=this.position,this.fontSize=this.textSize,this.label.textContent=this.textString,this.drawObject()}}e.default=r},133:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(9185);e.default=class{constructor(t){this.removed=!1,this.position2D=new n.default,this.fontSize=42,this.scaleWithWindow=!0,this.textString="",this.center=!1,this.divContainerElement=document.getElementById("guicontainer"),this.div=document.createElement("div"),this.div.className=t,this.divContainerElement.appendChild(this.div)}getElement(){return this.div}setHidden(t){this.div.hidden=t}remove(){this.div.remove(),this.removed=!0}drawObject(){this.div.style.left=100*this.position2D.x+"%",this.div.style.top=100*this.position2D.y+"%",this.scaleWithWindow?this.div.style.fontSize=this.fontSize*(i.windowInfo.resolutionHeight/1080)+"px":this.div.style.fontSize=this.fontSize+"px",this.center&&(this.div.style.transform="translate(-50%,-50%)")}draw(){}}},6905:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(133),n=s(9185);class r extends i.default{constructor(){super("floating-div"),this.position=new n.default,this.size=42,this.progressNode=document.createElement("progress"),this.div.appendChild(this.progressNode)}getProgressElement(){return this.progressNode}draw(){this.position2D=this.position,this.fontSize=this.size,this.progressNode.textContent=this.textString,this.drawObject()}}e.default=r},5111:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9185),n=s(133);class r extends n.default{constructor(){super("floating-div"),this.position=new i.default,this.textSize=42,this.inputNode=document.createElement("input"),this.inputNode.type="range",this.label=document.createElement("label"),this.label.textContent=this.textString,this.div.appendChild(this.label),this.div.appendChild(this.inputNode)}getElement(){return this.div}getInputElement(){return this.inputNode}getValue(){return Number(this.inputNode.value)}draw(){this.position2D=this.position,this.fontSize=this.textSize,this.label.textContent=this.textString,this.drawObject()}}e.default=r},607:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9185),n=s(133);class r extends n.default{constructor(){super("floating-div"),this.position=new i.default,this.size=42,this.textNode=document.createTextNode(""),this.div.appendChild(this.textNode)}draw(){this.position2D=this.position,this.fontSize=this.size,this.textNode.textContent=this.textString,this.drawObject()}}e.default=r},4443:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894),n=s(133);class r extends n.default{constructor(){super("floating-div"),this.position=new i.default,this.size=42,this.scaleFontWithDistance=!0,this.textNode=document.createTextNode(""),this.div.appendChild(this.textNode)}draw3D(t){let e=new Vector4([this.position.x,this.position.y,this.position.z,1]),s=t.multiplyVector4(e);if(s.elements[0]=(s.elements[0]/s.elements[3]+1)/2,s.elements[1]=1-(s.elements[1]/s.elements[3]+1)/2,s.elements[2]>0){this.position2D.x=s.elements[0],this.position2D.y=s.elements[1];let t=this.size;this.scaleFontWithDistance&&(t=this.size/s.elements[2]),this.fontSize=t,this.div.hidden=!1,this.textNode.textContent=this.textString,this.drawObject()}else this.div.hidden=!0}}e.default=r},5196:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(607),r=s(9185);e.default=class{constructor(){this.keys=[],this.buttons=new Map,this.gamepads=new Array,this.mousePosition={x:0,y:0,previousX:0,previousY:0},this.mousePositionOnCanvas={x:0,y:0,previousX:0,previousY:0},this.mouseClicked=!1,this.mouseMovementSinceLast=new r.default,this.simulateTouchBasedOnMouse=!1,this.touchUsed=!1;let t=this;document.addEventListener("keydown",(function(e){t.keys[e.key.toUpperCase()]=!0,t.touchUsed=!1})),document.addEventListener("keyup",(function(e){t.keys[e.key.toUpperCase()]=!1,t.touchUsed=!1})),document.addEventListener("mousemove",(function(e){t.mouseMovementSinceLast.x+=e.movementX,t.mouseMovementSinceLast.y+=e.movementY,t.mousePosition={x:e.clientX,y:e.clientY,previousX:t.mousePosition.x,previousY:t.mousePosition.y},t.mousePositionOnCanvas={x:t.mousePosition.x-i.windowInfo.paddingX,y:t.mousePosition.y-i.windowInfo.paddingY,previousX:t.mousePositionOnCanvas.x,previousY:t.mousePositionOnCanvas.y},t.simulateTouchBasedOnMouse&&t.mouseClicked&&t.handleTouch([e])})),document.addEventListener("mousedown",(e=>{t.mouseClicked=!0,t.simulateTouchBasedOnMouse&&t.handleTouch([e])})),document.addEventListener("mouseup",(e=>{t.mouseClicked=!1,t.simulateTouchBasedOnMouse&&t.handleTouch([])})),document.addEventListener("touchstart",(function(e){t.handleTouch(e.touches)})),document.addEventListener("touchmove",(function(e){e.preventDefault(),t.handleTouch(e.touches)})),document.addEventListener("touchend",(function(e){t.handleTouch(e.touches)})),this.joystickLeftDirection=new r.default,this.joystickRightDirection=new r.default,this.repositionTouchControls=!1,this.joystickLeftRadius=.1,this.joystickRightRadius=.1,this.screenAspectRatio=16/9,this.joystickLeftBorder=new n.default,this.joystickLeftBorder.center=!0,this.joystickLeftBorder.scaleWithWindow=!0,this.joystickLeftBorder.position=new r.default([.15,.8]),this.joystickLeftBorder.size=1920*this.joystickLeftRadius*2,this.joystickLeftBorder.textString="⊕",this.joystickLeftBorder.getElement().style.opacity="50%",this.joystickLeftBorder.setHidden(!0),this.joystickLeftCenter=new n.default,this.joystickLeftCenter.center=!0,this.joystickLeftCenter.scaleWithWindow=!0,this.joystickLeftCenter.position=new r.default(this.joystickLeftBorder.position),this.joystickLeftCenter.size=1920*this.joystickLeftRadius,this.joystickLeftCenter.textString="⚫",this.joystickLeftCenter.getElement().style.opacity="50%",this.joystickLeftCenter.getElement().style.color="red",this.joystickLeftCenter.setHidden(!0),this.joystickRightBorder=new n.default,this.joystickRightBorder.center=!0,this.joystickRightBorder.scaleWithWindow=!0,this.joystickRightBorder.position=new r.default([.85,.8]),this.joystickRightBorder.size=1920*this.joystickRightRadius*2,this.joystickRightBorder.textString="⊕",this.joystickRightBorder.getElement().style.opacity="50%",this.joystickRightBorder.setHidden(!0),this.joystickRightCenter=new n.default,this.joystickRightCenter.center=!0,this.joystickRightCenter.scaleWithWindow=!0,this.joystickRightCenter.position=new r.default(this.joystickRightBorder.position),this.joystickRightCenter.size=1920*this.joystickRightRadius,this.joystickRightCenter.textString="⚫",this.joystickRightCenter.getElement().style.opacity="50%",this.joystickRightCenter.getElement().style.color="red",this.joystickRightCenter.setHidden(!0),this.buttonRadius=.05,this.aButton=new n.default,this.aButton.center=!0,this.aButton.scaleWithWindow=!0,this.aButton.position.x=.65,this.aButton.position.y=.8,this.aButton.size=1920*this.buttonRadius*2,this.aButton.textString="🔴",this.aButton.getElement().style.opacity="50%",this.aButton.setHidden(!0),this.bButton=new n.default,this.bButton.center=!0,this.bButton.scaleWithWindow=!0,this.bButton.position.x=.75,this.bButton.position.y=.55,this.bButton.size=1920*this.buttonRadius*2,this.bButton.textString="🔵",this.bButton.getElement().style.opacity="50%",this.bButton.setHidden(!0)}handleTouch(t){this.touchUsed=!0;let e=0!=this.joystickLeftDirection.x||0!=this.joystickLeftDirection.y;this.joystickLeftDirection.x=0,this.joystickLeftDirection.y=0;let s=0!=this.joystickRightDirection.x||0!=this.joystickRightDirection.y;this.joystickRightDirection.x=0,this.joystickRightDirection.y=0;for(const t of this.buttons.keys())this.buttons.set(t,!1);var n=i.windowInfo.paddingX,o=i.windowInfo.paddingY;let a=i.windowInfo.resolutionWidth,l=i.windowInfo.resolutionHeight,h=a*this.joystickLeftRadius,u=new r.default([n+a*this.joystickLeftBorder.position.x,o+l*this.joystickLeftBorder.position.y]),c=a*this.joystickRightRadius,d=new r.default([n+a*this.joystickRightBorder.position.x,o+l*this.joystickRightBorder.position.y]),g=new r.default([n+a*this.aButton.position.x,o+l*this.aButton.position.y]),f=new r.default([n+a*this.bButton.position.x,o+l*this.bButton.position.y]);for(let i of t){let t=new r.default([i.clientX,i.clientY]);if(new r.default(t).subtract(g).len()<this.buttonRadius*a){this.repositionTouchControls?(this.aButton.position.x=(t.x-n)/a,this.aButton.position.y=(t.y-o)/l):this.buttons.set("A",!0);continue}if(new r.default(t).subtract(f).len()<this.buttonRadius*a){this.repositionTouchControls?(this.bButton.position.x=(t.x-n)/a,this.bButton.position.y=(t.y-o)/l):this.buttons.set("B",!0);continue}let m=new r.default(t).subtract(u);(e||m.len()<h)&&t.x<n+.5*a&&(this.repositionTouchControls?(this.joystickLeftBorder.position.x=(t.x-n)/a,this.joystickLeftBorder.position.y=(t.y-o)/l):(this.joystickLeftDirection.x=m.x/h,this.joystickLeftDirection.y=m.y/h));let p=new r.default(t).subtract(d);(s||p.len()<c)&&t.x>n+.5*a&&(this.repositionTouchControls?(this.joystickRightBorder.position.x=(t.x-n)/a,this.joystickRightBorder.position.y=(t.y-o)/l):(this.joystickRightDirection.x=p.x/c,this.joystickRightDirection.y=p.y/c))}}getMouseMovement(){let t=new r.default(this.mouseMovementSinceLast);return this.mouseMovementSinceLast.setValues(0,0),t}updateGamepad(){if(window.isSecureContext){this.gamepads=navigator.getGamepads();for(const t of this.gamepads)if(t){this.touchUsed=!1,Math.abs(t.axes[0])>.1?this.joystickLeftDirection.x=t.axes[0]:this.joystickLeftDirection.x=0,Math.abs(t.axes[1])>.1?this.joystickLeftDirection.y=t.axes[1]:this.joystickLeftDirection.y=0,this.touchUsed=!1,Math.abs(t.axes[2])>.1?this.joystickRightDirection.x=t.axes[2]:this.joystickRightDirection.x=0,Math.abs(t.axes[3])>.1?this.joystickRightDirection.y=t.axes[3]:this.joystickRightDirection.y=0;for(const t of this.buttons.keys())this.buttons.set(t,!1);t.buttons[0].value>.5&&(this.buttons.set("A",!0),console.log("Pressed A")),t.buttons[1].value>.5&&(this.buttons.set("B",!0),console.log("Pressed B"))}}}drawTouchControls(){this.joystickLeftBorder.setHidden(!this.touchUsed),this.joystickLeftCenter.setHidden(!this.touchUsed),this.joystickRightBorder.setHidden(!this.touchUsed),this.joystickRightCenter.setHidden(!this.touchUsed),this.aButton.setHidden(!this.touchUsed),this.bButton.setHidden(!this.touchUsed),this.touchUsed&&(this.joystickLeftCenter.position.x=this.joystickLeftBorder.position.x+this.joystickLeftDirection.x*this.joystickLeftRadius,this.joystickLeftCenter.position.y=this.joystickLeftBorder.position.y+this.joystickLeftDirection.y*(this.joystickLeftRadius*this.screenAspectRatio)-.01,this.joystickRightCenter.position.x=this.joystickRightBorder.position.x+this.joystickRightDirection.x*this.joystickRightRadius,this.joystickRightCenter.position.y=this.joystickRightBorder.position.y+this.joystickRightDirection.y*(this.joystickRightRadius*this.screenAspectRatio)-.01,this.joystickLeftBorder.draw(),this.joystickLeftCenter.draw(),this.joystickRightBorder.draw(),this.joystickRightCenter.draw(),this.aButton.draw(),this.bButton.draw())}}},9775:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(9894);e.default=class{constructor(t,e){this.shaderProgram=e,this.direction=new n.default([0,-1,-.5]),this.colour=new n.default([.2,.2,.2]),this.ambientMultiplier=.1,this.lightProjectionBoxSideLength=50}bind(){i.gl.uniform3fv(this.shaderProgram.getUniformLocation("directionalLight.direction")[0],this.direction.normalize()),i.gl.uniform3fv(this.shaderProgram.getUniformLocation("directionalLight.colour")[0],this.colour),i.gl.uniform1f(this.shaderProgram.getUniformLocation("directionalLight.ambientMultiplier")[0],this.ambientMultiplier)}calcAndSendLightSpaceMatrix(t,e,s){let r=new n.default(t),o=new n.default(this.direction).normalize().multiply(e),a=new Matrix4(null).setOrtho(-this.lightProjectionBoxSideLength,this.lightProjectionBoxSideLength,-this.lightProjectionBoxSideLength,this.lightProjectionBoxSideLength,.1,2*e);r.subtract(o);let l=new Matrix4(null).setLookAt(r.x,r.y,r.z,t.x,t.y,t.z,0,1,0);a=a.concat(l),i.gl.uniformMatrix4fv(s,!1,a.elements)}}},9308:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(9894);e.default=class{constructor(t,e){this.shaderProgram=e,this.position=new n.default([0,0,0]),this.colour=new n.default([1,1,1]),this.constant=1,this.linear=.07,this.quadratic=.017}bind(t){let e=this.shaderProgram.getUniformLocation("pointLights["+t+"].position");e[1]&&i.gl.uniform3fv(e[0],this.position),e=this.shaderProgram.getUniformLocation("pointLights["+t+"].colour"),e[1]&&i.gl.uniform3fv(e[0],this.colour),e=this.shaderProgram.getUniformLocation("pointLights["+t+"].constant"),e[1]&&i.gl.uniform1f(e[0],this.constant),e=this.shaderProgram.getUniformLocation("pointLights["+t+"].linear"),e[1]&&i.gl.uniform1f(e[0],this.linear),e=this.shaderProgram.getUniformLocation("pointLights["+t+"].quadratic"),e[1]&&i.gl.uniform1f(e[0],this.quadratic)}}},1099:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894);class n{constructor(){this.elements=new Array,this.elements.length=9,this.elements[0]=1,this.elements[3]=0,this.elements[6]=0,this.elements[1]=0,this.elements[4]=1,this.elements[7]=0,this.elements[2]=0,this.elements[5]=0,this.elements[8]=1}fromMatrix4(t){return this.elements[0]=t.elements[0],this.elements[3]=t.elements[4],this.elements[6]=t.elements[8],this.elements[1]=t.elements[1],this.elements[4]=t.elements[5],this.elements[7]=t.elements[9],this.elements[2]=t.elements[2],this.elements[5]=t.elements[6],this.elements[8]=t.elements[10],this}toMatrix4(){let t=new Matrix4(null);return t.elements[0]=this.elements[0],t.elements[4]=this.elements[3],t.elements[8]=this.elements[6],t.elements[1]=this.elements[1],t.elements[5]=this.elements[4],t.elements[9]=this.elements[7],t.elements[2]=this.elements[2],t.elements[6]=this.elements[5],t.elements[10]=this.elements[8],t}multiplyVec3(t){let e=this.elements,s=new i.default;return s.x=t.x*e[0]+t.y*e[3]+t.z*e[6],s.y=t.x*e[1]+t.y*e[4]+t.z*e[7],s.z=t.x*e[2]+t.y*e[5]+t.z*e[8],s}transpose(){let t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}determinant(){return this.elements[0]*(this.elements[4]*this.elements[8]-this.elements[5]*this.elements[7])-this.elements[4]*(this.elements[1]*this.elements[8]-this.elements[2]*this.elements[7])+this.elements[6]*(this.elements[1]*this.elements[5]-this.elements[2]*this.elements[4])}adj(){let t=new n;return t.elements[0]=this.elements[4]*this.elements[8]-this.elements[5]*this.elements[7],t.elements[3]=-(this.elements[3]*this.elements[8]-this.elements[5]*this.elements[6]),t.elements[6]=this.elements[3]*this.elements[8]-this.elements[5]*this.elements[6],t.elements[1]=-(this.elements[1]*this.elements[8]-this.elements[2]*this.elements[7]),t.elements[4]=this.elements[0]*this.elements[8]-this.elements[2]*this.elements[6],t.elements[7]=-(this.elements[0]*this.elements[5]-this.elements[2]*this.elements[3]),t.elements[2]=this.elements[3]*this.elements[7]-this.elements[4]*this.elements[6],t.elements[5]=-(this.elements[0]*this.elements[6]-this.elements[1]*this.elements[7]),t.elements[8]=this.elements[0]*this.elements[4]-this.elements[1]*this.elements[3],t}invert(){let t=this.determinant();if(0==t)return this;let e=this.adj();for(let s=0;s<9;s++)this.elements[s]=e.elements[s]/t;return this}}e.default=n},7066:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MousePicking=void 0;const i=s(1215),n=s(4831),r=s(3453),o=s(9185),a=s(9894);(e.MousePicking||(e.MousePicking={})).GetRay=function(t){let e=new o.default([i.input.mousePositionOnCanvas.x,i.input.mousePositionOnCanvas.y]);e.x=2*(e.x/n.windowInfo.resolutionWidth-.5),e.y=-2*(e.y/n.windowInfo.resolutionHeight-.5);let s=new Vector4([e.x,e.y,-1,1]),l=new Matrix4(t.getProjectionMatrix()).invert().multiplyVector4(s);l.elements[2]=-1,l.elements[3]=0;let h=new Matrix4(t.getViewMatrix()).invert().multiplyVector4(l),u=new a.default([h.elements[0],h.elements[1],h.elements[2]]).normalize(),c=new r.default;return c.setDir(u),c.setStart(t.getPosition()),c}},2977:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SAT=void 0;const i=s(5),n=s(9894);!function(t){function e(t,e,s,i,n){let r,o=1/0,a=1/0,l=-1/0,h=-1/0,u=0;for(const s of e)u=s.dot(t),o=Math.min(o,u),l=Math.max(l,u);for(const e of s)u=e.dot(t),a=Math.min(a,u),h=Math.max(h,u);let c=t.dot(i);if(h<=o){if(c<=0)return!1;if(r=(o-h)/c,r>n.first&&(n.first=r),n.first>n.max)return!1;if(r=(l-a)/c,r<n.last&&(n.last=r),n.first>n.last)return!1}else if(l<=a){if(c>=0)return!1;if(r=(l-a)/c,r>n.first&&(n.first=r),n.first>n.max)return!1;if(r=(o-h)/c,r<n.last&&(n.last=r),n.first>n.last)return!1}else if(c>0){if(r=(l-a)/c,r<n.last&&(n.last=r),n.first>n.last)return!1}else if(c<0&&(r=(o-h)/c,r<n.last&&(n.last=r),n.first>n.last))return!1;return!0}t.getOverlap=function(t,e,s,i,n){let r=t.dot(e[0]),o=r,a=t.dot(s[0]),l=a,h=0;for(let s=1;s<e.length;s++)h=t.dot(e[s]),h<o&&(o=h),h>r&&(r=h);for(let e=1;e<s.length;e++)h=t.dot(s[e]),h<l&&(l=h),h>a&&(a=h);let u=a-o,c=r-l;return u>=-n&&c>=-n?u>c?(i.value=!0,c):(i.value=!1,u):-1},t.getContinousOverlap=e,t.getIntersectionPoint=function(t,e,s){let i=t.getTransformedVertices(),r=e.getTransformedVertices(),o=new Array,a=new Array,l=new Array,h=new Array,u=s.dot(i[0]);o.push(0);let c=u;a.push(0);let d=s.dot(r[0]);l.push(0);let g=d;h.push(0);let f=0;for(let t=1;t<i.length;t++)f=s.dot(i[t]),f<c?(c=f,a.length=0,a.push(t)):f==c&&a.push(t),f>u?(u=f,o.length=0,o.push(t)):f==u&&o.push(t);for(let t=1;t<r.length;t++)f=s.dot(r[t]),f<g?(g=f,h.length=0,h.push(t)):f==g&&h.push(t),f>d?(d=f,l.length=0,l.push(t)):f==d&&l.push(t);let m=Math.abs(d-c),p=Math.abs(u-g),x=new n.default,w=0;if(m>p){for(const t of o)x.add(i[t]),w++;for(const t of h)x.add(r[t]),w++}else{let t=new n.default,e=0;for(const s of a)t.add(i[s]),e++;for(const s of l)t.add(r[s]),e++}return x.multiply(1/w),x},t.getIntersection3D=function(e,s,i,r){r.depth=1/0;let o=e.getTransformedVertices(),a=s.getTransformedVertices(),l=function(n){let l={value:!1},h=t.getOverlap(n,o,a,l,e.margin+s.margin);return!(h<0||(h<r.depth&&(r.depth=h,i.deepAssign(n),l.value&&i.flip()),0))},h=e.getTransformedNormals();for(let t of h)if(!l(t))return!1;let u=s.getTransformedNormals();for(let t of u)if(!l(t))return!1;if(1==h.length&&1==u.length){let t=new n.default(h[0]).cross(u[0]);if(0==t.x&&0==t.y&&0==t.z){for(const t of e.getTransformedEdgeNormals())if(!l(t))return!1;for(const t of s.getTransformedEdgeNormals())if(!l(t))return!1;return!0}}for(const t of e.getTransformedEdges())for(const e of s.getTransformedEdges()){const s=t.dot(e);if(s<.99&&s>-.99){let s=new n.default;if(s.deepAssign(t),s.cross(e).normalize(),!l(s))return!1}}return!0},t.getContinousIntersection3D=function(t,s,i,r,o){let a=new n.default(r).subtract(i),l={first:0,last:1/0,max:o},h=t.getTransformedVertices(),u=s.getTransformedVertices(),c=t.getTransformedNormals();for(let t of c)if(!e(t,h,u,a,l))return-1;let d=s.getTransformedNormals();for(let t of d)if(!e(t,h,u,a,l))return-1;if(1==c.length&&1==d.length){let i=new n.default(c[0]).cross(d[0]);if(0==i.x&&0==i.y&&0==i.z){for(const s of t.getTransformedEdgeNormals())if(!e(s,h,u,a,l))return-1;for(const t of s.getTransformedEdgeNormals())if(!e(t,h,u,a,l))return-1;return l.first}}for(const i of t.getTransformedEdges())for(const t of s.getTransformedEdges()){const s=i.dot(t);if(s<.99&&s>-.99){let s=new n.default;if(s.deepAssign(i),s.cross(t).normalize(),!e(s,h,u,a,l))return-1}}return l.first},t.runUnitTests=function(){let e=[0,1,0,0,0,0,1,0,0,.5,.5,-.1,.5,.5,1,.5,0,1,5,5,0,5,4,0,6,4,0,1,1,0,1,0,0,2,0,0],s=[{t1Index:0,t2Index:1,depth:.1,axis:new n.default([0,0,-1]),strictDirection:!0},{t1Index:0,t2Index:3,depth:0,axis:new n.default([0,0,1]),strictDirection:!1}],r=[0,2,1,2],o=new Array;for(let t=0;t<e.length;t+=3)o.push(new n.default([e[t],e[t+1],e[t+2]]));let a=new Array;for(let t=0;t<o.length;t+=3){let e=a.push(new i.default);a[e-1].setVertices(o[t],o[t+1],o[t+2])}let l=new n.default,h={depth:0};for(let e=0;e<s.length;e++)t.getIntersection3D(a[s[e].t1Index],a[s[e].t2Index],l,h)?Math.abs(h.depth-s[e].depth)>1e-5?alert("Intersection test returned wrong depth!"):s[e].strictDirection?l.compare(s[e].axis)||alert("Intersection test returned wrong intersection axis!"):l.cross(s[e].axis).compare([0,0,0])||alert("Intersection test returned wrong intersection axis!"):alert("False negative intersection test!"),t.getIntersection3D(a[s[e].t2Index],a[s[e].t1Index],l,h)?Math.abs(h.depth-s[e].depth)>1e-5?alert("Intersection test returned wrong depth!"):s[e].strictDirection?l.flip().compare(s[e].axis)||alert("Intersection test returned wrong intersection axis!"):l.cross(s[e].axis).compare([0,0,0])||alert("Intersection test returned wrong intersection axis!"):alert("False negative intersection test!");for(let e=0;e<r.length;e+=2)(t.getIntersection3D(a[r[e]],a[r[e+1]],new n.default,{depth:0})||t.getIntersection3D(a[r[e+1]],a[r[e]],new n.default,{depth:0}))&&alert("False positive intersection test!")}}(e.SAT||(e.SAT={}))},4438:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class extends Array{constructor(t,e){super(t),e?this.iterate((t=>{this[t]=e[t]})):this.fill(0)}iterate(t){for(let e=0;e<this.length;e++)t(e)}deepAssign(t){return this.iterate((e=>{this[e]=t[e]})),this}compare(t){let e=!0;return this.iterate((s=>{this[s]==t[s]||(e=!1)})),e}len(){return Math.sqrt(this.length2())}length2(){let t=0;return this.iterate((e=>{t+=Math.pow(this[e],2)})),t}normalize(){const t=this.len();return t>0&&this.iterate((e=>{this[e]/=t})),this}dot(t){let e=0;return this.iterate((s=>{e+=this[s]*t[s]})),e}flip(){return this.iterate((t=>{this[t]*=-1})),this}add(t){return this.iterate((e=>{this[e]+=t[e]})),this}subtract(t){return this.iterate((e=>{this[e]-=t[e]})),this}multiply(t){return this.iterate((e=>{this[e]*=t})),this}min(t){return this.iterate((e=>{this[e]=Math.min(this[e],t[e])})),this}max(t){return this.iterate((e=>{this[e]=Math.max(this[e],t[e])})),this}}},9185:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4438);class n extends i.default{constructor(t){super(2,t)}get x(){return this[0]}get y(){return this[1]}set x(t){this[0]=t}set y(t){this[1]=t}setValues(t,e){return null!=t&&(this[0]=t),null!=e&&(this[1]=e),this}}e.default=n},9894:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4438);class n extends i.default{constructor(t){super(3,t)}get x(){return this[0]}get y(){return this[1]}get z(){return this[2]}set x(t){this[0]=t}set y(t){this[1]=t}set z(t){this[2]=t}setValues(t,e,s){return null!=t&&(this[0]=t),null!=e&&(this[1]=e),null!=s&&(this[2]=s),this}cross(t){let e=new n;return e.x=this[1]*t[2]-this[2]*t[1],e.y=this[0]*t[2]-this[2]*t[0],e.z=this[0]*t[1]-this[1]*t[0],this.deepAssign(e),this}}e.default=n},3409:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(7267);e.default=class{constructor(t,e,s,i){this.diffuse=t,this.specular=e,null!=i?this.emission=i:(this.emission=new n.default,this.emission.setTextureData(new Uint8Array([0,0,0,0]),1,1)),this.baseColor=new Vector3([0,0,0]),this.modelMatrix=new Matrix4(null),this.textureMatrix=new Matrix4(null),this.graphicsObject=s}draw(t=!0){this.diffuse.bind(0),t&&(this.specular.bind(1),this.emission.bind(2));let e=this.graphicsObject.shaderProgram.getUniformLocation("baseColor");e[1]&&i.gl.uniform3fv(e[0],this.baseColor.elements);let s=this.graphicsObject.shaderProgram.getUniformLocation("modelMatrix");s[1]&&i.gl.uniformMatrix4fv(s[0],!1,this.modelMatrix.elements);let n=this.graphicsObject.shaderProgram.getUniformLocation("textureMatrix");n[1]&&i.gl.uniformMatrix4fv(n[0],!1,this.textureMatrix.elements),this.graphicsObject.draw()}}},6098:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831);e.default=class{constructor(t){this.shaderProgram=t,this.VAO=null,this.VBO=null,this.EBO=null,this.init()}init(){this.VAO=i.gl.createVertexArray(),this.VBO=i.gl.createBuffer(),this.EBO=i.gl.createBuffer(),i.gl.bindVertexArray(this.VAO),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.VBO),this.shaderProgram.setupVertexAttributePointers(),i.gl.bindVertexArray(null)}bindVAO(){i.gl.bindVertexArray(this.VAO)}unbindVAO(){i.gl.bindVertexArray(null)}setVertexData(t){i.gl.bindVertexArray(this.VAO),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.VBO),i.gl.bufferData(i.gl.ARRAY_BUFFER,t,i.gl.STATIC_DRAW),i.gl.bindVertexArray(null)}setIndexData(t){i.gl.bindVertexArray(this.VAO),i.gl.bindBuffer(i.gl.ELEMENT_ARRAY_BUFFER,this.EBO),i.gl.bufferData(i.gl.ELEMENT_ARRAY_BUFFER,t,i.gl.STATIC_DRAW),i.gl.bindVertexArray(null)}setupTriangles(t){}getVertexPositions(){return null}draw(){}}},7749:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(6098);class r extends n.default{constructor(t,e=0){super(t),this.bindVAO(),this.instanceVBO=i.gl.createBuffer(),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.instanceVBO),i.gl.bufferData(i.gl.ARRAY_BUFFER,7*e*4,i.gl.STATIC_DRAW),t.setupInstancedVertexAttributePointers(),this.unbindVAO(),this.vertices=new Float32Array([0,1,.5,1,-.1,0,0,0,.1,0,1,0]),this.setVertexData(this.vertices),this.numGrassStraws=e}setNumGrassStraws(t){this.numGrassStraws=t,this.bindVAO(),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.instanceVBO),i.gl.bufferData(i.gl.ARRAY_BUFFER,7*this.numGrassStraws*4,i.gl.STATIC_DRAW),this.unbindVAO()}getNumberOfGrassStraws(){return this.numGrassStraws}setGrassStrawData(t,e,s,i){if(t>this.numGrassStraws)return!1;let n=new Float32Array([e.x,e.y,e.z,s,i.x,i.y,i.z]);return this.bufferSubDataUpdate(7*t,n),!0}setGrassStrawPosition(t,e){return!(t>this.numGrassStraws||(this.bufferSubDataUpdate(7*t,new Float32Array(e)),0))}setGrassStrawSize(t,e){return!(t>this.numGrassStraws||(this.bufferSubDataUpdate(7*t+3,new Float32Array([e])),0))}setGrassTipOffset(t,e){return!(t>this.numGrassStraws||(this.bufferSubDataUpdate(7*t+4,new Float32Array(e)),0))}bufferSubDataUpdate(t,e){return!(t<0||t+e.length>7*this.numGrassStraws||(this.bindVAO(),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.instanceVBO),i.gl.bufferSubData(i.gl.ARRAY_BUFFER,4*t,e),this.unbindVAO(),0))}draw(){this.bindVAO(),i.gl.drawArraysInstanced(i.gl.TRIANGLES,0,3,this.numGrassStraws),this.unbindVAO()}}e.default=r},4686:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(4831),r=s(9894),o=s(5),a=s(8333);class l extends a.default{constructor(t){super(t,null),this.xResolution=0,this.zResolution=0,this.createPlane(2,2,1,1),this.imageData=null}setupTriangles(t){t.length=0;for(let e=0;e<this.indices.length;e+=3){const s=t.push(new o.default);t[s-1].setVertices(new r.default([this.vertices[8*this.indices[e]],this.vertices[8*this.indices[e]+1],this.vertices[8*this.indices[e]+2]]),new r.default([this.vertices[8*this.indices[e+1]],this.vertices[8*this.indices[e+1]+1],this.vertices[8*this.indices[e+1]+2]]),new r.default([this.vertices[8*this.indices[e+2]],this.vertices[8*this.indices[e+2]+1],this.vertices[8*this.indices[e+2]+2]]))}}updateVertexData(t,e,s){let i=e*this.xResolution*8+8*t;for(let t=0;t<s.length;t++)this.vertices[i+t]=s[t]}updateVertexHeight(t,e,s){this.vertices[e*this.xResolution*8+8*t+1]=s}calculateVertexNormal(t,e){if(t<1||t>this.xResolution-2||e<1||e>this.zResolution-2)return;let s=new r.default,i=new r.default([0,this.vertices[e*this.xResolution*8+8*t+1],0]),n=[[-1,-1],[1,-1],[1,1],[-1,1]],a=new o.default;for(let o=0;o<4;o++){let l=o,h=(o+1)%4;a.setVertices(new r.default([n[l][0]*this.xQuadSize,this.vertices[(e+n[l][1])*this.xResolution*8+8*(t+n[l][0])+1],n[l][1]*this.zQuadSize]),i,new r.default([n[h][0]*this.xQuadSize,this.vertices[(e+n[h][1])*this.xResolution*8+8*(t+n[h][0])+1],n[h][1]*this.zQuadSize])),s.add(a.getTransformedNormals()[0])}s.normalize();for(let i=0;i<3;i++)this.vertices[e*this.xResolution*8+8*t+3+i]=s[i]}createPlane(t,e,s,i){this.xResolution=Math.max(Math.ceil(t),2),this.zResolution=Math.max(Math.ceil(e),2),this.xQuadSize=s,this.zQuadSize=i,this.vertices=new Float32Array(this.xResolution*this.zResolution*8).fill(0);for(let t=0;t<this.zResolution;t++)for(let e=0;e<this.xResolution;e++)this.updateVertexData(e,t,[e*s,0,t*i,0,1,0,e/(this.xResolution-1),t/(this.zResolution-1)]);this.setVertexData(this.vertices),this.indices=new Int32Array((this.xResolution-1)*(this.zResolution-1)*6).fill(0);for(let t=0;t<this.zResolution-1;t++)for(let e=0;e<this.xResolution-1;e++){let s=t*(this.xResolution-1)*6+6*e,i=t*this.xResolution+e,n=i+this.xResolution;(t+e)%2==0?(this.indices[s+0]=i,this.indices[s+1]=n,this.indices[s+2]=n+1,this.indices[s+3]=i,this.indices[s+4]=n+1,this.indices[s+5]=i+1):(this.indices[s+0]=i,this.indices[s+1]=n,this.indices[s+2]=i+1,this.indices[s+3]=i+1,this.indices[s+4]=n,this.indices[s+5]=n+1)}this.setIndexData(this.indices)}readHeightDataFromTexture(t,e=!0){return i(this,void 0,void 0,(function*(){let s=yield(i=t,new Promise(((t,e)=>{let s=new Image;s.onload=()=>t(s),s.onerror=e,s.src=i})));var i,n,r,o,a,l;e&&this.createPlane(s.width,s.height,1,1),this.imageData=(n=s,r=this.xResolution,o=this.zResolution,l=(a=document.createElement("canvas")).getContext("2d"),a.width=r,a.height=o,l.drawImage(n,0,0,r,o),l.getImageData(0,0,r,o).data);for(let t=0;t<this.zResolution;t++)for(let e=0;e<this.xResolution;e++)this.updateVertexHeight(e,t,this.imageData[4*e+t*this.xResolution*4]/255);for(let t=0;t<this.zResolution;t++)for(let e=0;e<this.xResolution;e++)this.calculateVertexNormal(e,t);this.setVertexData(this.vertices)}))}getNormalFromWorldPosition(t,e,s){let i;i=null!=s?s:new Matrix4(t).invert();let n=s.multiplyVector4(new Vector4([...e,1]));return this.getNormal(n.elements[0],n.elements[2])}getHeightFromWorldPosition(t,e,s){let i;i=null!=s?s:new Matrix4(t).invert();let n=i.multiplyVector4(new Vector4([...e,1])),r=this.getHeight(n.elements[0],n.elements[2]);return null==r?null:(n.elements[1]=r,n.elements[3]=1,n=t.multiplyVector4(n),n.elements[1])}getHeight(t,e){if(t<0||t>this.xResolution*this.xQuadSize||e<0||e>this.zResolution*this.zQuadSize)return null;let s=Math.floor(t/this.xQuadSize),i=Math.floor(e/this.zQuadSize),n=t-s*this.xQuadSize,r=e-i*this.zQuadSize,o=this.imageData[4*(s+1)+(i+0)*this.xResolution*4]/255,a=this.imageData[4*(s+0)+(i+1)*this.xResolution*4]/255,l=this.imageData[4*(s+0)+(i+0)*this.xResolution*4]/255,h=this.imageData[4*(s+1)+(i+1)*this.xResolution*4]/255;return(i+s)%2==0?n>r?(n=1-n,o+(l-o)*n+(h-o)*r):(r=1-r,a+(h-a)*n+(l-a)*r):n<1-r?l+(o-l)*n+(a-l)*r:(n=1-n,r=1-r,h+(a-h)*n+(o-h)*r)}getNormal(t,e){let s=Math.round(t/this.xQuadSize),i=Math.round(e/this.zQuadSize);return s<0||s>this.xResolution-1||i<0||i>this.zResolution-1?null:new r.default([this.vertices[i*this.xResolution*8+8*s+3],this.vertices[i*this.xResolution*8+8*s+4],this.vertices[i*this.xResolution*8+8*s+5]])}getVertices(){return this.vertices}draw(){this.bindVAO(),n.gl.drawElements(n.gl.TRIANGLES,this.indices.length,n.gl.UNSIGNED_INT,0)}}e.default=l},8333:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(6098),n=s(9894),r=s(5),o=s(4831);class a extends i.default{constructor(t,e){super(t),this.vertices=e,this.setVertexData(this.vertices)}setupTriangles(t){t.length=0;for(let e=0;e<this.vertices.length;e+=24){const s=t.push(new r.default);t[s-1].setVertices(new n.default([this.vertices[e],this.vertices[e+1],this.vertices[e+2]]),new n.default([this.vertices[e+8],this.vertices[e+8+1],this.vertices[e+8+2]]),new n.default([this.vertices[e+16],this.vertices[e+16+1],this.vertices[e+16+2]]))}}getVertexPositions(){let t=new Array;for(let e=0;e<this.vertices.length;e+=8)t.push(new n.default([this.vertices[e],this.vertices[e+1],this.vertices[e+2]]));return t}draw(){this.bindVAO(),o.gl.drawArrays(o.gl.TRIANGLES,0,this.vertices.length/8)}}e.default=a},1514:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894),n=s(5436),r=s(161),o=s(5);class a{constructor(t,e){this.obb=new r.default,this.size=t,this.position=e;let s=.5*t;this.obb.setMinAndMaxVectors(new i.default([-s,-s,-s]).add(this.position),new i.default([s,s,s]).add(this.position)),this.children=new Array,this.content=new Array}createChildren(t){let e=.5*this.size;if(0==this.children.length&&e>=t){let t=.25*this.size;for(let s=-1;s<2;s+=2)for(let n=-1;n<2;n+=2)for(let r=-1;r<2;r+=2)this.children.push(new a(e,new i.default([s*t,n*t,r*t]).add(this.position)));return!0}return!1}checkIfContains(t){let e=new i.default(this.position).subtract([this.size/2,this.size/2,this.size/2]),s=new i.default(this.position).add([this.size/2,this.size/2,this.size/2]),n=t.getTransformedVertices();for(let t of n){let i=!0;for(let n=0;n<3;n++)(e[n]>t[n]||t[n]>s[n])&&(i=!1);if(i)return!0}return!1}subdivideTree(t){this.createChildren(t);for(let e of this.children)e.subdivideTree(t)}addShape(t,e,s){if(this.checkIfContains(t)&&n.IntersectionTester.identifyIntersection([t],[this.obb]))if(0==this.children.length&&this.content.length>=s&&this.createChildren(e),0==this.children.length)this.content.push(t);else{for(let t of this.content)for(let i of this.children)i.addShape(t,e,s);this.content.length=0;for(let i of this.children)i.addShape(t,e,s)}}setModelMatrix(t){this.obb.setTransformMatrix(t);for(const e of this.content)e.setTransformMatrix(t);for(const e of this.children)e.setModelMatrix(t)}prune(){for(let t=0;t<this.children.length;t++)this.children[t].prune(),0==this.children[t].content.length&&0==this.children[t].children.length&&(this.children.splice(t,1),t--)}updateBox(){this.obb.setUpdateNeeded();for(const t of this.children)t.updateBox()}getShapesForCollision(t,e){if(n.IntersectionTester.identifyIntersection([t],[this.obb])){for(const s of this.children)s.getShapesForCollision(t,e);for(const t of this.content)e.push(t)}}getShapesForRayCast(t,e,s=1/0){if(n.IntersectionTester.doRayCast(t,[this.obb],s)>=0){for(const i of this.children)i.getShapesForRayCast(t,e,s);for(const t of this.content)e.push(t)}}print(){let t="{\n";t+="s"+this.size+"\n",t+="p"+this.position+"\n",t+="[\n";for(let e of this.content)t+="t["+e.getOriginalVertices()[0]+"], ["+e.getOriginalVertices()[1]+"], ["+e.getOriginalVertices()[2]+"]\n";if(t+="]\n",this.children.length>0)for(let e of this.children)t+=e.print();return t+="}\n",t}}e.default=class{constructor(t,e,s,n){let r=e.x-t.x;r=Math.max(r,e.y-t.y),r=Math.max(r,e.z-t.z),this.baseNode=new a(r,new i.default(t).add(e).multiply(.5)),this.minNodeSize=r*s,this.maxShapesPerNode=n}addShape(t){this.baseNode.addShape(t,this.minNodeSize,this.maxShapesPerNode)}addShapes(t){for(let e of t)this.baseNode.addShape(e,this.minNodeSize,this.maxShapesPerNode)}setModelMatrix(t){t!=this.baseNode.obb.getTransformMatrix()&&(t?this.baseNode.setModelMatrix(t):this.baseNode.updateBox())}prune(){this.baseNode.prune()}getShapesForCollision(t,e){this.baseNode.getShapesForCollision(t,e)}getShapesForRayCast(t,e,s=1/0){this.baseNode.getShapesForRayCast(t,e,s)}getDataString(){let t="";return t+=this.minNodeSize+"\n",t+=this.maxShapesPerNode+"\n",t+=this.baseNode.print(),t}parseOct(t){delete this.baseNode;let e=t.split("\n");this.minNodeSize=parseFloat(e[0]),this.maxShapesPerNode=parseInt(e[1]);let s=this.baseNode,n=0,r=new Array;for(let t=3;t<e.length;t++){let l=e[t];if("{"==l);else if("["==l);else if("]"==l);else if("}"==l)s=r.pop();else if(l.startsWith("s"))l=l.substring(1),n=parseFloat(l);else if(l.startsWith("p")){l=l.substring(1);let t=new i.default(l.split(",").map((t=>parseFloat(t))));if(null==this.baseNode)this.baseNode=new a(n,t),s=this.baseNode;else{r.push(s);let e=s.children.push(new a(n,t));s=s.children[e-1]}}else if(l.startsWith("t")){l=l.substring(1);let t=l.split(", "),e=new o.default;e.setVertices(new i.default(t[0].substring(1,t[0].length-1).split(",").map((t=>parseFloat(t)))),new i.default(t[1].substring(1,t[1].length-1).split(",").map((t=>parseFloat(t)))),new i.default(t[2].substring(1,t[2].length-1).split(",").map((t=>parseFloat(t))))),s.content.push(e)}}}}},9935:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(6098);class r extends n.default{constructor(t,e,s=0){super(t),this.texture=e,this.bindVAO(),this.instanceVBO=i.gl.createBuffer(),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.instanceVBO),i.gl.bufferData(i.gl.ARRAY_BUFFER,11*s*4,i.gl.DYNAMIC_DRAW),t.setupInstancedVertexAttributePointers(),this.unbindVAO(),this.vertices=new Float32Array([-.5,.5,0,1,-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1]),this.indices=new Int32Array([0,1,2,0,2,3]),this.setVertexData(this.vertices),this.setIndexData(this.indices),this.numParticles=s,this.fadePerSecond=0,this.sizeChangePerSecond=1}setNumParticles(t){this.numParticles=t,this.bindVAO(),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.instanceVBO),i.gl.bufferData(i.gl.ARRAY_BUFFER,11*this.numParticles*4,i.gl.DYNAMIC_DRAW),this.unbindVAO()}getNumberOfParticles(){return this.numParticles}setParticleData(t,e,s,n,r){if(t>this.numParticles)return!1;let o=new Float32Array([e.x,e.y,e.z,s,n.x,n.y,n.z,.001*(Date.now()-i.applicationStartTime),r.x,r.y,r.z]);return this.bufferSubDataUpdate(11*t,o),!0}setParticleStartPosition(t,e){return!(t>this.numParticles||(this.bufferSubDataUpdate(11*t,new Float32Array(e)),0))}setParticleSize(t,e){return!(t>this.numParticles||(this.bufferSubDataUpdate(11*t+3,new Float32Array([e])),0))}setParticleStartVelocity(t,e){return!(t>this.numParticles||(this.bufferSubDataUpdate(11*t+4,new Float32Array(e)),0))}setParticleStartTime(t,e){return!(t>this.numParticles||(this.bufferSubDataUpdate(11*t+7,new Float32Array([e])),0))}resetParticleStartTime(t){return!(t>this.numParticles||(this.bufferSubDataUpdate(11*t+7,new Float32Array([.001*(Date.now()-i.applicationStartTime)])),0))}setParticleAcceleration(t,e){return!(t>this.numParticles||(this.bufferSubDataUpdate(11*t+8,new Float32Array(e)),0))}bufferSubDataUpdate(t,e){return!(t>11*this.numParticles||(this.bindVAO(),i.gl.bindBuffer(i.gl.ARRAY_BUFFER,this.instanceVBO),i.gl.bufferSubData(i.gl.ARRAY_BUFFER,4*t,e),this.unbindVAO(),0))}draw(){this.bindVAO(),this.texture.bind(0),i.gl.uniform1f(this.shaderProgram.getUniformLocation("fadePerSecond")[0],this.fadePerSecond),i.gl.uniform1f(this.shaderProgram.getUniformLocation("sizeChangePerSecond")[0],this.sizeChangePerSecond),i.gl.drawElementsInstanced(i.gl.TRIANGLES,6,i.gl.UNSIGNED_INT,0,this.getNumberOfParticles()),this.unbindVAO()}}e.default=r},7907:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(6098),n=s(5),r=s(9894),o=s(4831);class a extends i.default{constructor(t){super(t),this.vertices=new Float32Array([-.5,.5,0,0,0,1,0,1,-.5,-.5,0,0,0,1,0,0,.5,-.5,0,0,0,1,1,0,.5,.5,0,0,0,1,1,1]),this.indices=new Int32Array([0,1,2,0,2,3]),this.setVertexData(this.vertices),this.setIndexData(this.indices)}setupTriangles(t){t.length=0;for(let e=0;e<this.indices.length;e+=3){const s=t.push(new n.default);t[s-1].setVertices(new r.default([this.vertices[8*this.indices[e]],this.vertices[8*this.indices[e]+1],this.vertices[8*this.indices[e]+2]]),new r.default([this.vertices[8*this.indices[e+1]],this.vertices[8*this.indices[e+1]+1],this.vertices[8*this.indices[e+1]+2]]),new r.default([this.vertices[8*this.indices[e+2]],this.vertices[8*this.indices[e+2]+1],this.vertices[8*this.indices[e+2]+2]]))}}getVertexPositions(){let t=new Array;for(let e=0;e<this.vertices.length;e+=8)t.push(new r.default([this.vertices[e],this.vertices[e+1],this.vertices[e+2]]));return t}draw(){this.bindVAO(),o.gl.drawElements(o.gl.TRIANGLES,6,o.gl.UNSIGNED_INT,0)}}e.default=a},6998:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(6098),n=s(4831);class r extends i.default{constructor(t,e){super(t),this.vertices=new Float32Array([-1,1,0,1,-1,-1,0,0,1,-1,1,0,1,1,1,1]),this.indices=new Int32Array([0,1,2,0,2,3]),this.setVertexData(this.vertices),this.setIndexData(this.indices),this.textures=e;for(let t of this.textures)t.setTexParameterI(n.gl.TEXTURE_WRAP_S,n.gl.CLAMP_TO_EDGE),t.setTexParameterI(n.gl.TEXTURE_WRAP_T,n.gl.CLAMP_TO_EDGE)}draw(t=!0){if(this.bindVAO(),t)for(let t=0;t<this.textures.length;t++)this.textures[t].bind(t);n.gl.drawElements(n.gl.TRIANGLES,6,n.gl.UNSIGNED_INT,0)}}e.default=r},5894:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(6098),n=s(4831);class r extends i.default{constructor(t,e){super(t),this.vertices=new Float32Array([-.5,.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5]),this.indices=new Int32Array([0,1,2,0,2,3,3,2,6,3,6,7,7,6,5,7,5,4,4,5,1,4,1,0,4,0,3,4,3,7,1,5,6,1,6,2]),this.setVertexData(this.vertices),this.setIndexData(this.indices),this.texture=e}draw(){this.bindVAO(),this.texture.bind(),n.gl.drawElements(n.gl.TRIANGLES,this.indices.length,n.gl.UNSIGNED_INT,0)}}e.default=r},5082:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CollisionSolver=void 0;const i=s(9894);(e.CollisionSolver||(e.CollisionSolver={})).getTranslationNeeded=function(t){if(0==t.length)return new i.default;let e=new i.default,s=0;for(let i of t)1==i.shapeB.getTransformedNormals().length&&i.axis.dot(i.shapeB.getTransformedNormals()[0])<.99||i.depth>s&&(e.deepAssign(i.axis),s=i.depth);return e.multiply(s),e}},822:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894);e.default=class{constructor(t,e,s,n,r){this.axis=new i.default(t),this.depth=e,this.point=new i.default(s),this.shapeA=n,this.shapeB=r}}},5436:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.IntersectionTester=void 0;const i=s(2977),n=s(9894),r=s(822);var o;(o=e.IntersectionTester||(e.IntersectionTester={})).identifyIntersection=function(t,e){let s=new n.default,r={depth:1/0};for(let n of t)for(let t of e)if(i.SAT.getIntersection3D(n,t,s,r))return!0;return!1},o.identifyIntersectionInformation=function(t,e,s){let o=!1,a=new n.default,l={depth:1/0};for(let n of t)for(let t of e)i.SAT.getIntersection3D(n,t,a,l)&&(o=!0,s.push(new r.default(a,l.depth,i.SAT.getIntersectionPoint(n,t,a),n,t)));return o},o.doRayCast=function(t,e,s=1/0,r=!1){let o=-1;for(const a of e){let e=i.SAT.getContinousIntersection3D(t,a,t.getDir(),new n.default([0,0,0]),s);if(e>=0&&(e<o||o<0)&&(o=e,s=o,r))return o}return o}},161:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894),n=s(1308);class r extends n.default{constructor(){super(),this.originalVertices=new Array,this.originalNormals=new Array,this.transformedVertices=new Array,this.transformedNormals=new Array,this.transformMatrix=new Matrix4(null),this.verticesNeedsUpdate=!1,this.normalsNeedsUpdate=!1}setVertices(t){this.originalVertices.length=0;for(let e of t)this.originalVertices.push(e);this.verticesNeedsUpdate=!0}setNormals(t){this.originalNormals.length=0;for(let e of t)this.originalNormals.push(e);this.normalsNeedsUpdate=!0}setMinAndMaxVectors(t,e){this.originalNormals.length=0,this.originalNormals.push(new i.default([1,0,0])),this.originalNormals.push(new i.default([0,1,0])),this.originalNormals.push(new i.default([0,0,1])),this.originalVertices.length=0;for(let t=0;t<8;t++)this.originalVertices.push(new i.default([0,0,0]));this.originalVertices[0].deepAssign(t),this.originalVertices[1].setValues(t.x,t.y,e.z),this.originalVertices[2].setValues(t.x,e.y,t.z),this.originalVertices[3].setValues(t.x,e.y,e.z),this.originalVertices[4].setValues(e.x,t.y,t.z),this.originalVertices[5].setValues(e.x,t.y,e.z),this.originalVertices[6].setValues(e.x,e.y,t.z),this.originalVertices[7].deepAssign(e),this.normalsNeedsUpdate=!0,this.verticesNeedsUpdate=!0}setUpdateNeeded(){this.verticesNeedsUpdate=!0,this.normalsNeedsUpdate=!0}setTransformMatrix(t){this.transformMatrix=t,this.verticesNeedsUpdate=!0,this.normalsNeedsUpdate=!0}getTransformedVertices(){if(this.verticesNeedsUpdate){this.transformedVertices.length=0;for(const t of this.originalVertices){let e=this.transformMatrix.multiplyVector4(new Vector4([...t,1])),s=new i.default([e.elements[0],e.elements[1],e.elements[2]]);this.transformedVertices.push(s)}this.verticesNeedsUpdate=!1}return this.transformedVertices}getTransformedNormals(){return this.normalsNeedsUpdate&&(this.transformedNormals.length=0,this.getTransformedVertices(),this.transformedNormals.push(new i.default(this.transformedVertices[0]).subtract(this.transformedVertices[1]).cross(new i.default(this.transformedVertices[4]).subtract(this.transformedVertices[0])).normalize()),this.transformedNormals.push(new i.default(this.transformedVertices[0]).subtract(this.transformedVertices[1]).cross(new i.default(this.transformedVertices[2]).subtract(this.transformedVertices[0])).normalize()),this.transformedNormals.push(new i.default(this.transformedVertices[0]).subtract(this.transformedVertices[2]).cross(new i.default(this.transformedVertices[4]).subtract(this.transformedVertices[0])).normalize()),this.normalsNeedsUpdate=!1),this.transformedNormals}getTransformedEdges(){return this.getTransformedNormals()}getTransformedEdgeNormals(){return this.getTransformedNormals()}getTransformMatrix(){return this.transformMatrix}}e.default=r},3453:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894),n=s(1308);class r extends n.default{constructor(){super(),this.start=new i.default([0,0,0]),this.dir=new i.default([0,0,1])}setStart(t){this.start=t}setDir(t){this.dir.deepAssign(t).normalize()}getDir(){return this.dir}setStartAndDir(t,e){this.start.deepAssign(t),this.dir.deepAssign(e).normalize()}getTransformedVertices(){return[this.start]}getTransformedNormals(){return[this.dir]}getTransformedEdges(){return[this.dir]}getTransformedEdgeNormals(){return[this.dir]}}e.default=r},1308:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.default=class{constructor(){this.margin=0}setUpdateNeeded(){}setTransformMatrix(t){}getOriginalVertices(){return null}getTransformedVertices(){return null}getTransformedNormals(){return null}getTransformedEdges(){return null}getTransformedEdgeNormals(){return null}}},5:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9894),n=s(1308);class r extends n.default{constructor(){super(),this.originalVertices=new Array,this.originalNormal=new i.default,this.transformedVertices=new Array,this.transformedNormals=new Array(1),this.transformedEdges=new Array,this.transformedEdgeNormals=new Array,this.transformMatrix=new Matrix4(null),this.verticesNeedsUpdate=!1,this.normalNeedsUpdate=!1,this.edgesNeedsUpdate=!1,this.edgeNormalsNeedsUpdate=!1}setVertices(t,e,s){this.originalVertices.length=0,this.transformedEdges.length=0,this.originalVertices.push(t),this.originalVertices.push(e),this.originalVertices.push(s),this.originalNormal.deepAssign(new i.default(t).subtract(e).cross(new i.default(s).subtract(e)).normalize()),this.verticesNeedsUpdate=!0,this.normalNeedsUpdate=!0,this.edgesNeedsUpdate=!0,this.edgeNormalsNeedsUpdate=!0}setUpdateNeeded(){this.verticesNeedsUpdate=!0,this.normalNeedsUpdate=!0,this.edgesNeedsUpdate=!0,this.edgeNormalsNeedsUpdate=!0}setTransformMatrix(t){this.transformMatrix=t,this.verticesNeedsUpdate=!0,this.normalNeedsUpdate=!0,this.edgesNeedsUpdate=!0,this.edgeNormalsNeedsUpdate=!0}getOriginalVertices(){return this.originalVertices}getTransformedVertices(){if(this.verticesNeedsUpdate){this.transformedVertices.length=0;for(const t of this.originalVertices){let e=this.transformMatrix.multiplyVector4(new Vector4([...t,1])),s=new i.default([e.elements[0],e.elements[1],e.elements[2]]);this.transformedVertices.push(s)}this.verticesNeedsUpdate=!1}return this.transformedVertices}getTransformedNormals(){return this.normalNeedsUpdate&&(this.transformedNormals.length=0,this.getTransformedVertices(),this.transformedNormals.push(new i.default(this.transformedVertices[0]).subtract(this.transformedVertices[1]).cross(new i.default(this.transformedVertices[2]).subtract(this.transformedVertices[1])).normalize()),this.transformedNormals[0].x*=-1,this.transformedNormals[0].z*=-1,this.normalNeedsUpdate=!1),this.transformedNormals}getTransformedEdges(){return this.edgesNeedsUpdate&&(this.getTransformedVertices(),this.transformedEdges.length=0,this.transformedEdges.push(new i.default(this.transformedVertices[1]).subtract(this.transformedVertices[0]).normalize()),this.transformedEdges.push(new i.default(this.transformedVertices[2]).subtract(this.transformedVertices[1]).normalize()),this.transformedEdges.push(new i.default(this.transformedVertices[0]).subtract(this.transformedVertices[2]).normalize()),this.edgesNeedsUpdate=!1),this.transformedEdges}getTransformedEdgeNormals(){return this.edgeNormalsNeedsUpdate&&(this.getTransformedEdges(),this.getTransformedNormals(),this.transformedEdgeNormals.length=0,this.transformedEdgeNormals.push(new i.default(this.transformedEdges[0]).cross(this.transformedNormals[0]).normalize()),this.transformedEdgeNormals.push(new i.default(this.transformedEdges[1]).cross(this.transformedNormals[0]).normalize()),this.transformedEdgeNormals.push(new i.default(this.transformedEdges[2]).cross(this.transformedNormals[0]).normalize()),this.edgeNormalsNeedsUpdate=!1),this.transformedEdgeNormals}}e.default=r},2183:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OverlayRendering=void 0;const i=s(4712),n=s(2208),r=s(6905),o=s(5111),a=s(607),l=s(4443);e.OverlayRendering=class{constructor(t=null){this.camera=t,this.guiObjects3D=new Array,this.guiObjects2D=new Array}clear(){for(let t of this.guiObjects2D)t.remove();for(let t of this.guiObjects3D)t.remove()}hide(){for(let t of this.guiObjects2D)t.setHidden(!0);for(let t of this.guiObjects3D)t.setHidden(!0)}show(){for(let t of this.guiObjects2D)t.setHidden(!1);for(let t of this.guiObjects3D)t.setHidden(!1)}getNew2DText(){const t=this.guiObjects2D.push(new a.default);return this.guiObjects2D[t-1]}getNew3DText(){const t=this.guiObjects3D.push(new l.default);return this.guiObjects3D[t-1]}getNewCheckbox(){const t=this.guiObjects2D.push(new n.default);return this.guiObjects2D[t-1]}getNewButton(){const t=this.guiObjects2D.push(new i.default);return this.guiObjects2D[t-1]}getNewSlider(){const t=this.guiObjects2D.push(new o.default);return this.guiObjects2D[t-1]}getNewProgress(){const t=this.guiObjects2D.push(new r.default);return this.guiObjects2D[t-1]}draw(){if(null!=this.camera)for(let t=0;t<this.guiObjects3D.length;t++)this.guiObjects3D[t].removed?(this.guiObjects3D.splice(t,1),t--):this.guiObjects3D[t].draw3D(this.camera.getViewProjMatrix());for(let t=0;t<this.guiObjects2D.length;t++)this.guiObjects2D[t].removed?(this.guiObjects2D.splice(t,1),t--):this.guiObjects2D[t].draw()}}},1664:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(3183),r=s(7267),o=s(6998),a=s(7110),l=s(1653),h=s(7419),u=s(139);e.default=class{constructor(t){this.bloomExtractionOutputFramebuffer=new n.default(i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight,[new r.default(!1),new r.default(!1)],null),this.pingPongFramebuffers=new Array(2),this.bloomResolutionWidth=1280,this.bloomResolutionHeight=720;for(let t=0;t<2;t++)this.pingPongFramebuffers[t]=new n.default(this.bloomResolutionWidth,this.bloomResolutionHeight,[new r.default(!1)],null);this.screenQuad=new o.default(a.screenQuadShaderProgram,t),this.outputFramebuffer=null}setResolution(t,e){this.bloomExtractionOutputFramebuffer.setProportions(t,e)}bindFramebuffers(){null==this.outputFramebuffer?i.gl.bindFramebuffer(i.gl.DRAW_FRAMEBUFFER,null):this.outputFramebuffer.bind(i.gl.DRAW_FRAMEBUFFER)}draw(){i.gl.disable(i.gl.DEPTH_TEST),this.bloomExtractionOutputFramebuffer.bind(i.gl.DRAW_FRAMEBUFFER),l.bloomExtraction.use(),this.screenQuad.draw(!0),i.gl.viewport(0,0,this.bloomResolutionWidth,this.bloomResolutionHeight);let t=!0,e=!0;h.gaussianBlur.use();for(let s=0;s<5;s++)this.pingPongFramebuffers[Number(t)].bind(i.gl.DRAW_FRAMEBUFFER),i.gl.uniform1ui(h.gaussianBlur.getUniformLocation("horizontal")[0],Number(t)),e?this.bloomExtractionOutputFramebuffer.textures[1].bind():this.pingPongFramebuffers[Number(!t)].textures[0].bind(),this.screenQuad.draw(!1),t=!t,e=!1;i.gl.viewport(0,0,i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight),u.bloomBlending.use(),this.bloomExtractionOutputFramebuffer.textures[0].bind(0),this.pingPongFramebuffers[Number(t)].textures[0].bind(1),this.bindFramebuffers(),this.screenQuad.draw(!1),i.gl.enable(i.gl.DEPTH_TEST)}}},8143:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(6465),r=s(6998);e.default=class{constructor(t){this.screenQuad=new r.default(n.crtShaderProgram,t),this.outputFramebuffer=null}bindFramebuffers(){null==this.outputFramebuffer?i.gl.bindFramebuffer(i.gl.DRAW_FRAMEBUFFER,null):this.outputFramebuffer.bind(i.gl.DRAW_FRAMEBUFFER)}draw(){this.bindFramebuffers(),i.gl.disable(i.gl.DEPTH_TEST),n.crtShaderProgram.use(),this.screenQuad.draw(!0),i.gl.enable(i.gl.DEPTH_TEST)}}},724:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(6998),r=s(7110);e.default=class{constructor(t){this.screenQuad=new n.default(r.screenQuadShaderProgram,t),this.outputFramebuffer=null}draw(){i.gl.bindFramebuffer(i.gl.DRAW_FRAMEBUFFER,null),i.gl.disable(i.gl.DEPTH_TEST),r.screenQuadShaderProgram.use(),this.screenQuad.draw(!0),i.gl.enable(i.gl.DEPTH_TEST)}}},8403:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(3183),r=s(4109),o=s(9171),a=s(7267);e.default=class{constructor(){this.outputFramebuffer=new n.default(i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight,[new a.default(!1,i.gl.RGBA32F,i.gl.RGBA,i.gl.FLOAT),new a.default(!1,i.gl.RGBA32F,i.gl.RGBA,i.gl.FLOAT),new a.default(!1)],null)}setResolution(t,e){this.outputFramebuffer.setProportions(t,e)}draw(t,e){i.gl.viewport(0,0,i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight),this.outputFramebuffer.bind(i.gl.FRAMEBUFFER),i.gl.clearColor(0,0,0,0),i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT|i.gl.STENCIL_BUFFER_BIT),r.geometryPass.use(),e.bindViewProjMatrix(r.geometryPass.getUniformLocation("viewProjMatrix")[0]),t.renderScene(r.geometryPass,!0),o.grassShaderProgram.use(),e.bindViewProjMatrix(o.grassShaderProgram.getUniformLocation("viewProjMatrix")[0]),i.gl.uniform3fv(o.grassShaderProgram.getUniformLocation("cameraPos")[0],e.getPosition()),i.gl.uniform1f(o.grassShaderProgram.getUniformLocation("currentTime")[0],.001*(Date.now()-i.applicationStartTime)),t.renderGrass(o.grassShaderProgram,!0)}}},6807:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(6998),r=s(5004);e.default=class{constructor(t){this.screenQuad=new n.default(r.lightingPass,t)}setResolution(t,e){this.outputFramebuffer.setProportions(t,e)}draw(t,e){i.gl.disable(i.gl.DEPTH_TEST),r.lightingPass.use(),i.gl.uniform3fv(r.lightingPass.getUniformLocation("camPos")[0],e.getPosition()),t.directionalLight.bind(),t.directionalLight.calcAndSendLightSpaceMatrix(e.getPosition(),20,r.lightingPass.getUniformLocation("lightSpaceMatrix")[0]),i.gl.uniform1i(r.lightingPass.getUniformLocation("nrOfPointLights")[0],t.pointLights.length);for(let e=0;e<t.pointLights.length;e++)t.pointLights[e].bind(e);this.screenQuad.draw(!0),i.gl.enable(i.gl.DEPTH_TEST)}}},1235:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(8938);e.default=class{constructor(){}draw(t,e){if(t.particleSpawners.length>0){n.particleShaderProgram.use(),e.bindViewProjMatrix(n.particleShaderProgram.getUniformLocation("viewProjMatrix")[0]),i.gl.uniform3fv(n.particleShaderProgram.getUniformLocation("cameraPos")[0],e.getPosition()),i.gl.uniform1f(n.particleShaderProgram.getUniformLocation("currentTime")[0],.001*(Date.now()-i.applicationStartTime));for(const e of t.particleSpawners.values())e.draw()}}}},5222:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(3183),r=s(9085),o=s(8590),a=s(7267);e.default=class{constructor(){this.shadowResolution=4096,this.shadowOffset=20,this.shadowBuffer=new n.default(this.shadowResolution,this.shadowResolution,[],new a.default(!1,i.gl.DEPTH_COMPONENT32F,i.gl.DEPTH_COMPONENT,i.gl.FLOAT))}setShadowMappingResolution(t){this.shadowResolution=t,this.shadowBuffer.setProportions(t,t)}draw(t,e){this.shadowBuffer.bind(i.gl.FRAMEBUFFER),i.gl.enable(i.gl.DEPTH_TEST),o.shadowPass.use(),i.gl.viewport(0,0,this.shadowResolution,this.shadowResolution),i.gl.clearColor(1,1,1,1),i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT),t.getDirectionalLight().calcAndSendLightSpaceMatrix(e.getPosition(),this.shadowOffset,o.shadowPass.getUniformLocation("lightSpaceMatrix")[0]),t.renderScene(o.shadowPass,!1),r.grassShadowPass.use(),t.getDirectionalLight().calcAndSendLightSpaceMatrix(e.getPosition(),this.shadowOffset,r.grassShadowPass.getUniformLocation("lightSpaceMatrix")[0]),i.gl.uniform3fv(r.grassShadowPass.getUniformLocation("cameraPos")[0],e.getPosition()),i.gl.uniform1f(r.grassShadowPass.getUniformLocation("currentTime")[0],.001*(Date.now()-i.applicationStartTime)),t.renderGrass(r.grassShadowPass,!1)}}},4129:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(5894),r=s(3732);e.default=class{constructor(){this.skybox=null}setSkybox(t){this.skybox=new n.default(r.skyboxShaderProgram,t)}draw(t){null!=this.skybox&&(i.gl.enable(i.gl.DEPTH_TEST),r.skyboxShaderProgram.use(),t.bindViewProjMatrix(r.skyboxShaderProgram.getUniformLocation("viewProjMatrix")[0],!0),i.gl.depthFunc(i.gl.LEQUAL),this.skybox.draw(),i.gl.depthFunc(i.gl.LESS))}}},3020:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(1215),r=s(3183),o=s(7267),a=s(2936),l=s(5222),h=s(8143),u=s(1664),c=s(4129),d=s(8403),g=s(6807),f=s(1235),m=s(724);e.default=class{constructor(t,e){this.textureStore=t,this.scene=e,this.shadowRenderPass=new l.default,this.camera=new a.default(i.gl),this.resolutionWidth=i.windowInfo.resolutionWidth,this.resolutionHeight=i.windowInfo.resolutionHeight,this.geometryRenderPass=new d.default;let s=new Array;for(let t=0;t<this.geometryRenderPass.outputFramebuffer.textures.length;t++)s.push(this.geometryRenderPass.outputFramebuffer.textures[t]);s.push(this.shadowRenderPass.shadowBuffer.depthTexture),this.lightingRenderPass=new g.default(s),this.particleRenderPass=new f.default,this.useSkybox=!1,this.skyboxRenderPass=new c.default,this.useCrt=n.options.useCrt,this.crtFramebuffer=new r.default(this.resolutionWidth,this.resolutionHeight,[new o.default(!1)],null),this.crtRenderPass=new h.default(this.crtFramebuffer.textures),this.bloomExtractionInputFramebuffer=new r.default(i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight,[new o.default(!1)],null),this.bloomRenderPass=new u.default(this.bloomExtractionInputFramebuffer.textures),this.useBloom=n.options.useBloom,this.finishedFramebuffer=new r.default(i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight,[new o.default(!1)],null),this.finishedOutputRenderPass=new m.default(this.finishedFramebuffer.textures),this.initGL()}initGL(){this.clearColour={r:.15,g:.1,b:.1,a:1},i.gl.clearColor(this.clearColour.r,this.clearColour.g,this.clearColour.b,this.clearColour.a),i.gl.enable(i.gl.DEPTH_TEST),i.gl.disable(i.gl.BLEND),i.gl.cullFace(i.gl.BACK),i.gl.disable(i.gl.CULL_FACE)}reportCanvasResize(t,e){this.resolutionWidth=t,this.resolutionHeight=e,this.geometryRenderPass.setResolution(t,e),this.crtFramebuffer.setProportions(t,e),this.finishedFramebuffer.setProportions(t,e),this.bloomExtractionInputFramebuffer.setProportions(t,e),this.bloomRenderPass.setResolution(t,e)}setSkybox(t){this.skyboxRenderPass.setSkybox(this.textureStore.getCubeMap(t)),this.useSkybox=!0}draw(){this.resolutionWidth==i.windowInfo.resolutionWidth&&this.resolutionHeight==i.windowInfo.resolutionHeight||this.reportCanvasResize(i.windowInfo.resolutionWidth,i.windowInfo.resolutionHeight),i.gl.enable(i.gl.DEPTH_TEST),this.shadowRenderPass.draw(this.scene,this.camera),this.geometryRenderPass.draw(this.scene,this.camera),this.useBloom?this.bloomExtractionInputFramebuffer.bind(i.gl.DRAW_FRAMEBUFFER):this.useCrt?this.crtFramebuffer.bind(i.gl.DRAW_FRAMEBUFFER):this.finishedFramebuffer.bind(i.gl.DRAW_FRAMEBUFFER),i.gl.clearColor(this.clearColour.r,this.clearColour.g,this.clearColour.b,this.clearColour.a),i.gl.clear(i.gl.COLOR_BUFFER_BIT|i.gl.DEPTH_BUFFER_BIT|i.gl.STENCIL_BUFFER_BIT),this.lightingRenderPass.draw(this.scene,this.camera),this.geometryRenderPass.outputFramebuffer.bind(i.gl.READ_FRAMEBUFFER),i.gl.blitFramebuffer(0,0,this.resolutionWidth,this.resolutionHeight,0,0,this.resolutionWidth,this.resolutionHeight,i.gl.DEPTH_BUFFER_BIT,i.gl.NEAREST),this.particleRenderPass.draw(this.scene,this.camera),this.useSkybox&&this.skyboxRenderPass.draw(this.camera),this.useBloom&&(this.useCrt?this.bloomRenderPass.outputFramebuffer=this.crtFramebuffer:this.bloomRenderPass.outputFramebuffer=null,this.bloomRenderPass.draw()),this.useCrt&&this.crtRenderPass.draw(),this.useCrt||this.useBloom||this.finishedOutputRenderPass.draw()}}},1541:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(9775),r=s(9308),o=s(3409),a=s(7749),l=s(9935),h=s(7907),u=s(4109),c=s(5004),d=s(9171),g=s(8938);e.default=class{constructor(t,e){this.textureStore=t,this.meshStore=e,this.graphicBundles=new Array,this.grassSpawners=new Array,this.directionalLight=new n.default(i.gl,c.lightingPass),this.pointLights=new Array,this.particleSpawners=new Array}getNewPhongQuad(t,e){const s=this.graphicBundles.push(new o.default(this.textureStore.getTexture(t),this.textureStore.getTexture(e),new h.default(u.geometryPass)));return this.graphicBundles[s-1]}getNewMesh(t,e,s){const i=this.graphicBundles.push(new o.default(this.textureStore.getTexture(e),this.textureStore.getTexture(s),this.meshStore.getMesh(t)));return this.graphicBundles[i-1]}getNewHeightMap(t,e,s){const i=this.graphicBundles.push(new o.default(this.textureStore.getTexture(e),this.textureStore.getTexture(s),this.meshStore.getHeightmap(t)));return this.graphicBundles[i-1]}getNewParticleSpawner(t,e=0){let s=this.particleSpawners.push(new l.default(g.particleShaderProgram,this.textureStore.getTexture(t),e));return this.particleSpawners[s-1]}getNewGrassSpawner(t,e,s=0){let i=this.grassSpawners.push(new o.default(this.textureStore.getTexture(t),this.textureStore.getTexture(e),new a.default(d.grassShaderProgram,s)));return this.grassSpawners[i-1]}getNewPointLight(){const t=this.pointLights.push(new r.default(i.gl,c.lightingPass));return this.pointLights[t-1]}getDirectionalLight(){return this.directionalLight}deleteGraphicsBundle(t){this.graphicBundles=this.graphicBundles.filter((e=>t!==e))}deletePointLight(t){this.pointLights=this.pointLights.filter((e=>t!==e))}deleteParticleSpawner(t){this.particleSpawners=this.particleSpawners.filter((e=>t!==e))}renderScene(t,e=!0){for(let s of this.graphicBundles)s.graphicsObject.shaderProgram=t,s.draw(e)}renderGrass(t,e=!0){for(let s of this.grassSpawners)s.graphicsObject.shaderProgram=t,s.draw(e)}}},4109:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createGeometryPass=e.geometryPass=e.geometryFragmentShaderSrc=void 0;const i=s(4831),n=s(7228);e.geometryFragmentShaderSrc="#version 300 es\nprecision highp float;\n\nin vec3 fragPos;\nin vec3 fragNormal;\nin vec2 texCoords;\n\nlayout (location = 0) out vec4 gPositionEmission;\nlayout (location = 1) out vec4 gNormal;\nlayout (location = 2) out vec4 gColourSpec;\n\nstruct Material {\n\tsampler2D diffuse;\n\tsampler2D specular;\n\tsampler2D emission;\n};\n\nuniform Material material;\nuniform vec3 baseColor;\n\nmat4 thresholdMatrix = mat4(\n\t1.0, 9.0, 3.0, 11.0,\n\t13.0, 5.0, 15.0, 7.0,\n\t4.0, 12.0, 2.0, 10.0,\n\t16.0, 8.0, 14.0, 6.0\n\t);\n\nvoid main() {\n\tfloat opacity = texture(material.diffuse, texCoords).a;\n\n\tfloat threshold = thresholdMatrix[int(floor(mod(gl_FragCoord.x, 4.0)))][int(floor(mod(gl_FragCoord.y, 4.0)))] / 17.0;\n    if (threshold >= opacity) {\n        discard;\n    }\n\n\tgColourSpec.rgb = texture(material.diffuse, texCoords).rgb;\n\tif (baseColor.r > 0.0 || baseColor.g > 0.0 || baseColor.b > 0.0) {\n\t\tgColourSpec.rgb = baseColor;\n\t}\n    gColourSpec.a = texture(material.specular, texCoords).r;\n\t\n\tgPositionEmission.rgb = fragPos;\n\tgPositionEmission.a = texture(material.emission, texCoords).r;\n\tgNormal = vec4(fragNormal, 1.0);\n}";class r extends n.default{constructor(){super("GeometryPass","#version 300 es\n// If inputs change, also update GeometryPass::setupVertexAttributePointers to match\nlayout (location = 0) in vec3 inPosition;\nlayout (location = 1) in vec3 inNormal;\nlayout (location = 2) in vec2 inTexCoords;\n\n// If uniforms change, also update PhongShaderProgram to match\nuniform mat4 modelMatrix;\nuniform mat4 viewProjMatrix;\nuniform mat4 textureMatrix;\n\nout vec3 fragPos;\nout vec3 fragNormal;\nout vec2 texCoords;\n\nvoid main() {\n    vec4 worldPos = modelMatrix * vec4(inPosition, 1.0);\n\ttexCoords = vec2(textureMatrix * vec4(inTexCoords, 0.0, 1.0));\n\n\t// Calculate normal matrix, should be done on CPU but I can't be bothered with implementing inverse of a matrix and don't want to find a good lib atm\n\tmat3 normalMatrix = mat3(modelMatrix);\n\tnormalMatrix = inverse(normalMatrix);\n\tnormalMatrix = transpose(normalMatrix);\n\n\tfragNormal = normalize(normalMatrix * inNormal);\n\tfragPos = worldPos.xyz;\n\n    gl_Position = viewProjMatrix * worldPos;\n}",e.geometryFragmentShaderSrc),this.use(),this.setUniformLocation("modelMatrix"),this.setUniformLocation("viewProjMatrix"),this.setUniformLocation("textureMatrix"),this.setUniformLocation("material.diffuse"),this.setUniformLocation("material.specular"),this.setUniformLocation("material.emission"),this.setUniformLocation("baseColor"),i.gl.uniform1i(this.getUniformLocation("material.diffuse")[0],0),i.gl.uniform1i(this.getUniformLocation("material.specular")[0],1),i.gl.uniform1i(this.getUniformLocation("material.emission")[0],2)}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,3,i.gl.FLOAT,!1,32,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,3,i.gl.FLOAT,!1,32,12),i.gl.enableVertexAttribArray(1),i.gl.vertexAttribPointer(2,2,i.gl.FLOAT,!1,32,24),i.gl.enableVertexAttribArray(2)}}e.geometryPass=null,e.createGeometryPass=function(){e.geometryPass=new r}},5004:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createLightingPass=e.lightingPass=e.pointLightsToAllocate=void 0;const i=s(7228),n=s(7110),r=s(4831);e.pointLightsToAllocate=100;const o="#version 300 es\nprecision highp float;\n\nin vec2 texCoords;\n\nout vec4 final_colour;\n\nuniform sampler2D gPositionEmission;\nuniform sampler2D gNormal;\nuniform sampler2D gColourSpec;\nuniform sampler2D depthMap;\n\nstruct PointLight {\n\tvec3 position;\n\tvec3 colour;\n\n\tfloat constant;\n\tfloat linear;\n\tfloat quadratic;\n};\n\nstruct DirectionalLight {\n\tvec3 direction;\n\tvec3 colour;\n\tfloat ambientMultiplier;\n};\n\n#define NR_POINT_LIGHTS "+e.pointLightsToAllocate+"\n\nuniform DirectionalLight directionalLight;\nuniform PointLight pointLights[NR_POINT_LIGHTS];\nuniform int nrOfPointLights;\nuniform vec3 camPos; //Used for specular lighting\nuniform mat4 lightSpaceMatrix; // Used for shadow fragment position\n\nvec3 CalcDirectionalLight(DirectionalLight light, vec3 normal, vec3 cameraDir, vec3 diffuse, float specular, float shininess, vec4 lightSpaceFragPos);\nvec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 cameraDir, vec3 diffuse, float specular, float shininess);\nfloat CalcShadow(vec4 lightSpaceFragPos, vec3 normal);\n\nvoid main() {\n\t// Discard fragment if normal alpha is 0\n\tvec4 fragNormalWithAlpha = texture(gNormal, texCoords);\n\tif (fragNormalWithAlpha.a <= 0.0001) {\n\t\tdiscard;\n\t}\n\t\n\tvec3 fragPos = texture(gPositionEmission, texCoords).rgb;\n\tvec3 fragNormal = fragNormalWithAlpha.rgb;\n\tfloat shininess = 32.0f;\n\tvec3 diffuse = texture(gColourSpec, texCoords).rgb;\n\tfloat specular = texture(gColourSpec, texCoords).a;\n\tfloat emission = texture(gPositionEmission, texCoords).a;\n\tvec4 lightSpaceFragPos = (lightSpaceMatrix * vec4(fragPos, 1.0f));\n\t\n\tvec3 cameraDir = normalize(camPos - fragPos); //Direction vector from fragment to camera\n\t\n\t// vec3 result = fragNormal;\n\t// vec3 result = diffuse;\n\t// vec3 result = vec3(specular, specular, specular);\n    vec3 result = vec3(0.0f);\n\tresult += CalcDirectionalLight(directionalLight, fragNormal, cameraDir, diffuse, specular, shininess, lightSpaceFragPos);\n\t\n\tfor (int i = 0; i < nrOfPointLights; i++) {\n\t\tresult += CalcPointLight(pointLights[i], fragNormal, fragPos, cameraDir, diffuse, specular, shininess);\n\t}\n\n\tfinal_colour = vec4(result * (1.0 - emission) + diffuse * emission, 1.0f); // Set colour of fragment. Since we use screen door transparency, do not use alpha value\n}\n\n// Calculates the colour when using a directional light\nvec3 CalcDirectionalLight(DirectionalLight light, vec3 normal, vec3 cameraDir, vec3 diffuse, float specular, float shininess, vec4 lightSpaceFragPos) {\n\tvec3 lightDir = normalize(-light.direction); //light direction from the fragment position\n\n\t// Diffuse shading\n\tfloat diff = max(dot(normal, lightDir), 0.0);\n\n\t// Specular shading\n\tvec3 reflectDir = reflect(-lightDir, normal);\n\tfloat spec = pow(max(dot(cameraDir, reflectDir), 0.0), shininess);\n\n\t// Combine results\t\n\tvec3 ambient = diffuse * light.ambientMultiplier; //Ambient lighting\n\tvec3 finalDiffuse = light.colour * diff * diffuse;\n\tvec3 finalSpecular = light.colour * spec * specular;\n\t\n\tfloat shadow = CalcShadow(lightSpaceFragPos, normal);\n\tvec3 lighting = (ambient + (1.0f - shadow) * (finalDiffuse + finalSpecular));\n\treturn lighting;\n}\n\n// Calculates the colour when using a point light.\nvec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 cameraDir, vec3 diffuse, float specular, float shininess) {\n\tvec3 lighting;\n\tvec3 lightDir = normalize(light.position - fragPos); //light direction from the fragment position\n\n\t// Diffuse shading\n\tfloat diff = max(dot(normal, lightDir), 0.0);\n\n\t// Specular shading\n\tvec3 reflectDir = reflect(-lightDir, normal);\n\tfloat spec = pow(max(dot(cameraDir, reflectDir), 0.0), shininess);\n\n\t// Attenuation\n\tfloat distance = length(light.position - fragPos);\n\tfloat attenuation = 1.0f / (light.constant + light.linear * distance + light.quadratic * (distance * distance));\n\t\n\t// Combine results\n\tvec3 finalDiffuse = light.colour * diff * diffuse;\n\tvec3 finalSpecular = light.colour * spec * specular;\n\tfinalDiffuse *= attenuation;\n\tfinalSpecular *= attenuation;\n\tlighting = finalDiffuse + finalSpecular;\n\t//lighting = finalSpecular;\n\treturn lighting;\n}\n\nfloat CalcShadow(vec4 lightSpaceFragPos, vec3 normal) {\n\t// perform perspective divide\n    vec3 projCoords = lightSpaceFragPos.xyz / lightSpaceFragPos.w;\n\n    // transform to [0,1] range\n    projCoords = projCoords * 0.5 + 0.5;\n\n\tif (projCoords.z > 1.0) {\n\t\treturn 0.0;\n\t}\n\n    // get closest depth value from light's perspective (using [0,1] range fragPosLight as coords)\n    float closestDepth = texture(depthMap, projCoords.xy).r; \n\n    // get depth of current fragment from light's perspective\n    float currentDepth = projCoords.z;\n\n    // check whether current frag pos is in shadow\n\t// float bias = 0.001;\n\tfloat bias = max(0.002 * (1.0 - dot(normal, directionalLight.direction)), 0.002);\n\t\n\tfloat shadow = 0.0;\n\tivec2 textureSize = textureSize(depthMap, 0);\n\tvec2 texelSize = vec2(1.0 / float(textureSize.x), 1.0 / float(textureSize.y));\n\tfor(int x = -1; x <= 1; ++x)\n\t{\n\t\tfor(int y = -1; y <= 1; ++y)\n\t\t{\n\t\t\tfloat pcfDepth = texture(depthMap, projCoords.xy + vec2(x, y) * texelSize).r; \n\t\t\tshadow += currentDepth - bias > pcfDepth ? 1.0 : 0.0;        \n\t\t}    \n\t}\n\tshadow = shadow / 9.0;\n\n    return shadow;\n}";class a extends i.default{constructor(){super("LightingPass",n.screenQuadVertexSrc,o),this.use(),this.setUniformLocation("gPositionEmission"),this.setUniformLocation("gNormal"),this.setUniformLocation("gColourSpec"),this.setUniformLocation("depthMap"),r.gl.uniform1i(this.getUniformLocation("gPositionEmission")[0],0),r.gl.uniform1i(this.getUniformLocation("gNormal")[0],1),r.gl.uniform1i(this.getUniformLocation("gColourSpec")[0],2),r.gl.uniform1i(this.getUniformLocation("depthMap")[0],3);for(let t=0;t<e.pointLightsToAllocate;t++)this.setUniformLocation("pointLights["+t+"].position"),this.setUniformLocation("pointLights["+t+"].colour"),this.setUniformLocation("pointLights["+t+"].constant"),this.setUniformLocation("pointLights["+t+"].linear"),this.setUniformLocation("pointLights["+t+"].quadratic");this.setUniformLocation("directionalLight.direction"),this.setUniformLocation("directionalLight.colour"),this.setUniformLocation("directionalLight.ambientMultiplier"),this.setUniformLocation("nrOfPointLights"),this.setUniformLocation("camPos"),this.setUniformLocation("lightSpaceMatrix")}setupVertexAttributePointers(){r.gl.vertexAttribPointer(0,2,r.gl.FLOAT,!1,16,0),r.gl.enableVertexAttribArray(0),r.gl.vertexAttribPointer(1,2,r.gl.FLOAT,!1,16,8),r.gl.enableVertexAttribArray(1)}}e.lightingPass=null,e.createLightingPass=function(){e.lightingPass=new a}},9171:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createGrassShaderProgram=e.grassShaderProgram=void 0;const i=s(4831),n=s(4109),r=s(7228);class o extends r.default{constructor(){super("GrassShaderProgram","#version 300 es\n\nlayout (location = 0) in vec2 inVertexPosition;\nlayout (location = 1) in vec2 inTexCoords;\n\n// Instanced attributes starts here\nlayout (location = 2) in vec3 inPos;\nlayout (location = 3) in float inSize;\nlayout (location = 4) in vec3 inTipOffset;\n\nuniform mat4 viewProjMatrix;\nuniform vec3 cameraPos;\nuniform float currentTime;\n\nout vec3 fragPos;\nout vec3 fragNormal;\nout vec2 texCoords;\n\nvoid main() {\n    // Billboarding\n    vec3 camDir = cameraPos - inPos;\n    vec3 rightVec = normalize(cross(vec3(0.0, 1.0, 0.0), camDir));\n\t// fragNormal = vec3(-rightVec.z, 0.0, rightVec.x);\n    vec3 upVec = vec3(0.0, 1.0, 0.0);\n\tfragNormal = upVec;\n\tfloat size = inSize + length(camDir) * 0.0;\n    rightVec = rightVec * inVertexPosition.x * size;\n    upVec = upVec * inVertexPosition.y * size;\n\tfragPos = vec3(rightVec + upVec + inPos + (inTipOffset + vec3(sin(currentTime + inPos.x) * 0.1, 0.0, 0.0)) * inVertexPosition.y);\n    gl_Position = viewProjMatrix * vec4(fragPos, 1.0);\n\n    // gl_Position = viewProjMatrix * vec4(vec3(inVertexPosition, 0.0) * size + currentPos, 1.0); // No billboarding\n    texCoords = inTexCoords;\n}",n.geometryFragmentShaderSrc,!1),this.use(),this.setUniformLocation("texture0"),i.gl.uniform1i(this.getUniformLocation("texture0")[0],0),this.setUniformLocation("viewProjMatrix"),this.setUniformLocation("cameraPos"),this.setUniformLocation("currentTime"),this.setUniformLocation("material.diffuse"),this.setUniformLocation("material.specular"),this.setUniformLocation("material.emission"),i.gl.uniform1i(this.getUniformLocation("material.diffuse")[0],0),i.gl.uniform1i(this.getUniformLocation("material.specular")[0],1),i.gl.uniform1i(this.getUniformLocation("material.emission")[0],2)}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,2,i.gl.FLOAT,!1,16,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,2,i.gl.FLOAT,!1,16,8),i.gl.enableVertexAttribArray(1)}setupInstancedVertexAttributePointers(){i.gl.vertexAttribPointer(2,3,i.gl.FLOAT,!1,28,0),i.gl.enableVertexAttribArray(2),i.gl.vertexAttribDivisor(2,1),i.gl.vertexAttribPointer(3,1,i.gl.FLOAT,!1,28,12),i.gl.enableVertexAttribArray(3),i.gl.vertexAttribDivisor(3,1),i.gl.vertexAttribPointer(4,3,i.gl.FLOAT,!1,28,16),i.gl.enableVertexAttribArray(4),i.gl.vertexAttribDivisor(4,1)}}e.grassShaderProgram=null,e.createGrassShaderProgram=function(){e.grassShaderProgram=new o}},8938:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createParticleShaderProgram=e.particleShaderProgram=void 0;const i=s(4831),n=s(7228);class r extends n.default{constructor(){super("ParticleShaderProgram","#version 300 es\n\nlayout (location = 0) in vec2 inVertexPosition;\nlayout (location = 1) in vec2 inTexCoords;\n\n// Instanced attributes starts here\nlayout (location = 2) in vec3 inStartPosition;\nlayout (location = 3) in float inSize;\nlayout (location = 4) in vec3 inStartVel;\nlayout (location = 5) in float inStartTime;\nlayout (location = 6) in vec3 inConstantAcceleration;\n// layout (location = 7) in float padding;\n\nuniform mat4 viewProjMatrix;\nuniform vec3 cameraPos;\nuniform float currentTime;\nuniform float fadePerSecond;\nuniform float sizeChangePerSecond;\n\nout vec2 texCoords;\nout float alpha;\n\nvoid main() {\n    // Calculate how long this has been alive\n    float lifeTime = currentTime - inStartTime;\n\n    // Calculate current position\n    vec3 currentPos = inStartPosition + (inStartVel * lifeTime + (inConstantAcceleration * lifeTime) * lifeTime) / 2.0;\n\n    // Billboarding\n    vec3 camDir = cameraPos - currentPos;\n    vec3 rightVec = normalize(cross(vec3(0.0, 1.0, 0.0), camDir));\n    vec3 upVec = normalize(cross(camDir, rightVec));\n    rightVec = rightVec * inVertexPosition.x * (inSize + sizeChangePerSecond * lifeTime);\n    upVec = upVec * inVertexPosition.y * (inSize + sizeChangePerSecond * lifeTime);\n    gl_Position = viewProjMatrix * vec4(rightVec + upVec + currentPos, 1.0);\n\n    // gl_Position = viewProjMatrix * vec4(vec3(inVertexPosition, 0.0) * inSize + currentPos, 1.0); // No billboarding\n    texCoords = inTexCoords;\n    alpha = max(1.0 - lifeTime * fadePerSecond, 0.0);\n}","#version 300 es\nprecision highp float;\n\nin vec2 texCoords;\nin float alpha;\n\nuniform sampler2D texture0;\n\nout vec4 FragColor;\n\nmat4 thresholdMatrix = mat4(\n    1.0, 9.0, 3.0, 11.0,\n    13.0, 5.0, 15.0, 7.0,\n    4.0, 12.0, 2.0, 10.0,\n    16.0, 8.0, 14.0, 6.0\n    );\n\nvoid main()\n{\n    FragColor = texture(texture0, texCoords);\n\n    FragColor.a = FragColor.a * alpha;\n    \n    float threshold = thresholdMatrix[int(floor(mod(gl_FragCoord.x, 4.0)))][int(floor(mod(gl_FragCoord.y, 4.0)))] / 17.0;\n    if (threshold >= FragColor.a) {\n        discard;\n    }\n\n    FragColor.a = 1.0f; // Since we use screen door transparency, do not use alpha value\n}",!1),this.use(),this.setUniformLocation("texture0"),i.gl.uniform1i(this.getUniformLocation("texture0")[0],0),this.setUniformLocation("viewProjMatrix"),this.setUniformLocation("cameraPos"),this.setUniformLocation("currentTime"),this.setUniformLocation("fadePerSecond"),this.setUniformLocation("sizeChangePerSecond")}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,2,i.gl.FLOAT,!1,16,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,2,i.gl.FLOAT,!1,16,8),i.gl.enableVertexAttribArray(1)}setupInstancedVertexAttributePointers(){i.gl.vertexAttribPointer(2,3,i.gl.FLOAT,!1,44,0),i.gl.enableVertexAttribArray(2),i.gl.vertexAttribDivisor(2,1),i.gl.vertexAttribPointer(3,1,i.gl.FLOAT,!1,44,12),i.gl.enableVertexAttribArray(3),i.gl.vertexAttribDivisor(3,1),i.gl.vertexAttribPointer(4,3,i.gl.FLOAT,!1,44,16),i.gl.enableVertexAttribArray(4),i.gl.vertexAttribDivisor(4,1),i.gl.vertexAttribPointer(5,1,i.gl.FLOAT,!1,44,28),i.gl.enableVertexAttribArray(5),i.gl.vertexAttribDivisor(5,1),i.gl.vertexAttribPointer(6,3,i.gl.FLOAT,!1,44,32),i.gl.enableVertexAttribArray(6),i.gl.vertexAttribDivisor(6,1)}}e.particleShaderProgram=null,e.createParticleShaderProgram=function(){e.particleShaderProgram=new r}},8657:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createPhongShaderProgram=e.phongShaderProgram=void 0;const i=s(7228),n=s(5004),r=s(4831),o="#version 300 es\nprecision highp float;\n\nin vec3 fragPos;\nin vec3 fragNormal;\nin vec2 texCoords;\n\nout vec4 final_colour;\n\nstruct Material {\n\tsampler2D diffuse;\n\tsampler2D specular;\n};\n\nuniform Material material;\n\nstruct PointLight {\n\tvec3 position;\n\tvec3 colour;\n\n\tfloat constant;\n\tfloat linear;\n\tfloat quadratic;\n};\n\nstruct DirectionalLight {\n\tvec3 direction;\n\tvec3 colour;\n\tfloat ambientMultiplier;\n};\n\n#define NR_POINT_LIGHTS "+n.pointLightsToAllocate+"\n\nuniform DirectionalLight directionalLight;\nuniform PointLight pointLights[NR_POINT_LIGHTS];\nuniform int nrOfPointLights;\nuniform vec3 camPos; //Used for specular lighting\n\nvec3 CalcDirectionalLight(DirectionalLight light, vec3 normal, vec3 cameraDir, vec3 diffuse, float specular, float shininess);\nvec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 cameraDir, vec3 diffuse, float specular, float shininess);\n\nmat4 thresholdMatrix = mat4(\n\t1.0, 9.0, 3.0, 11.0,\n\t13.0, 5.0, 15.0, 7.0,\n\t4.0, 12.0, 2.0, 10.0,\n\t16.0, 8.0, 14.0, 6.0\n\t);\n\nvoid main() {\n\tfloat opacity = texture(material.diffuse, texCoords).a;\n\n\tfloat threshold = thresholdMatrix[int(floor(mod(gl_FragCoord.x, 4.0)))][int(floor(mod(gl_FragCoord.y, 4.0)))] / 17.0;\n    if (threshold >= opacity) {\n        discard;\n    }\n\n\tvec3 result = vec3(0.0f, 0.0f, 0.0f);\n\n\tfloat shininess = 32.0f;\n\tvec3 diffuse = texture(material.diffuse, texCoords).xyz;\n\tfloat specular = texture(material.specular, texCoords).r;\n\t\n\tvec3 cameraDir = normalize(camPos - fragPos); //Direction vector from fragment to camera\n\t\n\tresult += CalcDirectionalLight(directionalLight, fragNormal, cameraDir, diffuse, specular, shininess);\n\t\n\tfor (int i = 0; i < nrOfPointLights; i++) {\n\t\tresult += CalcPointLight(pointLights[i], fragNormal, fragPos, cameraDir, diffuse, specular, shininess);\t\n\t}\n\n\tfinal_colour = vec4(result, 1.0f); // Set colour of fragment. Since we use screen door transparency, do not use alpha value\n}\n\n// Calculates the colour when using a directional light\nvec3 CalcDirectionalLight(DirectionalLight light, vec3 normal, vec3 cameraDir, vec3 diffuse, float specular, float shininess) {\n\tvec3 ambient = diffuse * light.ambientMultiplier; //Ambient lighting\n\tvec3 lightDir = normalize(-light.direction); //light direction from the fragment position\n\n\t// Diffuse shading\n\tfloat diff = max(dot(normal, lightDir), 0.0);\n\n\t// Specular shading\n\tvec3 reflectDir = reflect(-lightDir, normal);\n\tfloat spec = pow(max(dot(cameraDir, reflectDir), 0.0), shininess);\n\n\t// Combine results\n\tvec3 finalDiffuse = light.colour * diff * diffuse;\n\tvec3 finalSpecular = light.colour * spec * specular;\n\t\n\tvec3 lighting = (ambient + finalDiffuse + finalSpecular);\n\treturn lighting;\n}\n\n// Calculates the colour when using a point light.\nvec3 CalcPointLight(PointLight light, vec3 normal, vec3 fragPos, vec3 cameraDir, vec3 diffuse, float specular, float shininess) {\n\tvec3 lighting;\n\tvec3 lightDir = normalize(light.position - fragPos); //light direction from the fragment position\n\n\t// Diffuse shading\n\tfloat diff = max(dot(normal, lightDir), 0.0);\n\n\t// Specular shading\n\tvec3 reflectDir = reflect(-lightDir, normal);\n\tfloat spec = pow(max(dot(cameraDir, reflectDir), 0.0), shininess);\n\n\t// Attenuation\n\tfloat distance = length(light.position - fragPos);\n\tfloat attenuation = 1.0f / (light.constant + light.linear * distance + light.quadratic * (distance * distance));\n\t\n\t// Combine results\n\tvec3 finalDiffuse = light.colour * diff * diffuse;\n\tvec3 finalSpecular = light.colour * spec * specular;\n\tfinalDiffuse *= attenuation;\n\tfinalSpecular *= attenuation;\n\tlighting = finalDiffuse + finalSpecular;\n\t//lighting = finalSpecular;\n\treturn lighting;\n}";class a extends i.default{constructor(){super("PhongShaderProgram","#version 300 es\n// If inputs change, also update PhongShaderProgram::setupVertexAttributePointers to match\nlayout (location = 0) in vec3 inPosition;\nlayout (location = 1) in vec3 inNormal;\nlayout (location = 2) in vec2 inTexCoords;\n\n// If uniforms change, also update PhongShaderProgram to match\nuniform mat4 modelMatrix;\nuniform mat4 viewProjMatrix;\nuniform mat4 textureMatrix;\n\nout vec3 fragPos;\nout vec3 fragNormal;\nout vec2 texCoords;\n\nvoid main() {\n    vec4 worldPos = modelMatrix * vec4(inPosition, 1.0);\n\ttexCoords = vec2(textureMatrix * vec4(inTexCoords, 0.0, 1.0));\n\tfragPos = worldPos.xyz;\n\n\t// Calculate normal matrix, should be done on CPU but I can't be bothered with implementing inverse of a matrix and don't want to find a good lib atm\n\tmat3 normalMatrix = mat3(modelMatrix);\n\tnormalMatrix = inverse(normalMatrix);\n\tnormalMatrix = transpose(normalMatrix);\n\n\tfragNormal = normalize(normalMatrix * inNormal);\n\t\n    gl_Position = viewProjMatrix * worldPos;\n}",o),this.use(),this.setUniformLocation("modelMatrix"),this.setUniformLocation("viewProjMatrix"),this.setUniformLocation("textureMatrix"),this.setUniformLocation("material.diffuse"),this.setUniformLocation("material.specular"),r.gl.uniform1i(this.getUniformLocation("material.diffuse")[0],0),r.gl.uniform1i(this.getUniformLocation("material.specular")[0],1);for(let t=0;t<n.pointLightsToAllocate;t++)this.setUniformLocation("pointLights["+t+"].position"),this.setUniformLocation("pointLights["+t+"].colour"),this.setUniformLocation("pointLights["+t+"].constant"),this.setUniformLocation("pointLights["+t+"].linear"),this.setUniformLocation("pointLights["+t+"].quadratic");this.setUniformLocation("directionalLight.direction"),this.setUniformLocation("directionalLight.colour"),this.setUniformLocation("directionalLight.ambientMultiplier"),this.setUniformLocation("nrOfPointLights"),this.setUniformLocation("camPos")}setupVertexAttributePointers(){r.gl.vertexAttribPointer(0,3,r.gl.FLOAT,!1,32,0),r.gl.enableVertexAttribArray(0),r.gl.vertexAttribPointer(1,3,r.gl.FLOAT,!1,32,12),r.gl.enableVertexAttribArray(1),r.gl.vertexAttribPointer(2,2,r.gl.FLOAT,!1,32,24),r.gl.enableVertexAttribArray(2)}}e.phongShaderProgram=null,e.createPhongShaderProgram=function(){e.phongShaderProgram=new a}},139:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createBloomBlending=e.bloomBlending=void 0;const i=s(7228),n=s(7110),r=s(4831);class o extends i.default{constructor(){super("BloomBlending",n.screenQuadVertexSrc,"#version 300 es\nprecision highp float;\n\nout vec4 fragColor;\n  \nin vec2 texCoords;\n\nuniform sampler2D scene;\nuniform sampler2D bloomBlur;\n\nvoid main()\n{\n    // const float gamma = 2.2;\n    // const float exposure = 1.0;\n    // vec3 hdrColor = texture(scene, texCoords).rgb;      \n    // vec3 bloomColor = texture(bloomBlur, texCoords).rgb;\n    // hdrColor += bloomColor; // additive blending\n    // // tone mapping\n    // vec3 result = vec3(1.0) - exp(-hdrColor * exposure);\n    // // also gamma correct while we're at it       \n    // result = pow(result, vec3(1.0 / gamma));\n    // fragColor = vec4(result, 1.0);\n\n    vec3 result = texture(scene, texCoords).rgb;      \n    vec3 bloomColor = texture(bloomBlur, texCoords).rgb;\n    result += bloomColor; // additive blending\n    fragColor = vec4(result, 1.0);\n}"),this.use(),this.setUniformLocation("scene"),this.setUniformLocation("bloomBlur"),r.gl.uniform1i(this.getUniformLocation("scene")[0],0),r.gl.uniform1i(this.getUniformLocation("bloomBlur")[0],1),this.setUniformLocation("horizontal")}setupVertexAttributePointers(){r.gl.vertexAttribPointer(0,2,r.gl.FLOAT,!1,16,0),r.gl.enableVertexAttribArray(0),r.gl.vertexAttribPointer(1,2,r.gl.FLOAT,!1,16,8),r.gl.enableVertexAttribArray(1)}}e.bloomBlending=null,e.createBloomBlending=function(){e.bloomBlending=new o}},1653:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createBloomExtraction=e.bloomExtraction=void 0;const i=s(7228),n=s(7110),r=s(4831);class o extends i.default{constructor(){super("BloomExtraction",n.screenQuadVertexSrc,"#version 300 es\nprecision highp float;\n\nin vec2 texCoords;\n\nlayout (location = 0) out vec4 normalShaded;\nlayout (location = 1) out vec4 brightOnly;\n\nuniform sampler2D inputTexture;\n\nvoid main() {\n\tnormalShaded = texture(inputTexture, texCoords);\n    \n    // check whether fragment output is higher than threshold, if so output as brightness color\n    float brightness = normalShaded.r + normalShaded.g + normalShaded.b;\n    if(brightness > 1.0) {\n        brightOnly = normalShaded;\n    }\n    else {\n        brightOnly = vec4(0.0, 0.0, 0.0, 1.0);\n    }\n}"),this.use(),this.setUniformLocation("inputTexture"),r.gl.uniform1i(this.getUniformLocation("inputTexture")[0],0)}setupVertexAttributePointers(){r.gl.vertexAttribPointer(0,2,r.gl.FLOAT,!1,16,0),r.gl.enableVertexAttribArray(0),r.gl.vertexAttribPointer(1,2,r.gl.FLOAT,!1,16,8),r.gl.enableVertexAttribArray(1)}}e.bloomExtraction=null,e.createBloomExtraction=function(){e.bloomExtraction=new o}},6465:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createCrtShaderProgram=e.crtShaderProgram=void 0;const i=s(7228),n=s(7110),r=s(4831);class o extends i.default{constructor(){super("CrtShaderProgram",n.screenQuadVertexSrc,"#version 300 es\nprecision highp float;\n//\n// PUBLIC DOMAIN CRT STYLED SCAN-LINE SHADER\n//\n//   by Timothy Lottes\n//\n// This is more along the style of a really good CGA arcade monitor.\n// With RGB inputs instead of NTSC.\n// The shadow mask example has the mask rotated 90 degrees for less chromatic aberration.\n//\n// Left it unoptimized to show the theory behind the algorithm.\n//\n// It is an example what I personally would want as a display option for pixel art games.\n// Please take and use, change, or whatever.\n//\n\nout vec4 fragColor;\nin vec2 texCoords;\n\nuniform bool horizontal;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\n\n\nuniform sampler2D screenTexture;\n\n//#define res (textureSize(screenTexture, 0).xy /6.0)\n#define res (vec2(640, 360))\n\n// Hardness of scanline.\n//  -8.0 = soft\n// -16.0 = medium\nfloat hardScan=-8.0;\n\n// Hardness of pixels in scanline.\n// -2.0 = soft\n// -4.0 = hard\nfloat hardPix=-3.0;\n\n// Display warp.\n// 0.0 = none\n// 1.0/8.0 = extreme\nvec2 warp=vec2(1.0/32.0,1.0/24.0); \n\n// Amount of shadow mask.\nfloat maskDark=0.5;\nfloat maskLight=1.5;\n\n//------------------------------------------------------------------------\n\n// sRGB to Linear.\n// Assuing using sRGB typed textures this should not be needed.\nfloat ToLinear1(float c){return(c<=0.04045)?c/12.92:pow((c+0.055)/1.055,2.4);}\nvec3 ToLinear(vec3 c){return vec3(ToLinear1(c.r),ToLinear1(c.g),ToLinear1(c.b));}\n\n// Linear to sRGB.\n// Assuing using sRGB typed textures this should not be needed.\nfloat ToSrgb1(float c){return(c<0.0031308?c*12.92:1.055*pow(c,0.41666)-0.055);}\nvec3 ToSrgb(vec3 c){return vec3(ToSrgb1(c.r),ToSrgb1(c.g),ToSrgb1(c.b));}\n\n// Nearest emulated sample given floating point position and texel offset.\n// Also zero's off screen.\nvec3 Fetch(vec2 pos,vec2 off){\n  pos=floor(pos*res+off)/res;\n  if(max(abs(pos.x-0.5),abs(pos.y-0.5))>0.5)return vec3(0.0,0.0,0.0);\n  return ToLinear(texture(screenTexture,pos.xy,-16.0).rgb);}\n\n// Distance in emulated pixels to nearest texel.\nvec2 Dist(vec2 pos){pos=pos*res;return -((pos-floor(pos))-vec2(0.5));}\n    \n// 1D Gaussian.\nfloat Gaus(float pos,float scale){return exp2(scale*pos*pos);}\n\n// 3-tap Gaussian filter along horz line.\nvec3 Horz3(vec2 pos,float off){\n  vec3 b=Fetch(pos,vec2(-1.0,off));\n  vec3 c=Fetch(pos,vec2( 0.0,off));\n  vec3 d=Fetch(pos,vec2( 1.0,off));\n  float dst=Dist(pos).x;\n  // Convert distance to weight.\n  float scale=hardPix;\n  float wb=Gaus(dst-1.0,scale);\n  float wc=Gaus(dst+0.0,scale);\n  float wd=Gaus(dst+1.0,scale);\n  // Return filtered sample.\n  return (b*wb+c*wc+d*wd)/(wb+wc+wd);}\n\n// 5-tap Gaussian filter along horz line.\nvec3 Horz5(vec2 pos,float off){\n  vec3 a=Fetch(pos,vec2(-2.0,off));\n  vec3 b=Fetch(pos,vec2(-1.0,off));\n  vec3 c=Fetch(pos,vec2( 0.0,off));\n  vec3 d=Fetch(pos,vec2( 1.0,off));\n  vec3 e=Fetch(pos,vec2( 2.0,off));\n  float dst=Dist(pos).x;\n  // Convert distance to weight.\n  float scale=hardPix;\n  float wa=Gaus(dst-2.0,scale);\n  float wb=Gaus(dst-1.0,scale);\n  float wc=Gaus(dst+0.0,scale);\n  float wd=Gaus(dst+1.0,scale);\n  float we=Gaus(dst+2.0,scale);\n  // Return filtered sample.\n  return (a*wa+b*wb+c*wc+d*wd+e*we)/(wa+wb+wc+wd+we);}\n\n// Return scanline weight.\nfloat Scan(vec2 pos,float off){\n  float dst=Dist(pos).y;\n  return Gaus(dst+off,hardScan);}\n\n// Allow nearest three lines to effect pixel.\nvec3 Tri(vec2 pos){\n  vec3 a=Horz3(pos,-1.0);\n  vec3 b=Horz5(pos, 0.0);\n  vec3 c=Horz3(pos, 1.0);\n  float wa=Scan(pos,-1.0);\n  float wb=Scan(pos, 0.0);\n  float wc=Scan(pos, 1.0);\n  return a*wa+b*wb+c*wc;}\n\n// Distortion of scanlines, and end of screen alpha.\nvec2 Warp(vec2 pos){\n  pos=pos*2.0-1.0;    \n  pos*=vec2(1.0+(pos.y*pos.y)*warp.x,1.0+(pos.x*pos.x)*warp.y);\n  return pos*0.5+0.5;}\n\n// Shadow mask.\nvec3 Mask(vec2 pos){\n  pos.x+=pos.y*3.0;\n  vec3 mask=vec3(maskDark,maskDark,maskDark);\n  pos.x=fract(pos.x/6.0);\n  if(pos.x<0.333)mask.r=maskLight;\n  else if(pos.x<0.666)mask.g=maskLight;\n  else mask.b=maskLight;\n  return mask;}    \n\n// Draw dividing bars.\nfloat Bar(float pos,float bar){pos-=bar;return pos*pos<4.0?0.0:1.0;}\n\n\nvoid main() {\n    vec2 resolution = vec2(textureSize(screenTexture, 0));\n    vec2 pos=Warp(gl_FragCoord.xy/resolution.xy+vec2(-0.333,0.0));\n    hardScan=-4.0;\n    maskDark=maskLight=1.0;\n    pos=Warp(gl_FragCoord.xy/resolution.xy);\n    fragColor.rgb=Tri(pos)*Mask(gl_FragCoord.xy);\n        \n    fragColor.a=1.0;  \n    fragColor.rgb=ToSrgb(fragColor.rgb);\n}\n"),this.setUniformLocation("screenTexture")}setupVertexAttributePointers(){r.gl.vertexAttribPointer(0,2,r.gl.FLOAT,!1,16,0),r.gl.enableVertexAttribArray(0),r.gl.vertexAttribPointer(1,2,r.gl.FLOAT,!1,16,8),r.gl.enableVertexAttribArray(1)}}e.crtShaderProgram=null,e.createCrtShaderProgram=function(){e.crtShaderProgram=new o}},7419:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createGaussianBlur=e.gaussianBlur=void 0;const i=s(7228),n=s(7110),r=s(4831);class o extends i.default{constructor(){super("GaussianBlur",n.screenQuadVertexSrc,"#version 300 es\nprecision highp float;\n\nout vec4 fragColor;\n  \nin vec2 texCoords;\n\nuniform sampler2D image;\n  \nuniform bool horizontal;\nfloat weight[5] = float[] (0.227027, 0.1945946, 0.1216216, 0.054054, 0.016216);\n\nvoid main()\n{             \n    vec2 texOffset = vec2(1.0 / float(textureSize(image, 0).x), 1.0 / float(textureSize(image, 0).y)); // gets size of single texel\n    vec3 result = texture(image, texCoords).rgb * weight[0]; // current fragment's contribution\n    if(horizontal)\n    {\n        for(int i = 1; i < 5; ++i)\n        {\n            result += texture(image, texCoords + vec2(texOffset.x * float(i), 0.0)).rgb * weight[i];\n            result += texture(image, texCoords - vec2(texOffset.x * float(i), 0.0)).rgb * weight[i];\n        }\n    }\n    else\n    {\n        for(int i = 1; i < 5; ++i)\n        {\n            result += texture(image, texCoords + vec2(0.0, texOffset.y * float(i))).rgb * weight[i];\n            result += texture(image, texCoords - vec2(0.0, texOffset.y * float(i))).rgb * weight[i];\n        }\n    }\n    fragColor = vec4(result, 1.0);\n}"),this.use(),this.setUniformLocation("image"),r.gl.uniform1i(this.getUniformLocation("image")[0],0),this.setUniformLocation("horizontal")}setupVertexAttributePointers(){r.gl.vertexAttribPointer(0,2,r.gl.FLOAT,!1,16,0),r.gl.enableVertexAttribArray(0),r.gl.vertexAttribPointer(1,2,r.gl.FLOAT,!1,16,8),r.gl.enableVertexAttribArray(1)}}e.gaussianBlur=null,e.createGaussianBlur=function(){e.gaussianBlur=new o}},7110:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createScreenQuadShaderProgram=e.screenQuadShaderProgram=e.screenQuadVertexSrc=void 0;const i=s(4831),n=s(7228);e.screenQuadVertexSrc="#version 300 es\n\nlayout (location = 0) in vec2 inPos;\nlayout (location = 1) in vec2 inTexCoords;\n\nout vec2 texCoords;\n\nvoid main()\n{\n    texCoords = inTexCoords;\n    gl_Position = vec4(inPos, 0.0, 1.0); \n}  \n";class r extends n.default{constructor(){super("ScreenQuadShaderProgram",e.screenQuadVertexSrc,"#version 300 es\nprecision highp float;\n\nout vec4 FragColor;\nin vec2 texCoords;\n\nuniform sampler2D screenTexture;\n\nvoid main() {\n    FragColor = texture(screenTexture, texCoords).rgba;\n}\n"),this.setUniformLocation("screenTexture"),i.gl.uniform1i(this.uniformBindings.screenTexture,0)}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,2,i.gl.FLOAT,!1,16,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,2,i.gl.FLOAT,!1,16,8),i.gl.enableVertexAttribArray(1)}}e.screenQuadShaderProgram=null,e.createScreenQuadShaderProgram=function(){e.screenQuadShaderProgram=new r}},7228:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831);e.default=class{constructor(t,e,s,i=!1){this.shaderProgram=null,this.loadShaders(t,e,s,i),this.uniformBindings=new Map}loadShaders(t,e,s,n){null!=this.shaderProgram&&i.gl.deleteProgram(this.shaderProgram),console.log("Compiling shader program: "+t);const r=i.gl.createShader(i.gl.VERTEX_SHADER);i.gl.shaderSource(r,e),i.gl.compileShader(r),i.gl.getShaderParameter(r,i.gl.COMPILE_STATUS)&&!n||(console.log("Vertex shader compiled successfully: "+i.gl.getShaderParameter(r,i.gl.COMPILE_STATUS)),console.log("Vertex shader compiler log: \n"+i.gl.getShaderInfoLog(r)));const o=i.gl.createShader(i.gl.FRAGMENT_SHADER);i.gl.shaderSource(o,s),i.gl.compileShader(o),i.gl.getShaderParameter(o,i.gl.COMPILE_STATUS)&&!n||(console.log("Fragment shader compiled successfully: "+i.gl.getShaderParameter(o,i.gl.COMPILE_STATUS)),console.log("Fragment shader compiler log: \n"+i.gl.getShaderInfoLog(o))),this.shaderProgram=i.gl.createProgram(),i.gl.attachShader(this.shaderProgram,r),i.gl.attachShader(this.shaderProgram,o),i.gl.linkProgram(this.shaderProgram);let a=i.gl.getProgramParameter(this.shaderProgram,i.gl.LINK_STATUS);a&&!n||(console.log("Linked shaders successfully: "+a),console.log("Linking shaders log: \n"+i.gl.getProgramInfoLog(this.shaderProgram))),i.gl.deleteShader(r),i.gl.deleteShader(o)}use(){i.gl.useProgram(this.shaderProgram)}setupVertexAttributePointers(){}setupInstancedVertexAttributePointers(){}setUniformLocation(t){this.uniformBindings.set(t,i.gl.getUniformLocation(this.shaderProgram,t))}getUniformLocation(t){return this.uniformBindings.has(t)?[this.uniformBindings.get(t),!0]:[0,!1]}}},9085:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createGrassShadowPass=e.grassShadowPass=void 0;const i=s(4831),n=s(7228),r=s(8590);class o extends n.default{constructor(){super("GrassShadowPass","#version 300 es\n\nlayout (location = 0) in vec2 inVertexPosition;\nlayout (location = 1) in vec2 inTexCoords;\n\n// Instanced attributes starts here\nlayout (location = 2) in vec3 inPos;\nlayout (location = 3) in float inSize;\nlayout (location = 4) in vec3 inTipOffset;\n\nuniform mat4 lightSpaceMatrix;\nuniform vec3 cameraPos;\nuniform float currentTime;\n\nout vec2 texCoords;\n\nvoid main() {\n    // Billboarding\n    vec3 camDir = cameraPos - inPos;\n    vec3 rightVec = normalize(cross(vec3(0.0, 1.0, 0.0), camDir));\n    vec3 upVec = vec3(0.0, 1.0, 0.0);\n\tfloat size = inSize + length(camDir) * 0.0;\n    rightVec = rightVec * inVertexPosition.x * size;\n    upVec = upVec * inVertexPosition.y * size;\n\tvec3 fragPos = vec3(rightVec + upVec + inPos + (inTipOffset + vec3(sin(currentTime + inPos.x) * 0.1, 0.0, 0.0)) * inVertexPosition.y);\n    gl_Position = lightSpaceMatrix * vec4(fragPos, 1.0);\n\n    // gl_Position = viewProjMatrix * vec4(vec3(inVertexPosition, 0.0) * size + currentPos, 1.0); // No billboarding\n    texCoords = inTexCoords;\n}",r.shadowFragmentShaderSrc,!1),this.use(),this.setUniformLocation("texture0"),i.gl.uniform1i(this.getUniformLocation("texture0")[0],0),this.setUniformLocation("lightSpaceMatrix"),this.setUniformLocation("cameraPos"),this.setUniformLocation("currentTime")}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,2,i.gl.FLOAT,!1,16,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,2,i.gl.FLOAT,!1,16,8),i.gl.enableVertexAttribArray(1)}setupInstancedVertexAttributePointers(){i.gl.vertexAttribPointer(2,3,i.gl.FLOAT,!1,28,0),i.gl.enableVertexAttribArray(2),i.gl.vertexAttribDivisor(2,1),i.gl.vertexAttribPointer(3,1,i.gl.FLOAT,!1,28,12),i.gl.enableVertexAttribArray(3),i.gl.vertexAttribDivisor(3,1),i.gl.vertexAttribPointer(4,3,i.gl.FLOAT,!1,28,16),i.gl.enableVertexAttribArray(4),i.gl.vertexAttribDivisor(4,1)}}e.grassShadowPass=null,e.createGrassShadowPass=function(){e.grassShadowPass=new o}},8590:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createShadowPass=e.shadowPass=e.shadowFragmentShaderSrc=void 0;const i=s(4831),n=s(7228);e.shadowFragmentShaderSrc="#version 300 es\nprecision highp float;\n\nin vec2 texCoords;\n\nuniform sampler2D diffuse;\n\nmat4 thresholdMatrix = mat4(\n\t1.0, 9.0, 3.0, 11.0,\n\t13.0, 5.0, 15.0, 7.0,\n\t4.0, 12.0, 2.0, 10.0,\n\t16.0, 8.0, 14.0, 6.0\n);\n\n//out vec4 final_colour;\n\nvoid main()\n{\n    float opacity = texture(diffuse, texCoords).a;\n\n\tfloat threshold = thresholdMatrix[int(floor(mod(gl_FragCoord.x, 4.0)))][int(floor(mod(gl_FragCoord.y, 4.0)))] / 17.0;\n    if (threshold >= opacity) {\n        discard;\n    }\n\n    //final_colour = vec4(1.0, 1.0, 1.0, 1.0);\n}";class r extends n.default{constructor(){super("ShadowPass","#version 300 es\n// If inputs change, also update ShadowPass::setupVertexAttributePointers to match\nlayout (location = 0) in vec3 inPosition;\nlayout (location = 1) in vec3 inNormal;\nlayout (location = 2) in vec2 inTexCoords;\n\nuniform mat4 lightSpaceMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 textureMatrix;\n\nout vec2 texCoords;\n\nvoid main()\n{\n    gl_Position = lightSpaceMatrix * modelMatrix * vec4(inPosition, 1.0);\n\ttexCoords = vec2(textureMatrix * vec4(inTexCoords, 0.0, 1.0));\n}",e.shadowFragmentShaderSrc),this.use(),this.setUniformLocation("lightSpaceMatrix"),this.setUniformLocation("modelMatrix"),this.setUniformLocation("textureMatrix")}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,3,i.gl.FLOAT,!1,32,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,3,i.gl.FLOAT,!1,32,12),i.gl.enableVertexAttribArray(1),i.gl.vertexAttribPointer(2,2,i.gl.FLOAT,!1,32,24),i.gl.enableVertexAttribArray(2)}}e.shadowPass=null,e.createShadowPass=function(){e.shadowPass=new r}},7959:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createSimpleShaderProgram=e.simpleShaderProgram=void 0;const i=s(4831),n=s(7228);class r extends n.default{constructor(){super("SimpleShaderProgram","#version 300 es\n// If inputs change, also update SimpleShaderProgram::setupVertexAttributePointers to match\nlayout (location = 0) in vec3 inPosition;\nlayout (location = 1) in vec4 inColor;\nlayout (location = 2) in vec2 inTexCoords;\n\n// If uniforms change, also update SimpleShaderProgram to match\nuniform mat4 modelMatrix;\nuniform mat4 viewProjMatrix;\nuniform mat4 textureMatrix;\n\nout vec4 color;\nout vec2 texCoords;\n\nvoid main() {\n    gl_Position = viewProjMatrix * modelMatrix * vec4(inPosition, 1.0);\n    color = inColor;\n    texCoords = vec2(textureMatrix * vec4(inTexCoords, 0.0, 1.0));\n}","#version 300 es\nprecision highp float;\n\nin vec4 color;\nin vec2 texCoords;\n\n// If uniforms change, also update SimpleShaderProgram to match\nuniform sampler2D texture0;\nuniform int useTexture;\n\nout vec4 FragColor;\n\nmat4 thresholdMatrix = mat4(\n    1.0, 9.0, 3.0, 11.0,\n    13.0, 5.0, 15.0, 7.0,\n    4.0, 12.0, 2.0, 10.0,\n    16.0, 8.0, 14.0, 6.0\n    );\n\nvoid main()\n{\n    if (useTexture == 1) {\n        FragColor = texture(texture0, texCoords);\n    }\n    else {\n        FragColor = color;\n    }\n\n    float threshold = thresholdMatrix[int(floor(mod(gl_FragCoord.x, 4.0)))][int(floor(mod(gl_FragCoord.y, 4.0)))] / 17.0;\n    if (threshold >= FragColor.a) {\n        discard;\n    }\n\n    FragColor.a = 1.0f; // Since we use screen door transparency, do not use alpha value\n}"),this.use(),this.setUniformLocation("modelMatrix"),this.setUniformLocation("viewProjMatrix"),this.setUniformLocation("textureMatrix"),this.setUniformLocation("texture0"),this.setUniformLocation("useTexture"),i.gl.uniform1i(this.uniformBindings.texture0,0)}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,3,i.gl.FLOAT,!1,36,0),i.gl.enableVertexAttribArray(0),i.gl.vertexAttribPointer(1,4,i.gl.FLOAT,!1,36,12),i.gl.enableVertexAttribArray(1),i.gl.vertexAttribPointer(2,2,i.gl.FLOAT,!1,36,28),i.gl.enableVertexAttribArray(2)}}e.simpleShaderProgram=null,e.createSimpleShaderProgram=function(){e.simpleShaderProgram=new r}},3732:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.createSkyboxShaderProgram=e.skyboxShaderProgram=e.skyboxVertexSrc=void 0;const i=s(4831),n=s(7228);e.skyboxVertexSrc="#version 300 es\n\nlayout (location = 0) in vec3 inPos;\n\nout vec3 texCoords;\n\nuniform mat4 viewProjMatrix;\n\nvoid main()\n{\n    texCoords = inPos;\n\ttexCoords.y *= -1.0;\n    vec4 pos = viewProjMatrix * vec4(inPos, 1.0);\n    gl_Position = pos.xyww; \n}  \n";class r extends n.default{constructor(){super("SkyboxShaderProgram",e.skyboxVertexSrc,"#version 300 es\nprecision highp float;\n\nout vec4 FragColor;\nin vec3 texCoords;\n\nuniform samplerCube skybox;\n\nvoid main() {\n    FragColor = texture(skybox, texCoords).rgba;\n}\n"),this.setUniformLocation("skybox"),i.gl.uniform1i(this.uniformBindings.skybox,0),this.setUniformLocation("viewProjMatrix")}setupVertexAttributePointers(){i.gl.vertexAttribPointer(0,3,i.gl.FLOAT,!1,12,0),i.gl.enableVertexAttribArray(0)}}e.skyboxShaderProgram=null,e.createSkyboxShaderProgram=function(){e.skyboxShaderProgram=new r}},36:function(t,e){var s,i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.StatesEnum=void 0,function(t){t[t.STAY=0]="STAY",t[t.LOADINGSCREEN=1]="LOADINGSCREEN",t[t.MAINMENU=2]="MAINMENU",t[t.OPTIONS=3]="OPTIONS",t[t.CONTROLS=4]="CONTROLS",t[t.GAME=5]="GAME",t[t.ENDSCREEN=6]="ENDSCREEN",t[t.DEBUGMODE=7]="DEBUGMODE"}(s=e.StatesEnum||(e.StatesEnum={})),e.default=class{constructor(){this.gotoState=s.STAY,this.initialized=!1}init(){return i(this,void 0,void 0,(function*(){this.initialized=!0}))}reset(){this.initialized=!1}onExit(t){}update(t){}prepareDraw(t){}draw(){}}},2241:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(36);e.default=class{constructor(t){this.fps=0,this.lastTick=null,this.updateTimer=0,this.fpsUpdateTimer=0,this.frameCounter=0,this.dt=0,this.states=new Map,this.currentState=t,this.firstLoop=!0}addState(t,e,s,i){this.states.set(t,{stateType:e,minUpdateRate:s,state:i}),this.states.get(t).state.reset()}updateFrameTimers(){let t=Date.now();this.dt=.001*(t-(this.lastTick||t)),this.lastTick=t,this.frameCounter++,this.fpsUpdateTimer+=this.dt,this.fpsUpdateTimer>.5&&(this.fps=this.frameCounter/this.fpsUpdateTimer,this.fpsUpdateTimer-=.5,this.frameCounter=0)}updateState(t,e){this.updateFrameTimers(),this.updateTimer+=this.dt;let s=0;if(null!=e)for(;this.updateTimer>=e;){if(s>=20){this.updateTimer=0;break}t.update(e),this.updateTimer-=e,s++}0==s&&(t.update(this.updateTimer),this.updateTimer=0),t.prepareDraw(this.dt),this.firstLoop||t.draw(),this.firstLoop=!1}runCurrentState(){return i(this,void 0,void 0,(function*(){if(this.states.get(this.currentState).state.initialized||(yield this.states.get(this.currentState).state.init()),this.updateState(this.states.get(this.currentState).state,this.states.get(this.currentState).minUpdateRate),this.states.get(this.currentState).state.gotoState!=n.StatesEnum.STAY){let t=this.currentState;this.currentState=this.states.get(this.currentState).state.gotoState,this.states.get(t).state.reset(),this.states.get(t).state.gotoState=n.StatesEnum.STAY}requestAnimationFrame(this.runCurrentState.bind(this))}))}start(){requestAnimationFrame(this.runCurrentState.bind(this))}}},9831:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831),n=s(7267);class r extends n.default{constructor(t=!0,e=i.gl.RGBA,s=i.gl.RGBA,n=i.gl.UNSIGNED_BYTE,r=i.gl.TEXTURE_CUBE_MAP){super(t,e,s,n,r),this.setTexParameterI(i.gl.TEXTURE_WRAP_R,i.gl.REPEAT),this.sidesLoaded=0}setTextureData(t,e,s,n){if(this.width=e,this.height=s,i.gl.bindTexture(this.textureTarget,this.texture),null==n)for(let e=0;e<6;e++)i.gl.texImage2D(i.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,this.internalFormat,this.width,this.height,0,this.format,this.dataStorageType,t);else i.gl.texImage2D(n,0,this.internalFormat,this.width,this.height,0,this.format,this.dataStorageType,t);i.gl.bindTexture(this.textureTarget,null)}loadCubemap(t){for(let e=0;e<t.length;e++){let s=new Image;s.crossOrigin="",s.src=t[e];let n=this;s.addEventListener("load",(function(){n.width=s.width,n.height=s.height,i.gl.bindTexture(n.textureTarget,n.texture),i.gl.texImage2D(i.gl.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,n.internalFormat,n.format,n.dataStorageType,s),n.useMipMap&&(i.gl.generateMipmap(n.textureTarget),i.gl.texParameteri(n.textureTarget,i.gl.TEXTURE_MIN_FILTER,i.gl.LINEAR_MIPMAP_LINEAR)),n.sidesLoaded++,n.sidesLoaded>=6&&(n.loadedFromFile=!0)}))}}}e.default=r},7267:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(4831);e.default=class{constructor(t=!0,e=i.gl.RGBA,s=i.gl.RGBA,n=i.gl.UNSIGNED_BYTE,r=i.gl.TEXTURE_2D){this.useMipMap=t,this.internalFormat=e,this.format=s,this.dataStorageType=n,this.textureTarget=r,this.texture=i.gl.createTexture(),i.gl.bindTexture(this.textureTarget,this.texture),i.gl.texParameteri(this.textureTarget,i.gl.TEXTURE_WRAP_S,i.gl.REPEAT),i.gl.texParameteri(this.textureTarget,i.gl.TEXTURE_WRAP_T,i.gl.REPEAT),i.gl.texParameteri(this.textureTarget,i.gl.TEXTURE_MIN_FILTER,i.gl.NEAREST),i.gl.texParameteri(this.textureTarget,i.gl.TEXTURE_MAG_FILTER,i.gl.NEAREST),i.gl.pixelStorei(i.gl.UNPACK_FLIP_Y_WEBGL,!0),this.setTextureData(null,1,1),i.gl.bindTexture(this.textureTarget,null)}setTextureData(t,e,s){this.width=e,this.height=s,i.gl.bindTexture(this.textureTarget,this.texture),i.gl.texImage2D(this.textureTarget,0,this.internalFormat,e,s,0,this.format,this.dataStorageType,t),this.useMipMap&&(i.gl.generateMipmap(this.textureTarget),i.gl.texParameteri(this.textureTarget,i.gl.TEXTURE_MIN_FILTER,i.gl.LINEAR_MIPMAP_LINEAR)),i.gl.bindTexture(this.textureTarget,null),this.loadedFromFile=!1}bind(t=0){i.gl.activeTexture(i.gl.TEXTURE0+t),i.gl.bindTexture(this.textureTarget,this.texture)}loadFromFile(t){let e=new Image;e.crossOrigin="",e.src=t;let s=this;e.addEventListener("load",(function(){s.width=e.width,s.height=e.height,i.gl.bindTexture(s.textureTarget,s.texture),i.gl.texImage2D(s.textureTarget,0,s.internalFormat,s.format,s.dataStorageType,e),s.useMipMap&&(i.gl.generateMipmap(s.textureTarget),i.gl.texParameteri(s.textureTarget,i.gl.TEXTURE_MIN_FILTER,i.gl.LINEAR_MIPMAP_LINEAR)),s.loadedFromFile=!0}))}setTexParameterI(t,e){i.gl.bindTexture(this.textureTarget,this.texture),i.gl.texParameteri(this.textureTarget,t,e),i.gl.bindTexture(this.textureTarget,null)}}},277:(t,e)=>{var s;Object.defineProperty(e,"__esModule",{value:!0}),e.WebUtils=void 0,(s=e.WebUtils||(e.WebUtils={})).GetCookie=function(t){let e=t+"=",s=decodeURIComponent(document.cookie).split(";");for(let t=0;t<s.length;t++){let i=s[t];for(;" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(e))return i.substring(e.length,i.length)}return""},s.SetCookie=function(t,e,s=365){const i=new Date;i.setTime(i.getTime()+24*s*60*60*1e3);let n="expires="+i.toUTCString();document.cookie=t+"="+e+";"+n},s.DeleteCookie=function(t){document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:00 UTC"},s.DownloadFile=function(t,e){let s=document.createElement("a");s.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(e)),s.setAttribute("download",t),s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)}},6917:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703),n=s(9894);class r extends i.Component{constructor(t){super(t||i.ComponentTypeEnum.DELIVERYZONE),this.pos=new n.default,this.radius=0,this.triggerd=!1}}e.default=r},5864:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(2703),n=s(5502),r=s(9295);class o extends n.default{constructor(){super([i.ComponentTypeEnum.DELIVERYZONE,i.ComponentTypeEnum.POSITION]),this.game=r.default.getInstanceNoSa()}update(t){for(const t of this.entities)for(let e=0;e<this.game.newspapersStopped.length;e++){let s=this.game.newspapersStopped[e].entity.getComponent(i.ComponentTypeEnum.POSITION),n=t.getComponent(i.ComponentTypeEnum.DELIVERYZONE),r=t.getComponent(i.ComponentTypeEnum.POSITION),o=t.getComponent(i.ComponentTypeEnum.GRAPHICS);n.pos.deepAssign(r.position),n.radius=r.scale.x,!n.triggerd&&Math.pow(s.position.x-n.pos.x,2)+Math.pow(s.position.y-n.pos.y,2)+Math.pow(s.position.z-n.pos.z,2)<Math.pow(n.radius,2)&&(n.triggerd=!0,o.object.baseColor=new Vector3([0,1,0]),this.game.score-=1,this.game.newspapersStopped.splice(e,1),this.game.ecsManager.removeEntity(t.id),e--)}}}e.default=o},1215:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.StateAccessible=e.options=e.input=void 0;const n=s(6809),r=s(5196),o=s(601),a=s(36),l=s(2241),h=s(2770),u=s(2061),c=s(1182),d=s(9295),g=s(6254),f=s(3540),m=s(7026),p=s(277),x=s(2183),w=s(7471);e.input=new r.default,e.options={useCrt:!1,useBloom:!1,foldableGrass:!1,showFps:!0,grassDensity:1e4,volume:.05},e.StateAccessible=class{};class b extends l.default{constructor(){super(a.StatesEnum.LOADINGSCREEN),this.initializeOptions(),this.stateAccessible={textureStore:new h.default,meshStore:new o.default,audioPlayer:new n.default,restartGame:!1},this.addState(a.StatesEnum.LOADINGSCREEN,g.default,1/60,new g.default(this.stateAccessible)),this.addState(a.StatesEnum.MAINMENU,f.default,1/60,new f.default(this.stateAccessible)),this.addState(a.StatesEnum.OPTIONS,m.default,1/60,new m.default(this.stateAccessible)),this.addState(a.StatesEnum.CONTROLS,u.default,1/60,new u.default(this.stateAccessible)),this.addState(a.StatesEnum.ENDSCREEN,w.default,1/60,new w.default(this.stateAccessible));let t=d.default.getInstance(this.stateAccessible);this.addState(a.StatesEnum.GAME,d.default,1/144,t),this.stateAccessible.restartGame=!0,this.addState(a.StatesEnum.DEBUGMODE,c.default,1/144,new c.default(this.stateAccessible,t)),this.overlayRendering=new x.OverlayRendering,this.fpsDisplay=this.overlayRendering.getNew2DText(),this.fpsDisplay.position.x=.01,this.fpsDisplay.position.y=.01,this.fpsDisplay.size=18,this.fpsDisplay.scaleWithWindow=!1,this.fpsDisplay.getElement().style.color="lime"}onExit(t){p.WebUtils.SetCookie("showFps",e.options.showFps.valueOf().toString()),p.WebUtils.SetCookie("useCrt",e.options.useCrt.valueOf().toString()),p.WebUtils.SetCookie("useBloom",e.options.useBloom.valueOf().toString()),p.WebUtils.SetCookie("foldableGrass",e.options.foldableGrass.valueOf().toString()),p.WebUtils.SetCookie("volume",e.options.volume.toString()),p.WebUtils.SetCookie("grassDensity",e.options.grassDensity.toString());for(let e of this.states)e[1].state.onExit(t)}initializeOptions(){e.options.showFps=!("false"==p.WebUtils.GetCookie("showFps")),e.options.useCrt="true"==p.WebUtils.GetCookie("useCrt"),e.options.useBloom="true"==p.WebUtils.GetCookie("useBloom"),e.options.foldableGrass="true"==p.WebUtils.GetCookie("foldableGrass");let t=p.WebUtils.GetCookie("volume");""!=t&&(e.options.volume=parseFloat(t));let s=p.WebUtils.GetCookie("grassDensity");""!=s&&(e.options.grassDensity=parseFloat(s))}runCurrentState(){const t=Object.create(null,{runCurrentState:{get:()=>super.runCurrentState}});return i(this,void 0,void 0,(function*(){this.fpsDisplay.setHidden(!e.options.showFps),this.fpsDisplay.textString=Math.round(this.fps)+"",this.overlayRendering.draw(),t.runCurrentState.call(this)}))}}e.default=b},2946:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(9185),n=s(9894),r=s(1215);e.default=class{constructor(t,e,s){this.scene=t,this.mapBundle=e,this.doggo=s,this.grassSpawners=new Array,this.grassStrawsPerSpawner=r.options.grassDensity,this.grassStrawsSpawned=0,this.grassSpawnerSide=25,this.grassElevationCutoff=-3.7;for(let t=0;t<4;t++)for(let e=0;e<4;e++)this.createGrass(t*this.grassSpawnerSide-10,e*this.grassSpawnerSide-10)}createGrass(t,e){let s=this.scene.getNewGrassSpawner("Assets/textures/GrassStraw.png","Assets/textures/GrassStraw_Spec.png",this.grassStrawsPerSpawner);this.grassSpawners.push({spawner:s.graphicsObject,offset:new i.default([t,e])})}fillGrass(){let t=Date.now(),e=Math.pow(this.grassStrawsPerSpawner,.5),s=this.grassSpawnerSide/e,i=new Matrix4(this.mapBundle.modelMatrix).invert(),r=new Array,o=this.grassStrawsSpawned%this.grassStrawsPerSpawner,a=Math.floor(this.grassStrawsSpawned/this.grassStrawsPerSpawner);for(;Date.now()-t<20&&this.grassStrawsSpawned<this.grassSpawners.length*this.grassStrawsPerSpawner;){let t=Math.floor(this.grassStrawsSpawned/this.grassStrawsPerSpawner),l=this.grassStrawsSpawned%this.grassStrawsPerSpawner;a!=t&&(this.grassSpawners[a].spawner.bufferSubDataUpdate(7*o,new Float32Array(r)),r.length=0,o=0),a=t;let h=this.grassSpawners[t].offset,u=new n.default([h.x+l%e*s+s*(Math.random()-.5),0,h.y+Math.floor(l/e)*s+s*(Math.random()-.5)]),c=this.mapBundle.graphicsObject.getHeightFromWorldPosition(this.mapBundle.modelMatrix,u,i),d=0;if(null!=c){let t=this.mapBundle.graphicsObject.getNormalFromWorldPosition(this.mapBundle.modelMatrix,u,i);null!=t&&(t.y<.999999999||c<this.grassElevationCutoff)&&(u.y=c,d=.4*Math.random()+.1)}r.push(...u),r.push(d),r.push(.1*(Math.random()-.5),.1*(Math.random()-.5),.1*(Math.random()-.5)),this.grassStrawsSpawned++}this.grassSpawners[a].spawner.bufferSubDataUpdate(7*o,new Float32Array(r))}updateGrass(){const t=this.doggo.getPosition(),e=this.doggo.getVelocity();let s=Math.pow(this.grassStrawsPerSpawner,.5),r=this.grassSpawnerSide/s,o=new Matrix4(this.mapBundle.modelMatrix).invert();for(let a of this.grassSpawners)if(a.offset.x>t.x-this.grassSpawnerSide&&a.offset.x<t.x&&a.offset.y>t.z-this.grassSpawnerSide&&a.offset.y<t.z&&t.y-this.mapBundle.graphicsObject.getHeightFromWorldPosition(this.mapBundle.modelMatrix,t,o)<1){let o=t.x-a.offset.x,l=t.z-a.offset.y,h=Math.floor(o/r),u=Math.floor(l/r);for(let t=h-10;t<h+11;t++)for(let h=u-10;h<u+11;h++)if(new i.default([t*r-o,h*r-l]).len()<.3){let i=Math.floor(t+h*s);if(i>0&&i<this.grassStrawsPerSpawner){let t=new n.default([e.x,0,e.z]).normalize().multiply(.2);t.y=-.2,a.spawner.setGrassTipOffset(i,t)}}}}update(t){this.grassStrawsSpawned<this.grassSpawners.length*this.grassStrawsPerSpawner&&this.fillGrass(),r.options.foldableGrass&&this.updateGrass()}}},687:(t,e,s)=>{Object.defineProperty(e,"__esModule",{value:!0});const i=s(1691),n=s(8190),r=s(2703),o=s(2129),a=s(4359),l=s(3889),h=s(9894);e.default=class{constructor(t,e,s,r,u){this.ecsManager=r,this.scene=u,this.entity=this.ecsManager.createEntity();let c=new l.default;c.position=new h.default(t),c.rotation=new h.default(s),c.scale.setValues(.2,.2,.2),this.ecsManager.addComponent(this.entity,c);let d=new a.default;d.velocity=e,this.ecsManager.addComponent(this.entity,d);let g=this.scene.getNewMesh("Assets/objs/newspaper.obj","Assets/textures/news.png","Assets/textures/black.png"),f=new i.default;f.setup(g.graphicsObject),f.updateTransformMatrix(g.modelMatrix),this.ecsManager.addComponent(this.entity,f);let m=new o.default(g);this.ecsManager.addComponent(this.entity,m),this.ecsManager.addComponent(this.entity,new n.default)}update(t){let e=this.entity.getComponent(r.ComponentTypeEnum.MOVEMENT);e.onGround?e.drag=18:e.drag=1;let s=this.entity.getComponent(r.ComponentTypeEnum.POSITION);return!(e.velocity.length2()<=.01&&e.onGround||null!=s&&s.position.y<-10)||(this.ecsManager.removeComponent(this.entity,r.ComponentTypeEnum.MOVEMENT),this.ecsManager.removeComponent(this.entity,r.ComponentTypeEnum.COLLISION),this.ecsManager.removeComponent(this.entity,r.ComponentTypeEnum.BOUNDINGBOX),!1)}}},7479:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(1691),r=s(8190),o=s(2703),a=s(2129),l=s(1078),h=s(3889),u=s(9894),c=s(5436),d=s(277),g=s(6917),f=s(9295);class m{constructor(t,e,s){this.pos=t,this.size=e,this.rot=s,this.entity=null}}class p{constructor(t,e,s,i,n=!0){this.modelPath=t,this.placementsPath=e,this.diffuseTexturePath=s,this.specularTexturePath=i,this.transforms=new Array,this.addCollision=n,this.transformAdded=!1}loadFromFile(){return i(this,void 0,void 0,(function*(){const t=yield fetch("Assets/placements/"+this.placementsPath);if(t.ok){const e=yield t.text();if(""!=e)for(let t of e.split("\n")){if(t=t.trim(),""==t)break;let[e,s,i]=t.split("|"),n=new m(new u.default(e.split(",").map((t=>parseFloat(t)))),parseFloat(s),new u.default(i.split(",").map((t=>parseFloat(t)))));this.transforms.push(n)}}}))}}e.default=class{constructor(t){this.meshStore=t,this.transformsAdded=!1,this.placements=new Map,this.placements.set("Assets/objs/mailbox.obj",new p("Assets/objs/mailbox.obj","MailboxTransforms.txt","Assets/textures/mailbox.png","Assets/textures/mailbox.png")),this.placements.set("Assets/objs/tree_1.obj",new p("Assets/objs/tree_1.obj","Tree1Transforms.txt","Assets/textures/tree_1.png","Assets/textures/tree_1.png")),this.placements.set("Assets/objs/tree_2.obj",new p("Assets/objs/tree_2.obj","Tree2Transforms.txt","Assets/textures/tree_2.png","Assets/textures/tree_2.png")),this.placements.set("Assets/objs/tree_3.obj",new p("Assets/objs/tree_3.obj","Tree3Transforms.txt","Assets/textures/tree_3.png","Assets/textures/tree_3.png")),this.placements.set("Assets/objs/house.obj",new p("Assets/objs/house.obj","HouseTransforms.txt","Assets/textures/houseTex_bright.png","Assets/textures/houseTex_bright.png")),this.placements.set("Assets/objs/newspaper.obj",new p("Assets/objs/newspaper.obj","NewspaperTransforms.txt","Assets/textures/news.png","Assets/textures/news.png",!1)),this.placements.set("Assets/objs/fence.obj",new p("Assets/objs/fence.obj","FenceTransforms.txt","Assets/textures/white.png","Assets/textures/white.png")),this.placements.set("Assets/objs/BigBuske.obj",new p("Assets/objs/BigBuske.obj","BigBuskeTransforms.txt","Assets/textures/BushTexture.png","Assets/textures/BushTexture.png")),this.placements.set("Assets/objs/Solros.obj",new p("Assets/objs/Solros.obj","SolrosTransforms.txt","Assets/textures/Solros.png","Assets/textures/Solros.png",!1)),this.placements.set("Assets/objs/Plant.obj",new p("Assets/objs/Plant.obj","PlantTransforms.txt","Assets/textures/LeafTexture.png","Assets/textures/LeafTexture.png",!1)),this.placements.set("Assets/objs/SmolBuske.obj",new p("Assets/objs/SmolBuske.obj","SmolBuskeTransforms.txt","Assets/textures/BushTexture.png","Assets/textures/BushTexture.png")),this.placements.set("Assets/objs/DeliveryZone.obj",new p("Assets/objs/DeliveryZone.obj","DeliveryZoneTransforms.txt","Assets/textures/DZ.png","Assets/textures/DZ.png",!1)),this.currentlyEditingTransform=null,this.currentlyEditingPlacement=null}load(t,e){return i(this,void 0,void 0,(function*(){this.scene=t,this.ecsManager=e,this.game=f.default.getInstanceNoSa();for(let t of this.placements){0==t[1].transforms.length&&(yield t[1].loadFromFile());for(let e of t[1].transforms){let s=this.placeObject(t[0],e.pos,e.size,e.rot,!1);null!=s&&(e.entity=s)}}}))}placeObject(t,e,s,i,o=!0){let u=this.placements.get(t);if(null==u)return null;let c=this.ecsManager.createEntity(),d=this.scene.getNewMesh(u.modelPath,u.diffuseTexturePath,u.specularTexturePath),f=new a.default(d);this.ecsManager.addComponent(c,f);let p=new h.default;if(p.position.deepAssign(e),p.scale.deepAssign([s,s,s]),p.rotation.deepAssign(i),this.ecsManager.addComponent(c,p),o){let t=u.transforms.push(new m(e,s,i));u.transformAdded=!0,this.transformsAdded=!0,u.transforms[t-1].entity=c,this.currentlyEditingTransform=u.transforms[t-1],this.currentlyEditingPlacement=u}if("Assets/objs/DeliveryZone.obj"==u.modelPath){let t=new g.default;this.ecsManager.addComponent(c,t),f.object.baseColor=new Vector3([1,0,0]),this.game.score+=1}let x=new n.default;if(x.setup(d.graphicsObject),x.updateTransformMatrix(d.modelMatrix),this.ecsManager.addComponent(c,x),!u.addCollision)return c;let w=new r.default;w.isStatic=!0,this.ecsManager.addComponent(c,w);let b=this.meshStore.getOctree(u.modelPath,!1);if(null==b)return c;let y=new l.default(b);return y.octree.setModelMatrix(d.modelMatrix),this.ecsManager.addComponent(c,y),c}rayCastToSelectNewObject(t){let e=1/0;for(let s of this.placements)for(let i of s[1].transforms){let n=i.entity.getComponent(o.ComponentTypeEnum.BOUNDINGBOX);if(null==n)continue;n.boundingBox.setUpdateNeeded();let r=c.IntersectionTester.doRayCast(t,[n.boundingBox],e);if(r>0&&r<e){let a=i.entity.getComponent(o.ComponentTypeEnum.MESHCOLLISION);if(null!=a){a.octree.setModelMatrix(n.boundingBox.getTransformMatrix()),a.octree.setModelMatrix();let s=new Array;a.octree.getShapesForRayCast(t,s,e),r=c.IntersectionTester.doRayCast(t,s,e)}r>0&&r<e&&(e=r,this.currentlyEditingPlacement=s[1],this.currentlyEditingTransform=i)}}}updateCurrentlyEditingObject(t,e,s){if(null!=this.currentlyEditingTransform){this.currentlyEditingTransform.rot.y+=t,this.currentlyEditingTransform.size+=e,null!=s&&this.currentlyEditingTransform.pos.deepAssign(s);let i=this.currentlyEditingTransform.entity;if(null!=i){let t=i.getComponent(o.ComponentTypeEnum.POSITION);t.rotation.deepAssign(this.currentlyEditingTransform.rot),t.scale.deepAssign([this.currentlyEditingTransform.size,this.currentlyEditingTransform.size,this.currentlyEditingTransform.size]),t.position.deepAssign(this.currentlyEditingTransform.pos)}}null!=this.currentlyEditingPlacement&&(this.currentlyEditingPlacement.transformAdded=!0,this.transformsAdded=!0)}downloadTransforms(){for(let t of this.placements){if(!t[1].transformAdded)continue;let e="";for(let s of t[1].transforms)e+=s.pos+"|"+s.size+"|"+s.rot+"\n";d.WebUtils.DownloadFile(t[1].placementsPath,e),t[1].transformAdded=!1}this.transformsAdded=!1}onExit(t){if(this.transformsAdded)return this.downloadTransforms(),t.preventDefault(),void(t.returnValue="");delete t.returnValue}}},6398:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(1691),r=s(8190),o=s(4359),a=s(7697),l=s(3889),h=s(9185),u=s(9894),c=s(1215),d=s(687),g=s(9295);e.default=class{constructor(t,e,s){this.scene=t,this.rendering=e,this.ecsManager=s,this.throwCooldown=.5,this.throwTimer=0,this.newspapers=new Array,this.rotation=new u.default,this.throwStrength=10,this.throwPos=new u.default,this.throwVel=new u.default,this.game=g.default.getInstanceNoSa(),this.prepThrow=!1}init(){return i(this,void 0,void 0,(function*(){let t=this.ecsManager.createEntity();this.positionComp=new l.default;let e=new n.default;e.boundingBox.setMinAndMaxVectors(new u.default([-.5,0,-.5]),new u.default([.5,1.8,.5])),e.updateTransformMatrix(this.positionComp.matrix),this.movComp=new o.default,this.movComp.acceleration=20,this.movComp.drag=10,this.particleSpawner=this.scene.getNewParticleSpawner("Assets/textures/AimingBlob.png"),this.particleSpawner.sizeChangePerSecond=0,this.particleComp=new a.default(this.particleSpawner),this.particleSpawner.setNumParticles(9),this.ecsManager.addComponent(t,this.positionComp),this.ecsManager.addComponent(t,e),this.ecsManager.addComponent(t,this.movComp),this.ecsManager.addComponent(t,this.particleComp),this.ecsManager.addComponent(t,new r.default),this.respawn()}))}respawn(){this.positionComp.position.setValues(0,0,0),this.movComp.velocity.setValues(0,0,0),this.movComp.accelerationDirection.setValues(0,0,0),this.game.rendering.camera.setDir(0,0,1)}getPosition(){return this.positionComp.position}getVelocity(){return this.movComp.velocity}throwPaper(){this.throwTimer>this.throwCooldown&&(this.throwTimer=0,this.newspapers.push(new d.default(this.throwPos,this.throwVel,new u.default([0,this.rotation.y,0]),this.ecsManager,this.scene)))}update(t){this.throwTimer+=t;for(let e=0;e<this.newspapers.length;e++)this.newspapers[e].update(t)||(this.game.newspapersStopped.push(this.newspapers[e]),this.newspapers.splice(e,1),e--);this.rendering.camera.setPosition(this.positionComp.position.x,this.positionComp.position.y+1.7,this.positionComp.position.z);let e=new u.default([0,0,0]),s=!1,i=c.input.getMouseMovement();if(i.length2()>0&&(e.setValues(.2*-i.y,.2*-i.x),s=!0),c.input.keys.ARROWUP&&(e.x+=210*t,s=!0),c.input.keys.ARROWDOWN&&(e.x-=210*t,s=!0),c.input.keys.ARROWLEFT&&(e.y+=210*t,s=!0),c.input.keys.ARROWRIGHT&&(e.y-=210*t,s=!0),c.input.updateGamepad(),c.input.joystickRightDirection.length2()>.01&&(e=new h.default([c.input.joystickRightDirection.y,c.input.joystickRightDirection.x]).multiply(-210*t),s=!0),this.rotation.add(new u.default([e.x,e.y,0]).multiply(90*t)),s){let s=new Matrix4(null),i=90,n=new u.default(this.rendering.camera.getRight());e.y&&s.rotate(i*e.y*t,0,1,0),e.x&&s.rotate(i*e.x*t,n.x,n.y,n.z);let r=new Vector3(this.rendering.camera.getDir()),o=s.multiplyVector3(r);this.rendering.camera.setDir(o.elements[0],Math.max(-.65,Math.min(.65,o.elements[1])),o.elements[2])}let n=new u.default,r=new u.default(this.rendering.camera.getDir());r.y=0,r.normalize();let o=new u.default(this.rendering.camera.getRight());if(o.y=0,o.normalize(),c.input.updateGamepad(),c.input.joystickLeftDirection.length2()>.001?(n.add(new u.default(o).multiply(2*c.input.joystickLeftDirection.x)),n.subtract(new u.default(r).multiply(2*c.input.joystickLeftDirection.y))):(c.input.keys.W&&n.add(r),c.input.keys.S&&n.subtract(r),c.input.keys.A&&n.subtract(o),c.input.keys.D&&n.add(o)),n.length2()>1&&n.normalize(),this.movComp.accelerationDirection.deepAssign(n),this.throwPos=new u.default(this.positionComp.position).add(r.multiply(1)).add([0,1.4,0]),this.throwVel=new u.default(this.rendering.camera.getDir()).normalize().multiply(this.throwStrength).add(this.movComp.velocity),this.prepThrow=!1,(c.input.keys.E||c.input.mouseClicked||c.input.buttons.get("B"))&&(this.prepThrow=!0),this.prepThrow){for(var a=0;a<9;++a){let t=.1*a,e=new u.default([this.throwPos.x+new u.default(this.throwVel).x*t,this.throwPos.y+new u.default(this.throwVel).y*t+-4.9*t*t,this.throwPos.z+new u.default(this.throwVel).z*t]);this.particleSpawner.setParticleData(a,e,.1,new u.default([0,0,0]),new u.default([0,0,0]))}this.throwRelease=!0}else for(a=0;a<9;++a)this.particleSpawner.setParticleData(a,new u.default([-10,-10,-10]),.1,new u.default([0,0,0]),new u.default([0,0,0]));this.throwRelease&&!this.prepThrow&&(this.throwPaper(),this.throwRelease=!1),c.input.keys[" "]||c.input.buttons.get("A")?this.movComp.jumpRequested=!0:this.movComp.jumpRequested=!1;let l=new u.default(this.movComp.velocity);l.y=0,this.movComp.drag=10+l.len()}}},2061:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(36),r=s(1215),o=s(2183);class a extends n.default{constructor(t){super(),this.overlayRendering=new o.OverlayRendering,this.backButton=this.overlayRendering.getNewButton(),this.backButton.position.x=.5,this.backButton.position.y=.1,this.backButton.center=!0,this.backButton.textSize=30,this.backButton.textString="Back";let e=this;this.backButton.onClick((function(){e.gotoState=n.StatesEnum.OPTIONS}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.overlayRendering.show(),r.input.touchUsed=!0,r.input.simulateTouchBasedOnMouse=!0,r.input.repositionTouchControls=!0}))}reset(){super.reset(),this.overlayRendering.hide(),r.input.touchUsed=!1,r.input.simulateTouchBasedOnMouse=!1,r.input.repositionTouchControls=!1,r.input.drawTouchControls()}update(t){}draw(){this.overlayRendering.draw(),r.input.drawTouchControls()}}e.default=a},7340:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(2183);e.default=class{constructor(t,e){this.overlay=new n.OverlayRendering,this.stateAccessible=t,this.game=e,this.downloadOctreesButton=this.overlay.getNewButton(),this.downloadOctreesButton.position.x=.8,this.downloadOctreesButton.position.y=.1,this.downloadOctreesButton.center=!0,this.downloadOctreesButton.textSize=40,this.downloadOctreesButton.getInputElement().style.backgroundColor="purple",this.downloadOctreesButton.getInputElement().style.color="white",this.downloadOctreesButton.getInputElement().style.borderRadius="4px",this.downloadOctreesButton.getInputElement().style.padding="10px",this.downloadOctreesButton.textString="Download \nOctrees";let s=this;this.downloadOctreesButton.onClick((function(){s.stateAccessible.meshStore.downloadOctrees()})),this.downloadTransformsButton=this.overlay.getNewButton(),this.downloadTransformsButton.position.x=.6,this.downloadTransformsButton.position.y=.1,this.downloadTransformsButton.center=!0,this.downloadTransformsButton.textSize=40,this.downloadTransformsButton.getInputElement().style.backgroundColor="purple",this.downloadTransformsButton.getInputElement().style.color="white",this.downloadTransformsButton.getInputElement().style.borderRadius="4px",this.downloadTransformsButton.getInputElement().style.padding="10px",this.downloadTransformsButton.textString="Download \nTransforms",this.downloadTransformsButton.onClick((function(){s.game.objectPlacer.downloadTransforms()})),this.placementMenuText=this.overlay.getNew2DText(),this.placementMenuText.position.x=.05,this.placementMenuText.position.y=.01,this.placementMenuText.size=20,this.placementMenuText.getElement().style.color="white",this.placementMenuText.getElement().style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black",this.actionText=this.overlay.getNew2DText(),this.actionText.position.x=.2,this.actionText.position.y=.01,this.actionText.size=20,this.actionText.getElement().style.color="white",this.actionText.getElement().style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black"}init(){return i(this,void 0,void 0,(function*(){this.overlay.show()}))}reset(){this.overlay.hide()}draw(){this.overlay.draw()}}},1182:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(36),r=s(1215),o=s(9185),a=s(9894),l=s(7066),h=s(7340),u=s(277);class c extends n.default{constructor(t,e){super(),this.stateAccessible=t,this.game=e,this.debugMenu=new h.default(this.stateAccessible,this.game),this.currentlyPlacing=0,this.placementOptions=["Assets/objs/mailbox.obj","Assets/objs/house.obj","Assets/objs/fence.obj","Assets/objs/BigBuske.obj","Assets/objs/SmolBuske.obj","Assets/objs/DeliveryZone.obj","Assets/objs/tree_1.obj","Assets/objs/tree_2.obj","Assets/objs/tree_3.obj"];let s="";for(let t=0;t<this.placementOptions.length;t++)s+=t+1+": "+this.placementOptions[t].split("/")[2]+" \r\n";this.debugMenu.placementMenuText.textString=s,this.lastMousePos=new o.default([r.input.mousePosition.x,r.input.mousePosition.y]),this.mouseWasPressed=!1}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.debugMenu.init();let e=u.WebUtils.GetCookie("debugPos");if(""!=e){let t=e.split(",");3==t.length&&this.game.rendering.camera.setPosition(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}let s=u.WebUtils.GetCookie("debugDir");if(""!=s){let t=s.split(",");3==t.length&&this.game.rendering.camera.setDir(parseFloat(t[0]),parseFloat(t[1]),parseFloat(t[2]))}}))}reset(){super.reset(),this.debugMenu.reset()}update(t){r.input.keys.P&&(this.gotoState=n.StatesEnum.MAINMENU);let e=new a.default,s=!1;r.input.keys.W&&(e.add(this.game.rendering.camera.getDir()),s=!0),r.input.keys.S&&(e.subtract(this.game.rendering.camera.getDir()),s=!0),r.input.keys.A&&(e.subtract(this.game.rendering.camera.getRight()),s=!0),r.input.keys.D&&(e.add(this.game.rendering.camera.getRight()),s=!0),r.input.keys[" "]&&(e.add(new a.default([0,1,0])),s=!0),r.input.keys.SHIFT&&(e.subtract(new a.default([0,1,0])),s=!0),s&&(e.normalize(),e.multiply(15*t),this.game.rendering.camera.translate(e.x,e.y,e.z));let i=new o.default([0,0]),h=!1;if(r.input.keys.ARROWUP&&(i.x+=210*t,h=!0),r.input.keys.ARROWDOWN&&(i.x-=210*t,h=!0),r.input.keys.ARROWLEFT&&(i.y+=210*t,h=!0),r.input.keys.ARROWRIGHT&&(i.y-=210*t,h=!0),h){let e=new Matrix4(null),s=90,n=new a.default(this.game.rendering.camera.getRight());i.y&&e.rotate(s*i.y*t,0,1,0),i.x&&e.rotate(s*i.x*t,n.x,n.y,n.z);let r=new Vector3(this.game.rendering.camera.getDir()),o=e.multiplyVector3(r);this.game.rendering.camera.setDir(o.elements[0],o.elements[1],o.elements[2])}this.currentlyPlacing=-1;for(let t=1;t<this.placementOptions.length+1;t++)if(r.input.keys[t]){this.currentlyPlacing=t-1;break}if(r.input.mouseClicked){let t=0,e=null,s=0,i=!1;if(r.input.keys.R&&(t=r.input.mousePosition.x-this.lastMousePos.x,i=!0,this.debugMenu.actionText.textString="Rotating"),r.input.keys.T){let t=l.MousePicking.GetRay(this.game.rendering.camera),s=this.game.doRayCast(t);s>=0&&(e=new a.default(this.game.rendering.camera.getPosition()).add(new a.default(t.getDir()).multiply(s)),i=!0),this.debugMenu.actionText.textString="Moving"}if(r.input.keys.Y&&(s=.001*(this.lastMousePos.y-r.input.mousePosition.y),i=!0,this.debugMenu.actionText.textString="Scaling"),i)this.game.objectPlacer.updateCurrentlyEditingObject(t,s,e);else if(!this.mouseWasPressed){let t=l.MousePicking.GetRay(this.game.rendering.camera);if(this.currentlyPlacing>=0){let e=this.game.doRayCast(t);e>=0&&this.game.objectPlacer.placeObject(this.placementOptions[this.currentlyPlacing],new a.default(this.game.rendering.camera.getPosition()).add(new a.default(t.getDir()).multiply(e)),1,new a.default([0,0,0])),this.debugMenu.actionText.textString="Placing new"}else this.game.objectPlacer.rayCastToSelectNewObject(t),this.debugMenu.actionText.textString="Picking"}this.mouseWasPressed=!0}else this.mouseWasPressed=!1;this.lastMousePos.deepAssign([r.input.mousePosition.x,r.input.mousePosition.y]),this.game.ecsManager.update(0);let c=this.game.rendering.camera.getPosition();u.WebUtils.SetCookie("debugPos",c.x+","+c.y+","+c.z);let d=this.game.rendering.camera.getDir();u.WebUtils.SetCookie("debugDir",d.x+","+d.y+","+d.z),this.game.grassHandler.update(t)}prepareDraw(t){}draw(){this.game.rendering.draw(),this.debugMenu.draw(),r.input.drawTouchControls()}}e.default=c},7471:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(2183),r=s(36),o=s(9295);class a extends r.default{constructor(t){super(),this.overlayRendering=new n.OverlayRendering,this.endText=this.overlayRendering.getNew2DText(),this.endText.position.x=.5,this.endText.position.y=.2,this.endText.center=!0,this.endText.textString="Game End!",this.endText.getElement().style.borderColor="white",this.scoreText=this.overlayRendering.getNew2DText(),this.scoreText.position.x=.5,this.scoreText.position.y=.3,this.scoreText.center=!0,this.scoreText.textString="Completion time:",this.scoreTextNumber=this.overlayRendering.getNew2DText(),this.scoreTextNumber.position.x=.5,this.scoreTextNumber.position.y=.35,this.scoreTextNumber.center=!0,this.scoreTextNumber.textString="0";let e=this.overlayRendering.getNewButton();e.position.x=.5,e.position.y=.45,e.center=!0,e.textString="Restart",e.onClick(function(){this.gotoState=r.StatesEnum.GAME,t.restartGame=!0}.bind(this))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.overlayRendering.show(),this.game=o.default.getInstanceNoSa()}))}reset(){super.reset(),this.overlayRendering.hide()}update(t){}draw(){this.overlayRendering.draw(),this.scoreTextNumber.textString=Math.floor(this.game.gameTimer).toString()}}e.default=a},9295:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(8293),r=s(2129),o=s(3889),a=s(8190),l=s(1691),h=s(36),u=s(3020),c=s(1215),d=s(6398),g=s(1078),f=s(5436),m=s(2183),p=s(4831),x=s(1541),w=s(2946),b=s(7479),y=s(277);class v extends h.default{static getInstance(t){return v.instance||(v.instance=new v(t)),v.instance}static getInstanceNoSa(){return v.instance}constructor(t){super(),this.stateAccessible=t,this.objectPlacer=new b.default(this.stateAccessible.meshStore),this.newspapersStopped=new Array,this.score=0}load(){return i(this,void 0,void 0,(function*(){this.scene=new x.default(this.stateAccessible.textureStore,this.stateAccessible.meshStore),this.rendering=new u.default(this.stateAccessible.textureStore,this.scene),this.ecsManager=new n.default(this.rendering),this.overlayRendering=new m.OverlayRendering(this.rendering.camera),this.createMapEntity(),this.createSurroundingArea();let t=this.scene.getDirectionalLight();t.ambientMultiplier=.5,t.direction.setValues(.05,-.4,-.7),t.colour.setValues(.3,.25,.2),this.player=new d.default(this.scene,this.rendering,this.ecsManager),this.grassHandler=new w.default(this.scene,this.mapBundle,this.player),this.gameTimer=0,this.score=0,this.menuButton=this.overlayRendering.getNewButton(),this.menuButton.position.x=.9,this.menuButton.position.y=0,this.menuButton.textSize=40,this.menuButton.getInputElement().style.backgroundColor="transparent",this.menuButton.getInputElement().style.borderColor="transparent",this.menuButton.getInputElement().style.color="white",this.menuButton.getInputElement().style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black",this.menuButton.textString="Menu",this.scoreText=this.overlayRendering.getNew2DText(),this.scoreText.position.x=.05,this.scoreText.position.y=.1,this.scoreText.textString="0",this.scoreText.getElement().style.color="white",this.scoreText.getElement().style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black",this.gameTimeText=this.overlayRendering.getNew2DText(),this.gameTimeText.position.x=.05,this.gameTimeText.position.y=.05,this.gameTimeText.textString="0",this.gameTimeText.getElement().style.color="white",this.gameTimeText.getElement().style.textShadow="-1px 0 black, 0 1px black, 1px 0 black, 0 -1px black";let e=this;this.menuButton.onClick((function(){e.gotoState=h.StatesEnum.MAINMENU})),this.rendering.setSkybox("Assets/textures/skyboxes/LordKitty"),yield this.objectPlacer.load(this.scene,this.ecsManager),yield this.player.init()}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.stateAccessible.restartGame&&(this.menuButton&&this.menuButton.remove(),yield this.load(),this.stateAccessible.restartGame=!1),this.overlayRendering.show(),this.rendering.useCrt=c.options.useCrt,this.rendering.useBloom=c.options.useBloom,"true"==y.WebUtils.GetCookie("debug")?this.gotoState=h.StatesEnum.DEBUGMODE:document.getElementById("gameDiv").requestPointerLock()}))}reset(){super.reset(),this.overlayRendering&&this.overlayRendering.hide(),p.gl.clearColor(0,0,0,1),p.gl.clear(p.gl.COLOR_BUFFER_BIT),c.input.touchUsed=!1,c.input.drawTouchControls()}onExit(t){this.objectPlacer.onExit(t)}createMapEntity(){let t=this.ecsManager.createEntity();this.mapBundle=this.scene.getNewHeightMap("Assets/heightmaps/heightmap.png","Assets/textures/HeightmapTexture.png","Assets/textures/HeightmapTexture.png");let e=this.mapBundle.graphicsObject,s=e.getVertices();for(let t=0;t<e.xResolution*e.zResolution;t++)s[8*t+4]>.999999999&&s[8*t+1]>.001?s[8*t+6]=.75:s[8*t+6]=.25;e.setVertexData(s),this.ecsManager.addComponent(t,new r.default(this.mapBundle));let i=new o.default;i.position.setValues(-10,-4,-10),i.scale.setValues(.5,2,.5),this.ecsManager.addComponent(t,i);let n=new l.default;n.setup(this.mapBundle.graphicsObject),n.updateTransformMatrix(this.mapBundle.modelMatrix),this.ecsManager.addComponent(t,n);let h=new a.default;h.isStatic=!0,this.ecsManager.addComponent(t,h);let u=new g.default(this.stateAccessible.meshStore.getOctree("Assets/heightmaps/heightmap.png"));u.octree.setModelMatrix(this.mapBundle.modelMatrix),this.ecsManager.addComponent(t,u),i.calculateMatrix(this.mapBundle.modelMatrix),u.octree.setModelMatrix()}createSurroundingArea(){let t=this.ecsManager.createEntity(),e=this.scene.getNewHeightMap("Assets/heightmaps/surroundingArea.png","Assets/textures/HeightmapTexture.png","Assets/textures/HeightmapTexture.png"),s=e.graphicsObject,i=s.getVertices();for(let t=0;t<s.xResolution*s.zResolution;t++)Math.pow(i[8*t+1]*Math.random(),2)>Math.pow(.07,2)?i[8*t+6]=.75:i[8*t+6]=.25;s.setVertexData(i),this.ecsManager.addComponent(t,new r.default(e));let n=new o.default;n.position.setValues(-160,-4,-160),n.scale.setValues(.5,80,.5),this.ecsManager.addComponent(t,n);let h=[[0,40,-9.5],[90,89.5,40],[0,40,90],[90,-9.5,40]];for(let t of h){let e=this.ecsManager.createEntity(),s=this.scene.getNewMesh("Assets/objs/cube.obj","Assets/textures/Bricks.png","Assets/textures/Bricks.png");this.ecsManager.addComponent(e,new r.default(s));let i=new o.default;i.scale.setValues(50,3,1),i.rotation.setValues(0,t[0],0),i.position.setValues(t[1],-2,t[2]),s.textureMatrix.scale(50,1,1),this.ecsManager.addComponent(e,i);let n=new l.default;n.setup(s.graphicsObject),n.updateTransformMatrix(s.modelMatrix),this.ecsManager.addComponent(e,n);let h=new a.default;h.isStatic=!0,this.ecsManager.addComponent(e,h)}}doRayCast(t){let e=new Array;return this.stateAccessible.meshStore.getOctree("Assets/heightmaps/heightmap.png").getShapesForRayCast(t,e),f.IntersectionTester.doRayCast(t,e)}update(t){this.player.update(t),this.gameTimer+=t,this.score<=0&&(this.gotoState=h.StatesEnum.ENDSCREEN),this.scoreText.textString="Houses left: "+this.score.toString(),this.gameTimeText.textString=Math.floor(this.gameTimer).toString(),this.grassHandler.update(t),this.ecsManager.update(t)}prepareDraw(t){this.ecsManager.updateRenderingSystems(t)}draw(){this.rendering.draw(),this.overlayRendering.draw(),c.input.drawTouchControls()}}e.default=v},6254:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(36),r=s(2183);class o extends n.default{constructor(t){super(),this.overlayRendering=new r.OverlayRendering,this.sa=t,this.text=this.overlayRendering.getNew2DText(),this.text.center=!0,this.text.position.x=.5,this.text.position.y=.4,this.text.size=50,this.statusText="Loading assets ",this.progressBar=this.overlayRendering.getNewProgress(),this.progressBar.center=!0,this.progressBar.position.x=.5,this.progressBar.position.y=.5,this.progressBar.size=50,this.progressBar.getProgressElement().style.borderRadius="4px",this.progressBar.getProgressElement().max=1,this.progressBar.getProgressElement().value=0,this.progress=0,this.timer=0}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.overlayRendering.show(),this.overlayRendering.draw();let e=["Assets/textures/AimingBlob.png","Assets/textures/fire.png","Assets/textures/knight.png","Assets/textures/black.png","Assets/textures/white.png","Assets/textures/GrassStraw.png","Assets/textures/GrassStraw_Spec.png","Assets/textures/HeightmapTexture.png","Assets/textures/houseTex.png","Assets/textures/houseTex_bright.png","Assets/textures/DZ.png","Assets/textures/BushTexture.png","Assets/textures/Solros.png","Assets/textures/AimingBlob.png","Assets/textures/LeafTexture.png","Assets/textures/mailbox.png","Assets/textures/news.png","Assets/textures/Bricks.png","Assets/textures/tree_1.png","Assets/textures/tree_2.png","Assets/textures/tree_3.png"],s=["Assets/textures/skyboxes/LordKitty"],i=["Assets/objs/house.obj","Assets/objs/mailbox.obj","Assets/objs/newspaper.obj","Assets/objs/fence.obj","Assets/objs/BigBuske.obj","Assets/objs/Solros.obj","Assets/objs/Plant.obj","Assets/objs/SmolBuske.obj","Assets/objs/tree_1.obj","Assets/objs/tree_2.obj","Assets/objs/tree_3.obj","Assets/objs/DeliveryZone.obj","Assets/objs/cube.obj"];this.meshesRequested=i.length,this.meshesLoaded=0;let n=[["Assets/heightmaps/heightmap.png",200,200,1,1],["Assets/heightmaps/surroundingArea.png",400,400,2,2]];this.heightmapsRequested=n.length,this.heightmapsLoaded=0,this.octreesToLoad=[["Assets/heightmaps/heightmap.png",.01,10],["Assets/objs/house.obj",.1,20],["Assets/objs/mailbox.obj",.1,20],["Assets/objs/BigBuske.obj",.1,20],["Assets/objs/Solros.obj",.1,20],["Assets/objs/SmolBuske.obj",.1,20],["Assets/objs/tree_1.obj",.1,20],["Assets/objs/tree_2.obj",.1,20],["Assets/objs/tree_3.obj",.1,20]],this.octreesRequested=this.octreesToLoad.length,this.octreesLoaded=0,this.texturesToLoad=new Array;for(const t of e)this.texturesToLoad.push(this.sa.textureStore.getTexture(t));for(const t of s)this.texturesToLoad.push(this.sa.textureStore.getCubeMap(t));for(const t of i)this.sa.meshStore.loadMesh(t).then((()=>{this.meshesLoaded++}));for(const t of n)5==t.length?this.sa.meshStore.loadHeightmap(t[0],!1,t[1],t[2],t[3],t[4]).then((()=>{this.heightmapsLoaded++})):this.sa.meshStore.loadHeightmap(t[0]).then((()=>{this.heightmapsLoaded++}))}))}reset(){super.reset(),this.overlayRendering.hide()}update(t){let e=this.texturesToLoad.length+this.meshesRequested+this.heightmapsRequested+this.octreesRequested,s=0;for(let t of this.texturesToLoad)t.loadedFromFile&&s++;let i=s+this.meshesLoaded+this.heightmapsLoaded+this.octreesLoaded;if(this.meshesLoaded==this.meshesRequested&&this.heightmapsLoaded==this.heightmapsRequested&&this.octreesToLoad.length>0){this.statusText="Generating octrees ";let t=this.octreesToLoad.length-1,e=this.octreesToLoad[t];this.sa.meshStore.loadOctree(e[0],e[1],e[2],10).then((t=>{t.doneLoading&&this.octreesToLoad[this.octreesToLoad.length-1][0]==e[0]&&(this.octreesToLoad.pop(),this.octreesLoaded++)}))}this.timer+=t,this.progress=i/e,this.progressBar.getProgressElement().value=this.progress,this.text.textString=this.statusText;for(let t=4;t>1;t--)this.timer-Math.floor(this.timer)>1/t?this.text.textString+="-":this.text.textString+="_";this.text.textString+="  "+Math.ceil(100*this.progress)+"%",this.progress>=1&&this.timer>=.5&&(this.gotoState=n.StatesEnum.MAINMENU)}draw(){this.overlayRendering.draw()}}e.default=o},3540:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(2183),r=s(36),o=s(277);class a extends r.default{constructor(t){super(),this.overlayRendering=new n.OverlayRendering;let e=this.overlayRendering.getNewButton();e.position.x=.5,e.position.y=.2,e.center=!0,e.textString="Start";let s=this;e.onClick((function(){s.gotoState=r.StatesEnum.GAME,e.textString="Resume"}));let i=this.overlayRendering.getNewButton();i.position.x=.5,i.position.y=.4,i.center=!0,i.textString="Restart",i.onClick((function(){s.gotoState=r.StatesEnum.GAME,t.restartGame=!0,e.textString="Resume",o.WebUtils.SetCookie("debug","false")}));let a=this.overlayRendering.getNewButton();a.position.x=.5,a.position.y=.6,a.center=!0,a.textString="Options",a.onClick((function(){s.gotoState=r.StatesEnum.OPTIONS}));let l=this.overlayRendering.getNewButton();l.position.x=.5,l.position.y=.8,l.center=!0,l.textString="Fullscreen",l.onClick((function(){document.getElementById("gameDiv").requestFullscreen()}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.overlayRendering.show()}))}reset(){super.reset(),this.overlayRendering.hide()}update(t){}draw(){this.overlayRendering.draw()}}e.default=a},7026:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const n=s(1215),r=s(36),o=s(2183);class a extends r.default{constructor(t){super(),this.overlayRendering=new o.OverlayRendering,this.crtCB=this.overlayRendering.getNewCheckbox(),this.crtCB.position.x=.4,this.crtCB.position.y=.25,this.crtCB.textString="CRT-effect ",this.crtCB.getElement().style.color="cyan",this.crtCB.getInputElement().style.accentColor="red",this.crtCB.getInputElement().checked=n.options.useCrt,this.bloomCB=this.overlayRendering.getNewCheckbox(),this.bloomCB.position.x=.4,this.bloomCB.position.y=.3,this.bloomCB.textString="Bloom-effect ",this.bloomCB.getElement().style.color="cyan",this.bloomCB.getInputElement().style.accentColor="red",this.bloomCB.getInputElement().checked=n.options.useBloom,this.grassCB=this.overlayRendering.getNewCheckbox(),this.grassCB.position.x=.4,this.grassCB.position.y=.35,this.grassCB.textString="Foldable grass ",this.grassCB.getElement().style.color="cyan",this.grassCB.getInputElement().style.accentColor="red",this.grassCB.getInputElement().checked=n.options.foldableGrass,this.grassDensitySlider=this.overlayRendering.getNewSlider(),this.grassDensitySlider.position.x=.4,this.grassDensitySlider.position.y=.4,this.grassDensitySlider.textString="Grass density \r\n(requires restart)",this.grassDensitySlider.getElement().style.color="cyan",this.grassDensitySlider.getInputElement().style.accentColor="red",this.grassDensitySlider.getInputElement().min="1000",this.grassDensitySlider.getInputElement().max="100000",this.grassDensitySlider.getInputElement().value=n.options.grassDensity+"",this.fpsDisplayCB=this.overlayRendering.getNewCheckbox(),this.fpsDisplayCB.position.x=.4,this.fpsDisplayCB.position.y=.5,this.fpsDisplayCB.textString="Fps counter ",this.fpsDisplayCB.getElement().style.color="cyan",this.fpsDisplayCB.getInputElement().style.accentColor="red",this.fpsDisplayCB.getInputElement().checked=n.options.showFps,this.controlsButton=this.overlayRendering.getNewButton(),this.controlsButton.position.x=.5,this.controlsButton.position.y=.75,this.controlsButton.center=!0,this.controlsButton.textString="Controls";let e=this;this.controlsButton.onClick((function(){e.gotoState=r.StatesEnum.CONTROLS})),this.backButton=this.overlayRendering.getNewButton(),this.backButton.position.x=.5,this.backButton.position.y=.85,this.backButton.center=!0,this.backButton.textString="Back to main menu",this.backButton.onClick((function(){e.gotoState=r.StatesEnum.MAINMENU}))}init(){const t=Object.create(null,{init:{get:()=>super.init}});return i(this,void 0,void 0,(function*(){t.init.call(this),this.overlayRendering.show()}))}reset(){super.reset(),this.overlayRendering.hide()}update(t){n.options.useCrt=this.crtCB.getChecked(),n.options.useBloom=this.bloomCB.getChecked(),n.options.foldableGrass=this.grassCB.getChecked(),n.options.showFps=this.fpsDisplayCB.getChecked(),n.options.grassDensity=this.grassDensitySlider.getValue()}draw(){this.overlayRendering.draw()}}e.default=a},4831:function(t,e,s){var i=this&&this.__awaiter||function(t,e,s,i){return new(s||(s=Promise))((function(n,r){function o(t){try{l(i.next(t))}catch(t){r(t)}}function a(t){try{l(i.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(o,a)}l((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.windowInfo=e.applicationStartTime=e.gl=void 0;const n=s(2977),r=s(1215),o=s(4109),a=s(5004),l=s(8938),h=s(9171),u=s(8657),c=s(139),d=s(1653),g=s(6465),f=s(7419),m=s(7110),p=s(8590),x=s(7959),w=s(9085),b=s(3732);n.SAT.runUnitTests(),e.applicationStartTime=Date.now(),e.windowInfo={resolutionWidth:1920,resolutionHeight:1080,paddingX:0,paddingY:0};const y=9/16,v=document.getElementById("gameDiv");function P(t){let s,i,n={width:window.innerWidth,height:window.innerHeight};y>n.height/n.width?(s=n.height,i=1.7777777777777777*s):(i=n.width,s=i*y);let r=(n.width-i)/2,o=(n.height-s)/2;v.style.padding=o+"px "+r+"px",v.style.width=i+"px",v.style.height=s+"px",t.canvas.width=i,t.canvas.height=s,e.windowInfo.resolutionWidth=i,e.windowInfo.resolutionHeight=s,e.windowInfo.paddingX=r,e.windowInfo.paddingY=o}let S;window.onload=()=>i(void 0,void 0,void 0,(function*(){e.gl=function(){let t=document.getElementById("gameCanvas");t.width=e.windowInfo.resolutionWidth,t.height=e.windowInfo.resolutionHeight;let s=t.getContext("webgl2",{antialias:!1});if(s.getExtension("EXT_color_buffer_float")||alert("Rendering to floating point textures is not supported on this platform"),s.getExtension("OES_texture_float_linear")||alert("Floating point rendering to FBO textures not supported"),s)return s;console.log("Failed to get rendering context for WebGL")}(),(0,o.createGeometryPass)(),(0,a.createLightingPass)(),(0,c.createBloomBlending)(),(0,d.createBloomExtraction)(),(0,g.createCrtShaderProgram)(),(0,f.createGaussianBlur)(),(0,p.createShadowPass)(),(0,w.createGrassShadowPass)(),(0,l.createParticleShaderProgram)(),(0,h.createGrassShaderProgram)(),(0,u.createPhongShaderProgram)(),(0,m.createScreenQuadShaderProgram)(),(0,x.createSimpleShaderProgram)(),(0,b.createSkyboxShaderProgram)(),S=new r.default,P(e.gl),window.addEventListener("resize",(function(){P(e.gl)})),window.addEventListener("beforeunload",(function(t){S.onExit(t)})),S.start()}))}},e={};!function s(i){var n=e[i];if(void 0!==n)return n.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,s),r.exports}(6507)})();
//# sourceMappingURL=main.js.map